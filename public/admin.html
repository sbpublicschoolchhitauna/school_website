<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Slider Admin - SB Public School</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:18px;background:#f4f7fb}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(16,24,40,0.06);max-width:720px}
    input[type=file]{display:block;margin-bottom:8px}
    button{padding:8px 12px;border-radius:8px;background:#0b3b6f;color:#fff;border:0;cursor:pointer}
    .list{margin-top:12px}
    .list div{margin-bottom:8px}
  </style>
</head>
<body>
<div class="card">
  <h2>Slider Admin</h2>
  <p>Provide the ADMIN token when prompted. This admin page uses the server's API to upload/delete images.</p>
  <form id="uploadForm">
    <input type="file" name="image" required />
    <button type="submit">Upload</button>
  </form>
  <div class="list" id="list"></div>
</div>

<script>
const ADMIN_TOKEN = prompt('Enter ADMIN TOKEN (leave blank to cancel)') || '';
if(!ADMIN_TOKEN) alert('No token provided - upload/delete will fail.');

async function fetchImages(){
  try{
    const r = await fetch('/api/images');
    const j = await r.json();
    return j.images || [];
  }catch(e){
    console.error(e);
    return [];
  }
}

async function refresh(){
  const imgs = await fetchImages();
  const wrap = document.getElementById('list');
  wrap.innerHTML = '';
  imgs.forEach(f => {
    const div = document.createElement('div');
    const a = document.createElement('a'); a.href = '/slider_images/' + f; a.target='_blank'; a.textContent = f;
    const btn = document.createElement('button'); btn.textContent=' Delete '; btn.style.marginLeft='8px';
    btn.addEventListener('click', async ()=>{
      if(!confirm('Delete ' + f + '?')) return;
      const res = await fetch('/api/delete', {
        method:'DELETE',
        headers: {'Content-Type':'application/json', 'x-admin-token': ADMIN_TOKEN},
        body: JSON.stringify({ name: f })
      });
      const j = await res.json();
      if(j.ok) refresh(); else alert('Error: '+ (j.error||JSON.stringify(j)));
    });
    div.appendChild(a); div.appendChild(btn);
    wrap.appendChild(div);
  });
}

document.getElementById('uploadForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const file = e.target.image.files[0];
  if(!file) return alert('Choose a file');
  const form = new FormData();
  form.append('image', file, file.name);
  const res = await fetch('/api/upload', { method:'POST', headers: { 'x-admin-token': ADMIN_TOKEN }, body: form });
  const j = await res.json();
  if(j.ok) { alert('Uploaded '+ j.filename); refresh(); } else alert('Upload error: '+ (j.error||JSON.stringify(j)));
});

refresh();
</script>
</body>
</html>
