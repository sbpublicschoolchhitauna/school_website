<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>स्कूल वेबसाइट — होम</title>
  <style>
    :root{--accent:#0f766e;--muted:#6b7280;--card:#ffffff}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:#f8fafc;color:#0f172a}
    header{background:linear-gradient(90deg,var(--accent),#0891b2);color:#fff;padding:18px 24px}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand h1{margin:0;font-size:20px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .hero{background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0));padding:28px;border-radius:10px;margin-top:18px;color:#062b2a}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:20px}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(7,10,15,0.06)}
    .search-box input{width:100%;padding:12px;border-radius:8px;border:1px solid #e6edf0}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;background:var(--accent);color:#fff;text-decoration:none;border:none;cursor:pointer}
    .notifications{height:140px;overflow:hidden}
    .ticker{animation:scroll 12s linear infinite}
    @keyframes scroll{0%{transform:translateY(0)}50%{transform:translateY(-50%)}100%{transform:translateY(0)}}
    .meta{color:var(--muted);font-size:13px}
    .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .gallery img{width:100%;height:100px;object-fit:cover;border-radius:8px}
    .contact p{margin:6px 0}
    footer{padding:20px 0;text-align:center;color:var(--muted)}
    @media (max-width:900px){.grid{grid-template-columns:1fr} .gallery{grid-template-columns:repeat(2,1fr)} .notifications{height:120px}}
  </style>
</head>
<body>
  <header>
    <div class="container topbar">
      <div class="brand">
        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='44' height='44' viewBox='0 0 24 24'><rect rx='5' width='24' height='24' fill='%23ffffff' opacity='0.12'/><path d='M12 2L3 6v6c0 5 3.8 9.1 9 10 5.2-.9 9-5 9-10V6l-9-4z' fill='%23fff'/></svg>" alt="logo" style="width:44px;height:44px;border-radius:6px;">
        <div>
          <h1>विद्या निकेतन</h1>
          <div class="meta">Quality Education • Since 1998</div>
        </div>
      </div>
      <nav>
        <a href="#" class="btn" onclick="openLogin(event)">Admin Login</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero card">
      <div style="display:flex;justify-content:space-between;gap:18px;align-items:center;flex-wrap:wrap">
        <div style="flex:1;min-width:240px">
          <h2 style="margin:0 0 8px 0">आपका स्वागत है — विद्या निकेतन</h2>
          <p class="meta">हमारे स्कूल का उद्देश्य हर बच्चे में आत्मविश्वास और गुणात्मक शिक्षा विकसित करना है। नीचे से छात्र खोजें, नोटिफिकेशन पढ़ें, या संपर्क करें।</p>
        </div>
        <div style="width:360px">
          <div class="card search-box">
            <label class="meta">Admission Number डालें</label>
            <input id="admission" placeholder="उदा. 1023" />
            <div style="margin-top:10px;display:flex;gap:8px;">
              <button class="btn" onclick="searchStudent()">खोजें</button>
              <button class="btn" style="background:#ef4444" onclick="printEmptyMarksheet()">Print Marksheet</button>
            </div>
            <div id="result" style="margin-top:12px;font-size:14px"></div>
          </div>
        </div>
      </div>
    </section>

    <div class="grid" style="margin-top:18px">
      <div>
        <div class="card">
          <h3 style="margin-top:0">Notifications</h3>
          <div class="notifications">
            <div id="ticker" class="ticker"></div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin-top:0">Gallery</h3>
          <div class="gallery" id="gallery"></div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin-top:0">हमारे बारे में</h3>
          <p class="meta">विद्या निकेतन एक समर्पित शिक्षण संस्थान है जो समग्र विकास पर विश्वास रखता है — शैक्षणिक, खेलकूद, और नैतिक शिक्षा सभी पर बराबर ध्यान।</p>
        </div>
      </div>

      <aside class="card contact">
        <h3 style="margin-top:0">Contact / संपर्क</h3>
        <p><strong>प्राचार्य:</strong> डॉ. सीमा शर्मा</p>
        <p><strong>पता:</strong> Gandhi Road, Basti, Uttar Pradesh</p>
        <p><strong>फोन:</strong> +91 98765 43210</p>
        <p><strong>Email:</strong> info@vidyaniketan.edu.in</p>
        <div style="margin-top:12px">
          <a class="btn" href="#" onclick="openAdmissionForm(event)">Admission Form</a>
        </div>
      </aside>
    </div>

    <section style="margin-top:18px" class="card">
      <h3 style="margin-top:0">सूचनात्मक सेक्शन</h3>
      <p class="meta">यह पेज पूरी तरह responsive है और आसानी से backend (Google Sheets / API) से जुड़ सकता है। मैंने डेमो डेटा client-side रखा है — पर आप चाहें तो इसे सीधे /api/students/:admission पर बदल सकते हैं।</p>
    </section>
  </main>

  <footer>
    <div class="container">
      © <span id="year"></span> Vidya Niketan — All rights reserved • Designed by ChatGPT
    </div>
  </footer>

  <!-- Admin Login modal (simple) -->
  <div id="loginModal" style="display:none;position:fixed;inset:0;background:rgba(3,7,18,0.5);align-items:center;justify-content:center;padding:20px">
    <div style="background:#fff;padding:20px;border-radius:10px;width:360px;box-shadow:0 10px 40px rgba(2,6,23,0.4)">
      <h3 style="margin:0 0 8px 0">Admin Login</h3>
      <input id="u" placeholder="username" style="width:100%;padding:10px;margin-bottom:8px;border:1px solid #e6edf0;border-radius:6px" />
      <input id="p" placeholder="password" type="password" style="width:100%;padding:10px;margin-bottom:8px;border:1px solid #e6edf0;border-radius:6px" />
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn" onclick="doLogin()">Login</button>
        <button class="btn" style="background:#94a3b8" onclick="closeLogin()">Close</button>
      </div>
      <div id="loginMsg" style="margin-top:8px;color:#ef4444"></div>
    </div>
  </div>

  <script>
    // Google Sheet config
    const SHEET_ID = "1BtoDja9imrMyHMKt5oqSYoOzj9w2GWe13JcbRu1vWO8";
    const NOTIF_SHEET = "Notification";
    const SLIDER_SHEET = "Image Slider";
    const STUDENT_SHEET = "Student's Details";

    document.getElementById('year').innerText = new Date().getFullYear();

    // ---------- Notifications loader (from sheet) ----------
    async function fetchGviz(sheetName){
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(sheetName)}&tqx=out:json`;
      const r = await fetch(url);
      if(!r.ok) throw new Error('Network error: ' + r.status);
      const text = await r.text();
      const jsonText = text.replace(/^[^{]*/,'').replace(/\);\s*$/,'');
      return JSON.parse(jsonText);
    }

    async function loadNotificationsFromSheet(){
      try{
        const data = await fetchGviz(NOTIF_SHEET);
        const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
        const rows = (data.table.rows||[]).map(r=> r.c || []);
        const records = rows.map(cells=>{
          const obj={};
          for(let i=0;i<cols.length;i++){
            const cell = cells[i];
            let v = '';
            if(cell){
              if(cell.v !== undefined) v = cell.v;
              else if(cell.f !== undefined) v = String(cell.f).replace(/<[^>]*>/g,'').trim();
            }
            obj[cols[i]||('col'+i)] = v;
          }
          return obj;
        });
        // detect keys
        const textKey = cols.find(k=>/notif|notification|text|message/i.test(k)) || cols.find(k=>!/date|time|id/i.test(k)) || cols[1] || cols[0] || "Notification's";
        const dateKey = cols.find(k=>/date|day|time/i.test(k)) || cols[0] || "Date";

        const ticker = document.getElementById('ticker');
        ticker.innerHTML = '';
        records.forEach(r=>{
          const d = r[dateKey] || '';
          const t = r[textKey] || '';
          ticker.innerHTML += `<div style="padding:6px 0;border-bottom:1px dashed #eef"><strong>${d}</strong> — ${t}</div>`;
        });
        // duplicate for smooth scroll
        ticker.innerHTML += ticker.innerHTML;
      }catch(e){
        console.error('Notifications load failed', e);
        const ticker = document.getElementById('ticker');
        ticker.innerHTML = '<div style="padding:6px 0;border-bottom:1px dashed #eef">नोटिफिकेशन लोड नहीं हुए — Sheet settings जाँचें।</div>';
      }
    }

    // ---------- Gallery loader (from sheet) ----------
    async function loadGalleryFromSheet(){
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      const DEMO_GALLERY = [
        'https://picsum.photos/id/1015/600/400',
        'https://picsum.photos/id/1025/600/400',
        'https://picsum.photos/id/1011/600/400',
        'https://picsum.photos/id/1005/600/400',
        'https://picsum.photos/id/1018/600/400',
        'https://picsum.photos/id/1024/600/400'
      ];
      try{
        const data = await fetchGviz(SLIDER_SHEET);
        const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
        const rows = (data.table.rows||[]).map(r=> r.c || []);

        let imageColIndex = -1;
        for(let i=0;i<cols.length;i++){
          const k = cols[i].toLowerCase();
          if(k.includes('image')||k.includes('img')||k.includes('photo')||k.includes('url')) { imageColIndex = i; break; }
        }
        if(imageColIndex === -1) imageColIndex = 0;

        const urls = [];
        for(const row of rows){
          const cell = row[imageColIndex];
          if(!cell) continue;
          let v = '';
          if(cell.v !== undefined) v = cell.v;
          else if(cell.f !== undefined) v = String(cell.f);
          const m = String(v).match(/src=["']([^"']+)["']/i);
          if(m) urls.push(m[1]);
          else if(String(v).trim().startsWith('http')) urls.push(String(v).trim());
          else if(String(v).includes('drive.google.com')){
            const drv = String(v).match(/\/d\/([^\/]+)\//);
            if(drv) urls.push(`https://drive.google.com/uc?export=view&id=${drv[1]}`);
            else urls.push(String(v).trim());
          }
        }

        const final = (urls.length>0)? urls : DEMO_GALLERY;
        final.forEach(u=>{
          const img = document.createElement('img'); img.src = u; img.loading='lazy'; gallery.appendChild(img);
        });

      }catch(e){
        console.warn('Gallery load failed, using demo', e);
        DEMO_GALLERY.forEach(u=>{ const img=document.createElement('img'); img.src=u; img.loading='lazy'; gallery.appendChild(img); });
      }
    }

    // ---------- Student search from sheet ----------
    async function searchStudent(){
      const adm = document.getElementById('admission').value.trim();
      const out = document.getElementById('result');
      out.innerHTML = '';
      if(!adm){ out.innerHTML = '<div class="meta">Admission number डालें।</div>'; return; }
      try{
        const data = await fetchGviz(STUDENT_SHEET);
        const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
        const rows = (data.table.rows||[]).map(r=> r.c || []);
        const records = rows.map(cells=>{
          const obj={};
          for(let i=0;i<cols.length;i++){
            const cell=cells[i];
            let v='';
            if(cell){
              if(cell.v !== undefined) v=cell.v;
              else if(cell.f !== undefined) v=String(cell.f).replace(/<[^>]*>/g,'').trim();
            }
            obj[cols[i]||('col'+i)] = v;
          }
          return obj;
        });
        const rec = records.find(r=> String(r["Admission No."])===adm || String(r["Admission No."])===("0"+adm));
        if(!rec){ out.innerHTML = '<div class="meta">Student रिकॉर्ड नहीं मिला।</div>'; return; }
        out.innerHTML = `<div><strong>नाम:</strong> ${rec["Student Name"]||''}</div>
                         <div><strong>पिता:</strong> ${rec["Father Name"]||''}</div>
                         <div><strong>माता:</strong> ${rec["Mother Name"]||''}</div>
                         <div><strong>जन्मतिथि:</strong> ${rec["Date of Birth"]||''}</div>
                         <div><strong>कक्षा:</strong> ${rec["Class"]||''}</div>
                         <div><strong>पता:</strong> ${rec["Address"]||''}</div>
                         <div style="margin-top:8px"><a class='btn' href='https://script.google.com/macros/s/AKfycbySz9lSW1cwCcBWtAKOzknP6yWyawhgrETP-1EYaZ4-K8V-41Lg1GjdpLW0zA8sHX-G/exec?admission=${encodeURIComponent(adm)}' target='_blank'>Fee Portal</a>
                         <a class='btn' style="margin-left:6px" href='https://script.google.com/macros/s/AKfycbzmAK3rf7ah-4BDi5BEcZeu859kPWAthpPFgsMiCbM2Gp-Do0yuS7QpzucWRssZMwqLtA/exec?admission=${encodeURIComponent(adm)}' target='_blank'>Marksheet</a></div>`;
      }catch(e){
        console.error('Search error', e);
        out.innerHTML = '<div class="meta">डेटा लोड में समस्या — Console देखें।</div>';
      }
    }

    function printEmptyMarksheet(){ const w=window.open('','_blank'); w.document.write('<p>No data</p>'); w.document.close(); }

    // init
    (function(){ document.getElementById('year').innerText = new Date().getFullYear(); loadNotificationsFromSheet(); loadGalleryFromSheet(); })();
  </script>
</body>
</html>
