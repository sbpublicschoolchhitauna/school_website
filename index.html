<!doctype html>
<html lang="hi">
<head>

<!-- PWA REQUIRED -->
<link rel="manifest" href="manifest.json">

<script>
let deferredPrompt = null;

// PWA install availability
window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
});

// Student button click
document.addEventListener("click", async e => {
  const btn = e.target.closest("#studentInstallBtn");
  if (!btn) return;

  e.preventDefault();

  // STEP 1: Ask real browser permission
  if ("Notification" in window) {
    if (Notification.permission === "default") {
      const permission = await Notification.requestPermission();
      if (permission !== "granted") {
        alert("Permission allow ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§π‡•Ä App install ‡§π‡•ã‡§ó‡§æ");
        return;
      }
    }
  }

  // STEP 2: Show install popup
  if (deferredPrompt) {
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
  } else {
    alert(
      "Install popup ‡§Ö‡§≠‡•Ä Chrome ‡§®‡•á ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ.\n\n" +
      "Chrome ‡§ï‡•á 3 dots (‚ãÆ) ‚Üí Install App / Add to Home Screen ‡§ö‡•Å‡§®‡•á‡§Ç"
    );
  }
});
</script>


<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>S.B. Public School Chhitauna ‚Äî Student Portal</title>
<style>
:root{--accent:#0b5fa8;--accent2:#1167b1;--card:#fff;--muted:#54607a}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Arial,Segoe UI,Roboto,sans-serif;color:#0f172a;background:linear-gradient(180deg,#eaf4ff,#f7fbff)}
/* Centered header */
.header{
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#fff;text-align:center;padding:18px 12px;border-radius:0 0 14px 14px;
  box-shadow:0 6px 18px rgba(0,0,0,0.12); position:sticky; top:0; z-index:9999;
}
.header h1{margin:0;font-size:clamp(20px,4.5vw,30px);font-weight:800;letter-spacing:0.4px}
.header .meta{margin-top:6px;font-size:14px;opacity:0.95}
.header .meta small{display:block;font-size:13px;opacity:0.9;margin-top:4px}

/* horizontal strip under header */
.school-strip-outer{overflow:hidden;width:100%;margin-top:12px;padding-bottom:8px}
.school-strip{white-space:nowrap;display:flex;gap:18px;align-items:center;will-change:transform;transform:translateX(0)}
.school-chip{display:inline-block;font-weight:700;font-size:14px;background:rgba(255,255,255,0.06);padding:6px 12px;border-radius:8px}

/* main layout */
.container{max-width:1100px;margin:14px auto;padding:12px}
.grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:12px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 5px 18px rgba(0,0,0,0.06);margin-bottom:12px}
h2{margin:0;color:var(--accent);font-size:16px;margin-bottom:8px}
.small{color:var(--muted);font-size:13px}
.tabbar{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.tab{padding:8px 12px;border-radius:8px;background:#f1fbff;border:1px solid #d6ecff;color:var(--accent);cursor:pointer;font-weight:600}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border:0}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:8px 12px;border:0;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block}
.search-row{display:flex;gap:8px;margin-bottom:8px}
@media(max-width:640px){.search-row{flex-direction:column} .tabbar{gap:6px}}

/* tables */
.table-wrap{overflow:auto;border-radius:8px;border:1px solid #eef6ff;padding:6px;background:#fff;max-height:360px}
@media(max-width:900px){.table-wrap{max-height:300px}}
table{width:100%;border-collapse:collapse;font-size:13px;min-width:720px}
th,td{padding:8px 10px;border-bottom:1px solid #f1f7ff;text-align:left;vertical-align:middle}
thead th{background:#f5fbff;color:var(--accent);position:sticky;top:0;z-index:1}

/* notifications */
.notify-wrap{height:220px;overflow:hidden;position:relative;border-radius:8px}
.notify-list{position:absolute;left:0;right:0;top:0;will-change:transform}
.notify-item{padding:10px 12px;border-bottom:1px solid #eef4ff;background:#fff}
.notify-item .date{font-size:12px;color:var(--accent);font-weight:700}
.notify-item .text{font-size:14px;margin-top:4px}

/* footer */
.footer{ text-align:center;margin-top:12px;color:#555;font-size:13px}

/* ===== ADDED: Admission CTA styles (assistant injected) ===== */
.quick-apply-btn{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 16px;
  border-radius:12px;
  font-weight:900;
  text-decoration:none;
  color:#042033;
  background:linear-gradient(90deg,#fff8e6,#e7fbff);
  border:1px solid rgba(1,48,62,0.08);
  box-shadow:0 8px 30px rgba(3,19,43,0.08);
  transform:translateZ(0);
  transition:transform .18s ease, box-shadow .18s ease;
  position:relative;
  overflow:hidden;
}
.quick-apply-btn::before{
  content:'';
  position:absolute; inset:-30% -50%;
  background: linear-gradient(60deg, rgba(0,197,255,0.12), rgba(0,150,255,0.18), rgba(255,200,0,0.12));
  filter: blur(18px);
  opacity:0;
  transform: rotate(10deg) translateY(-6px);
  transition: opacity .35s ease, transform .6s ease;
}
.quick-apply-btn::after{
  content:'';
  position:absolute;
  left:50%; top:50%;
  width:120%; height:120%;
  transform:translate(-50%,-50%) scale(.9);
  border-radius:14px;
  box-shadow: 0 0 0 0 rgba(11,95,168,0.18);
  opacity:0;
}
.quick-apply-btn .cta-left{ font-size:14px; opacity:0.95; }
.quick-apply-btn .cta-main{ font-size:13px; color:#012032; }
.quick-apply-btn:hover, .quick-apply-btn:focus{
  transform: translateY(-4px) scale(1.01);
  box-shadow: 0 18px 44px rgba(3,19,43,0.16);
}
.quick-apply-btn:hover::before, .quick-apply-btn:focus::before{
  opacity:1;
  transform: rotate(0deg) translateY(0);
}
.quick-apply-btn:active{ transform: translateY(-2px) scale(.995); }
@keyframes ctaPulse {
  0% { box-shadow: 0 0 0 0 rgba(11,95,168,0.08); }
  50% { box-shadow: 0 0 36px 8px rgba(11,95,168,0.06); }
  100% { box-shadow: 0 0 0 0 rgba(11,95,168,0.00); }
}
.quick-apply-btn.idle-animate::after{
  animation: ctaPulse 2.8s ease-in-out infinite;
  opacity:1;
}
.admission-mini{ background:transparent;border:1px solid rgba(1,48,62,0.08); color:#0b5fa8; padding:8px 10px; border-radius:8px; font-weight:700; }
@media(max-width:640px){
  .quick-apply-btn{ width:100%; justify-content:center; padding:12px; }
  .quick-apply-btn .cta-main{ font-size:14px }
}

/* END ADMISSION CTA styles */
</style>

<style id="assistant-button-fix">
/* Make Quick Portals and Search buttons clearly visible */
a.btn[data-portal="true"], button.btn[data-portal="true"], button.btn.search-btn {
  background: #000 !important;
  color: #fff !important;
  border: 1px solid #000 !important;
  box-shadow: none !important;
}
/* Ensure slider controls remain light */
.slider-wrap .btn { background: rgba(255,255,255,0.9); color: #000; }
</style>

</head>

<body>
  <!-- CENTERED HEADER -->
  <div class="header" role="banner" aria-label="School header">
    <h1>S.B. PUBLIC SCHOOL</h1>
    <div class="meta">
      Village Chhitauna ¬∑ Post Meghauli Kala ¬∑ Pin Code 273305
      <small>Principal ‚Äî Mr. Gajendra Yadav Sir ¬∑ Call: +91 6389259200 ¬∑ Created By ‚Äî Upendra Vishwakarma</small>
    </div>

    <!-- horizontal strip populated from Notification sheet -->
    <div class="school-strip-outer" id="schoolStripOuter" aria-live="polite">
      <div id="schoolStrip" class="school-strip"></div>
    </div>
  </div>

<script>

/* üö´ HARD BLOCK FESTIVAL POPUP IF NO FESTIVAL */
document.addEventListener("DOMContentLoaded", () => {

  const overlay = document.getElementById("popupOverlay");
  if (!overlay) return;

  // üõë Default: popup ‡§ï‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§ñ‡•á
  overlay.style.display = "none";

  // ‚ùå Festival data ‡§π‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
  if (
    typeof window.todayFestivalTitle === "undefined" ||
    window.todayFestivalTitle === "" ||
    window.todayFestivalText === ""
  ) {
    console.log("‚úÖ No festival today ‚Äî popup fully disabled");
    return; // ‚õî STOP EVERYTHING
  }

  // ‚úÖ Festival ‡§π‡•à ‚Üí 11‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§¶ ‡§¶‡§ø‡§ñ‡•á
  setTimeout(() => {

    overlay.style.display = "flex";

    // üé§ Voice
    if (window.speechSynthesis && window.todayFestivalVoice) {
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(window.todayFestivalVoice);
      u.lang = "hi-IN";
      speechSynthesis.speak(u);
    }

  }, 11000);
});
</script>


<audio id="festivalMusic" loop>
  <source src="festival-music.mp3" type="audio/mpeg">
</audio>

<!-- üéÜ FESTIVAL ANIMATION LAYER -->
<div id="festivalAnimationLayer"></div>

  <!-- ====== ADMISSION TICKER (premium, eye-friendly gradient, multiple rotating messages) ====== -->
  <style>
  /* Eye-friendly soft blue-cyan gradient, subtle 3D */
  .admission-news-bar{
    width:100%;
    background:linear-gradient(90deg,#9be7ff,#c7f9ff);
    color:#03314b;
    padding:12px 0;
    font-weight:800;
    font-size:16px;
    overflow:hidden;
    position:relative;
    border-radius:10px;
    margin:14px auto;
    max-width:1100px;
    box-shadow:0 10px 26px rgba(3,19,43,0.10), inset 0 -4px 14px rgba(0,0,0,0.03);
    transform:translateZ(0);
    perspective:800px;
  }
  .admission-news-inner{
    position:relative;
    transform-origin:center;
    transform: translateZ(0) rotateX(0.3deg);
    max-width:calc(100% - 28px);
    margin:0 14px;
  }
  .admission-news-text{
    display:inline-block;
    white-space:nowrap;
    padding-left:1rem;
    will-change:transform,opacity;
    color:#012032;
    font-weight:800;
  }
  .admission-news-ghost{
    position:absolute;inset:0;pointer-events:none;mix-blend-mode:overlay;opacity:0.06;
    background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,0.6) 50%,transparent 100%);
  }
  .admission-news-meta{
    display:flex;align-items:center;gap:12px;overflow:hidden;padding:0 4px;
  }
  .admission-tag{
    background:rgba(1,48,62,0.06);padding:6px 10px;border-radius:999px;font-weight:900;font-size:13px;border:1px solid rgba(1,48,62,0.04);color:#012032;
  }
  @media(max-width:640px){ .admission-news-bar{font-size:14px;padding:10px 0} .admission-tag{display:none} }
  </style>

  <div class="admission-news-bar" role="region" aria-label="Admission news ticker" tabindex="0" id="admissionTickerWrap">
    <div class="admission-news-inner">
      <div class="admission-news-meta">
        <div class="admission-tag">üì¢ ADMISSION</div>
        <div class="admission-news-text" id="admissionNewsText" aria-live="polite"></div>
      </div>
      <div class="admission-news-ghost" aria-hidden="true"></div>
    </div>
  </div>

  <!-- START: Inserted Photo Slider (existing slider code kept as-is) -->
  <!doctype html>
  <html lang="hi">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SB Public School ‚Äî Photo Slider (Fade, Auto-height)</title>
  <style>
  :root{--accent:#0ea5a4;--bg:#fbfdff;--text:#0f1724}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  .slider-wrap{max-width:1100px;margin:20px auto;position:relative;border-radius:12px;overflow:visible}
  .slider{position:relative;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(16,24,40,0.08);background:#000;transition:height .45s ease}
  .slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .8s ease;will-change:opacity;pointer-events:none}
  .slide.active{opacity:1;pointer-events:auto}
  .slide img{width:100%;height:auto;display:block;object-fit:cover}
  /* controls */
  .controls{position:absolute;left:12px;right:12px;top:50%;transform:translateY(-50%);display:flex;justify-content:space-between;pointer-events:none}
  .slider-wrap .btn{background:rgba(255,255,255,0.9);border:0;padding:10px;border-radius:999px;cursor:pointer;pointer-events:auto;box-shadow:0 6px 18px rgba(2,6,23,0.12)}
  .dots{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;display:flex;gap:8px;pointer-events:auto}
  .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.8);cursor:pointer;opacity:0.8}
  .dot.active{background:var(--accent);transform:scale(1.2);opacity:1}
  .slider-wrap .play-toggle{position:absolute;right:16px;top:16px;background:rgba(255,255,255,0.95);padding:8px;border-radius:8px;border:0;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,0.08)}
  @media(max-width:600px){ .slider-wrap{margin:12px} .btn{padding:8px} }
  </style>
  <style id="assistant-button-fix">
  a.btn[data-portal="true"], button.btn[data-portal="true"], button.btn.search-btn {
    background: #000 !important;
    color: #fff !important;
    border: 1px solid #black !important;
    box-shadow: none !important;
  }
  .slider-wrap .btn { background: rgba(255,255,255,0.9); color: #000; }
  </style>
  </head>
  <body>
  <div class="slider-wrap" id="sliderWrap" aria-label="School photo slider (fade)">
    <button class="play-toggle" id="playToggle" aria-pressed="false">Pause</button>
    <div class="slider" id="slider" role="region" aria-roledescription="carousel"></div>
    <div class="controls">
      <button class="btn slider-control" id="prev" aria-label="Previous">‚Äπ</button>
      <button class="btn slider-control" id="next" aria-label="Next">‚Ä∫</button>
    </div>
    <div class="dots" id="dots" role="tablist" aria-label="Slide dots"></div>
  </div>

  <script>
  // IMAGES will be loaded dynamically: try /api/images (server), then images.json (static), then fallback to embedded list
  async function loadImagesDynamic(){
    try{ const res = await fetch('/api/images'); if(res.ok){ const j = await res.json(); if(Array.isArray(j.images) && j.images.length) return j.images; } }catch(e){}
    try{ const res2 = await fetch('images.json'); if(res2.ok){ const j2 = await res2.json(); if(Array.isArray(j2.images) && j2.images.length) return j2.images; } }catch(e){}
    return [
      'slider_images/20251127_154340.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.37_c4bd2e68.jpg',
      'slider_images/WhatsApp Image 2025-10-30 at 19.36.04_e42049db.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.39_5f42559c.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.38_3193ced1.jpg',
      'slider_images/WhatsApp Image 2025-10-30 at 19.35.04_d1684284.jpg',
      'slider_images/WhatsApp Image 2025-10-30 at 19.36.05_6d3a2a2d.jpg',
      'slider_images/WhatsApp Image 2025-10-30 at 19.36.04_66cb599d.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.48_b61cc87d.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.47_3953b4e7.jpg',
      'slider_images/WhatsApp Image 2024-09-09 at 11.13.17_4b384d82.jpg',
      'slider_images/WhatsApp Image 2024-09-09 at 11.13.16_040cf6d0.jpg',
      'slider_images/logo.jpg',
    ];
  }

  let IMAGES = []; // will be populated shortly

  (async function(){
    IMAGES = await loadImagesDynamic();
    if(typeof createSlides === 'function') createSlides();
    if(typeof start === 'function') start();
  })();

  const slider = document.getElementById('slider');
  const sliderWrap = document.getElementById('sliderWrap');
  const dotsWrap = document.getElementById('dots');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const playToggle = document.getElementById('playToggle');

  let slides = [];
  let index = 0;
  let timer = null;
  let interval = 4000; // autoplay interval

  function createSlides(){
    IMAGES.forEach((src,i)=>{
      const s = document.createElement('div');
      s.className = 'slide';
      s.setAttribute('role','group');
      s.setAttribute('aria-roledescription','slide');
      s.setAttribute('aria-label', `Slide ${i+1} of ${IMAGES.length}`);
      const img = document.createElement('img');
      img.src = src;
      img.alt = `School photo ${i+1}`;
      img.addEventListener('load', ()=>{
        if(i===index) adjustHeightTo(img);
      });
      s.appendChild(img);
      slider.appendChild(s);
      slides.push(s);

      const d = document.createElement('button');
      d.className = 'dot';
      d.setAttribute('aria-label', 'Go to slide ' + (i+1));
      d.addEventListener('click', ()=>{ pause(); goTo(i); });
      dotsWrap.appendChild(d);
    });
    if(slides[0]) slides[0].classList.add('active');
    updateDots();
    setTimeout(()=>{ const img = slides[0].querySelector('img'); if(img && img.complete) adjustHeightTo(img); }, 300);
  }

  function adjustHeightTo(img){
    const wrapWidth = slider.clientWidth || sliderWrap.clientWidth;
    if(!img.naturalWidth) return;
    const h = Math.round((img.naturalHeight / img.naturalWidth) * wrapWidth);
    const maxH = Math.round(window.innerHeight * 0.65);
    const finalH = Math.min(h, maxH);
    slider.style.height = finalH + 'px';
  }

  function goTo(i){
    index = (i + slides.length) % slides.length;
    slides.forEach((s, idx)=> s.classList.toggle('active', idx===index));
    updateDots();
    const img = slides[index].querySelector('img');
    if(img && img.complete) adjustHeightTo(img);
    else if(img) img.addEventListener('load', ()=> adjustHeightTo(img), { once:true });
  }

  function nextSlide(){ goTo(index+1); }
  function prevSlide(){ goTo(index-1); }

  function updateDots(){
    const dots = dotsWrap.children;
    for(let i=0;i<dots.length;i++){ dots[i].classList.toggle('active', i===index); }
  }

  function start(){ if(timer) clearInterval(timer); timer = setInterval(nextSlide, interval); playToggle.textContent = 'Pause'; playToggle.setAttribute('aria-pressed','false'); }
  function pause(){ if(timer) clearInterval(timer); timer = null; playToggle.textContent = 'Play'; playToggle.setAttribute('aria-pressed','true'); }

  nextBtn.addEventListener('click', ()=>{ pause(); nextSlide(); });
  prevBtn.addEventListener('click', ()=>{ pause(); prevSlide(); });
  playToggle.addEventListener('click', ()=>{ if(timer) pause(); else start(); });

  document.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight'){ pause(); nextSlide(); } else if(e.key==='ArrowLeft'){ pause(); prevSlide(); } });

  let startX=0;
  slider.addEventListener('touchstart', e=> startX = e.touches[0].clientX);
  slider.addEventListener('touchend', e=> { const dx = e.changedTouches[0].clientX - startX; if(Math.abs(dx)>40){ pause(); if(dx<0) nextSlide(); else prevSlide(); } });

  let resizeDeb;
  window.addEventListener('resize', ()=>{ clearTimeout(resizeDeb); resizeDeb = setTimeout(()=>{ const img = slides[index] && slides[index].querySelector('img'); if(img && img.complete) adjustHeightTo(img); }, 120); });

  createSlides();
  start();
  </script>
  





</body>
  </html>
  <!-- END: Inserted Photo Slider -->

<div class="container">
    <div class="grid">
      <div>

<div class="card">
  <h2>Notifications</h2>
  <div id="notifyOuter" class="notify-wrap" aria-live="polite">
    <div id="notifs" class="notify-list"></div>
  </div>
</div>

        <!-- QUICK PORTALS moved to TOP -->
        <div class="card">
          <h2>Quick Portals</h2>
          <div style="margin-top:8px">
  <!-- START: 3D Animated Quick Portals (merged by assistant) -->
  <style>
  /* 3D container */
  .qp-3d-wrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap;perspective:1200px;margin-top:10px}
  .qp-3d{--w:160px;display:inline-flex;align-items:center;justify-content:center;gap:10px;width:var(--w);min-width:120px;padding:12px 14px;border-radius:14px;font-weight:800;color:#fff;text-decoration:none;transform-style:preserve-3d;transition:transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .28s ease;will-change:transform;position:relative;border:0;cursor:pointer}
  .qp-3d .face{position:relative;z-index:2;transform: translateZ(18px);display:inline-flex;align-items:center;gap:8px}
  .qp-3d::before{content:'';position:absolute;inset:0;z-index:1;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(0,0,0,0.04));pointer-events:none}
  .qp-3d::after{content:'';position:absolute;inset:0;border-radius:14px;z-index:0;filter: blur(14px);opacity:.55;transition: opacity .28s ease, transform .28s ease}
  .fee-3d{background: linear-gradient(135deg,#0b5fa8,#1274d1);box-shadow: 0 18px 40px rgba(11,95,168,0.22)}
  .fee-3d::after{background: linear-gradient(90deg, rgba(11,95,168,0.28), rgba(6,129,212,0.12));transform: translateY(6px) scale(1.02)}
  @keyframes feeTilt{0%{transform: rotateX(3deg) rotateY(-6deg)}50%{transform: rotateX(4deg) rotateY(6deg)}100%{transform: rotateX(3deg) rotateY(-6deg)}}
  .fee-3d.idle{animation: feeTilt 6.8s ease-in-out infinite}
  .fee-3d:hover{transform: translateY(-8px) rotateX(6deg) rotateY(12deg) scale(1.02);box-shadow:0 34px 64px rgba(11,95,168,0.30)}
  .marksheet-3d{background: linear-gradient(135deg,#10b981,#06d6a0);box-shadow: 0 16px 36px rgba(6,129,80,0.18)}
  .marksheet-3d::after{background: linear-gradient(90deg, rgba(6,129,80,0.2), rgba(12,200,150,0.10));transform: translateY(6px) scale(1.02)}
  @keyframes markFloat{0%{transform: translateY(0px)}50%{transform: translateY(-8px) translateZ(10px)}100%{transform: translateY(0px)}}
  .marksheet-3d.idle{animation: markFloat 4.2s ease-in-out infinite}
  .marksheet-3d:hover{transform: translateY(-10px) scale(1.02);box-shadow:0 30px 54px rgba(6,129,80,0.26)}
  .teacher-3d{background: linear-gradient(135deg,#7b2ff7,#9d4bff);box-shadow: 0 12px 28px rgba(135,60,255,0.18)}
  .teacher-3d::after{background: linear-gradient(90deg, rgba(135,60,255,0.22), rgba(157,75,255,0.10));transform: translateY(6px) scale(1.02)}
  @keyframes teacherPulse{0%{transform: scale(1)}50%{transform: scale(1.03)}100%{transform: scale(1)}}
  .teacher-3d.idle{animation: teacherPulse 3.6s ease-in-out infinite}
  .teacher-3d:hover{transform: translateY(-10px) scale(1.04);box-shadow:0 36px 86px rgba(157,75,255,0.32)}
  .qp-3d .ico{font-size:18px;display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:8px;background: rgba(255,255,255,0.08)}
  @media(max-width:640px){.qp-3d{width:100%}}
  </style>

  <div class="qp-3d-wrap">
    <a class="qp-3d fee-3d idle" href="https://script.google.com/macros/s/AKfycbySz9lSW1cwCcBWtAKOzknP6yWyawhgrETP-1EYaZ4-K8V-41Lg1GjdpLW0zA8sHX-G/exec" target="_blank" rel="noopener">
      <span class="face"><span class="ico">üí≥</span>Fee Portal</span>
    </a>

    <a class="qp-3d marksheet-3d idle" href="https://script.google.com/macros/s/AKfycbyk8pBIRWCYRT-ez9EWwxwGp1xsHDvZIACZi7xqNcZxAwftooAs05aU327gM4Bx0tc8FA/exec" target="_blank" rel="noopener">
      <span class="face"><span class="ico">üìÑ</span>Marksheet</span>
    </a>

    <a class="qp-3d teacher-3d idle" href="https://script.google.com/macros/s/AKfycbz0ZXmaec5FRsJjn3HMeJpqd9y3ZfBPDxKQpb9hPjRp7bqeG471Wb9wr32oc3IajaTyFQ/exec" target="_blank" rel="noopener">
      <span class="face"><span class="ico">üë®‚Äçüè´</span>Teacher Login</span>
    </a>
  </div>

<button
  id="studentInstallBtn"
  class="qp-3d student-3d idle"
  type="button"
>
  <span class="face">
    <span class="ico">üéì</span>
    Student App
  </span>
</button>

<button
  id="helpLineBtn"
  class="qp-3d marksheet-3d idle"
  type="button">
  <span class="face">
    <span class="ico">üìû</span>
    Help Line
  </span>
</button>


<button
  id="openPayment"
  class="qp-3d fee-3d idle"
  type="button">
  <span class="face">
    <span class="ico">üí≥</span>
    Online Payment
  </span>
</button>

  <!-- START: Quick Portals + Video column (inserted) -->
  <style>
  /* Quick portals + video side-by-side container */
  .portal-with-video{{ display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap; }}
  .portal-with-video .qp-3d-wrap{{ flex: 1 1 320px; min-width:220px; }}
  .portal-video-box{{ flex: 0 0 380px; min-width:260px; max-width:420px; border-radius:12px; overflow:hidden; background:#fff; box-shadow:0 8px 30px rgba(2,6,23,0.06); padding:10px; }}
  .portal-video-box h3{{ margin:0 0 8px; font-size:15px; color: #0b5fa8; }}
  .portal-video-box video{{ width:100%; height:auto; display:block; border-radius:8px; background:#000; }}
  .pv-playlist{{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }}
  .pv-item{{ flex: 1 1 90px; min-width:80px; background:#f6fbff; border:1px solid #eef9ff; padding:8px; border-radius:8px; cursor:pointer; font-size:13px; text-align:center; }}
  .pv-item.active{{ outline:3px solid rgba(11,95,168,0.12); box-shadow:0 8px 26px rgba(11,95,168,0.06); background:#ffffff; }}
  @media(max-width:900px){{ .portal-with-video{{flex-direction:column}} .portal-video-box{{width:100%}} }}
  </style>

  <div class="portal-with-video" aria-hidden="false">
    <!-- keep existing Quick Portals block (the qp-3d-wrap exists just before this insertion point) -->
    <!-- VIDEO BOX -->
    <div class="portal-video-box" id="portalVideoBox" aria-label="Quick Portals Video Player">
      <h3>S.B. PUBLIC SCHOOL Game Activities</h3>
<div class="video-slider">
  <video id="qpMainVideo"
         controls
         muted
         playsinline
         preload="metadata">
  </video>
</div>
      <div class="pv-playlist" id="pvPlaylist" aria-label="Video playlist">
        <!-- playlist items injected by JS -->
      </div>
    </div>
  </div>
  <!-- END: Quick Portals + Video column -->
<script>
(async function(){
  const base = 'slider_videos/';
  const videoEl = document.getElementById('qpMainVideo');
  const listWrap = document.getElementById('pvPlaylist');
  let playlist = [];

  async function loadVideos(){
    try{
      const res = await fetch('videos.json');
      const data = await res.json();
      if(Array.isArray(data.videos)) return data.videos;
    }catch(e){
      console.error('videos.json load failed', e);
    }
    return [];
  }

  function makeItem(name, idx){
    const d = document.createElement('div');
    d.className = 'pv-item';
       d.innerHTML = '‚ñ∂';
       d.style.fontSize = '0';
       d.style.height = '8px';
    d.onclick = ()=> play(idx);
    return d;
  }

  function play(i){
    const src = base + playlist[i];
    videoEl.pause();
    videoEl.innerHTML = '';
    const s = document.createElement('source');
    s.src = src;
    s.type = 'video/mp4';
    videoEl.appendChild(s);
    videoEl.load();
    videoEl.muted = true;
    videoEl.play().catch(()=>{});

    [...listWrap.children].forEach((el,idx)=>{
      el.classList.toggle('active', idx===i);
    });
  }

  playlist = await loadVideos();
  if(!playlist.length){
    listWrap.innerHTML = '<div style="color:#999">No videos found</div>';
    return;
  }

  playlist.forEach((v,i)=>{
    listWrap.appendChild(makeItem(v,i));
  });

  play(0);

  videoEl.addEventListener('ended', ()=>{
    let cur = [...listWrap.children].findIndex(x=>x.classList.contains('active'));
    play((cur+1) % playlist.length);
  });
})();
</script>


  <script>(function(){try{const mq=window.matchMedia('(prefers-reduced-motion: reduce)');if(mq&&mq.matches){document.querySelectorAll('.idle').forEach(x=>x.classList.remove('idle'))}}catch(e){}})();</script>
  <!-- END: 3D Animated Quick Portals -->
  <!-- ===== ADMISSION CTA inserted by assistant (ready-to-use) ===== -->
  <div style="display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap">
    <a class="btn quick-apply-btn" id="admissionApplyBtn"
       href="https://script.google.com/macros/s/AKfycby9g3PFa5A_SgDDT3yIMIEn8oZsyfEZxqCEblrEJmWtTy1OXzzS3Qbi6uQxqTN8GZB25A/exec"
       target="_blank" rel="noopener noreferrer" aria-label="Admission ‚Äî Apply Now">
      <span class="cta-left">üì¢ ADMISSION</span>
      <span class="cta-main">ADMISSION OPEN ‚Äî APPLY NOW</span>
    </a>

    <button class="btn admission-mini" id="admissionInfoBtn" aria-label="Admission info">Quick Info</button>
  </div>
  <!-- ===== end ADMISSION CTA ===== -->

</div>
        </div>

      <div>
        <div class="card">
          <h2>Student Details Lookup</h2>
          <div class="small">Admission Number ‡§°‡§æ‡§≤‡§ï‡§∞ Search ‡§ï‡§∞‡•á‡§Ç</div>
          <div style="margin-top:8px" class="search-row">
            <input id="admission" placeholder="Enter Admission Number" style="flex:1;padding:8px;border-radius:8px;border:1px solid #dce6f7">
            <button class="btn search-btn" data-portal="true" onclick="searchStudent()">Search</button>
          </div>
          <div id="result"></div>
        </div>

        <div class="card">
          <h2>Student Records</h2>
          <div class="small">‡§ü‡•à‡§¨ ‡§¨‡§¶‡§≤ ‡§ï‡§∞ Fee ‡§Ø‡§æ Marksheet ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Äî Mobile/Aadhar masked (last 4)‡•§</div>
          <div class="tabbar" role="tablist">
            <button class="tab active" id="tabFee" onclick="showTab('fee')">Fee Student Details</button>
            <button class="tab" id="tabMarks" onclick="showTab('marks')">Marksheet Details</button>
          </div>
          <div id="feeContainer" class="table-wrap" style="display:block">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
          <div id="marksContainer" class="table-wrap" style="display:none;margin-top:10px">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
        </div>
      </div>

      <div>

<!-- üéÇ Birthday Box (Footer ‡§ï‡•á ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ) -->

<div id="birthdayScrollBox">
  <h3>üéâ Today Birthday üéÇ</h3>
  <div class="birthday-scroll">
    <div id="birthdayScrollInner" class="birthday-scroll-inner"></div>
  </div>
</div>
 
        </div>
      </div>
    </div>

    <div class="footer">¬© <span id="year"></span> S.B. PUBLIC SCHOOL ‚Äî All Rights Reserved</div>
  </div>

<script>
/* CONFIG */
const SHEET_ID = "1BtoDja9imrMyHMKt5oqSYoOzj9w2GWe13JcbRu1vWO8";
const NOTIF_SPEED = 0.45;
const HEADER_SPEED = 0.6;

/* HELPERS */
function escapeHtml(s){ if(s===null||s===undefined) return ""; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
async function loadSheetGviz(sheetName){
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(sheetName)}&tqx=out:json`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('Network response not ok: ' + res.status);
  const text = await res.text();
  const jsonText = text.replace(/^[^{]*/,'').replace(/\);\s*$/,'');
  return JSON.parse(jsonText);
}
function maskLast4(val){
  if(val===null||val===undefined) return "";
  const s = String(val).trim();
  const digits = s.replace(/\D/g,'');
  if(digits.length === 0) return '';
  const last4 = digits.slice(-4);
  return '****' + last4;
}
function isMobileHeader(h){ return /mobile|phone|contact|mob/i.test(h); }
function isAadharHeader(h){ return /aadhar|aadhaar|uid/i.test(h); }

/* TABLE RENDER */
function renderTableTo(containerId, gvizJson){
  const cols = (gvizJson.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
  const rows = (gvizJson.table.rows||[]).map(r=> r.c || []);
  const wrap = document.getElementById(containerId);
  if(rows.length === 0){
    wrap.innerHTML = "<div style='padding:12px;color:#666'>‡§ï‡•ã‡§à ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</div>";
    return;
  }
  const table = document.createElement('table');
  const thead = document.createElement('thead');
  const trh = document.createElement('tr');
  cols.forEach(h=>{
    const th = document.createElement('th');
    th.innerText = h || '';
    trh.appendChild(th);
  });
  thead.appendChild(trh);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  rows.forEach(r=>{
    const tr = document.createElement('tr');
    for(let i=0;i<cols.length;i++){
      const cell = r[i];
      let v = "";
      if(cell){
        if(cell.f !== undefined && String(cell.f).trim()!=='') v = String(cell.f).replace(/<[^>]*>/g,'').trim();
        else if(cell.v !== undefined) v = cell.v;
      }
      const header = cols[i]||'';
      if(isMobileHeader(header)) v = maskLast4(v);
      if(isAadharHeader(header)) v = maskLast4(v);
      const td = document.createElement('td');
      td.innerText = v;
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  wrap.innerHTML = "";
  wrap.appendChild(table);
}

/* TABS */
function showTab(name){
  document.getElementById('feeContainer').style.display = name==='fee' ? 'block' : 'none';
  document.getElementById('marksContainer').style.display = name==='marks' ? 'block' : 'none';
  document.getElementById('tabFee').classList.toggle('active', name==='fee');
  document.getElementById('tabMarks').classList.toggle('active', name==='marks');
}

/* SEARCH */
async function searchStudent(){
  const adm = document.getElementById("admission").value.trim();
  if(!adm) return alert("Admission Number ‡§°‡§æ‡§≤‡•á‡§Ç");
  try{
    const data = await loadSheetGviz("Student's Details");
    const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
    const rows = (data.table.rows||[]).map(r=> r.c || []);
    const records = rows.map(cells=>{
      const obj = {};
      for(let i=0;i<cols.length;i++){
        const cell = cells[i];
        let v = "";
        if(cell){
          if(cell.v !== undefined) v = cell.v;
          else if(cell.f !== undefined) v = String(cell.f).replace(/<[^>]*>/g,'').trim();
        }
        obj[cols[i]||('col'+i)] = v;
      }
      return obj;
    });

    const admKeys = ["Admission No.","Adm. No.","Admission Number","Adm No","Admission No"];
    const rec = records.find(r => admKeys.some(k=> String((r[k]||'')).trim() === adm || String((r[k]||'')).trim() === ("0"+adm)));
    const out = document.getElementById("result");
    out.style.display = 'block';
    if(!rec){
      out.innerHTML = "<div style='padding:12px;background:#fff;border-radius:8px;border:1px solid #f1f7ff'>No details found for this Admission Number.</div>";
      return;
    }
// üî¥ DIRECT CONFIRM (NO EXTRA FILE)
const studentName =
  rec["Student Name"] || rec["Name"] || rec["StudentName"];

const studentClass = rec["Class"] || "";

if(studentName){
  const ok = confirm(
    "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Ø‡§π‡•Ä ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§π‡•à‡§Ç?\n\n" +
    "‡§®‡§æ‡§Æ: " + studentName + "\n" +
    "Class: " + studentClass
  );

  if(ok){
    // ‚úÖ ‡§∏‡§π‡•Ä ‡§õ‡§æ‡§§‡•ç‡§∞
    localStorage.studentName = studentName;
  }else{
    // ‚ùå ‡§ó‡§≤‡§§ ‡§õ‡§æ‡§§‡•ç‡§∞
    localStorage.removeItem("studentName");
  }
}

// üéÇ DOB SAVE (Birthday / Age ‡§ï‡•á ‡§≤‡§ø‡§è)
localStorage.studentDOB_FULL =
  rec["Date of Birth"] || rec["DOB"];

    const fields = ["Student Name","Father Name","Mother Name","Date of Birth","Class","Address"];
    let html = '<div style="padding:10px;border-radius:8px;background:#fff;border:1px solid #eef6ff">';
    fields.forEach(f=>{
      html += `<div style="margin-bottom:8px"><strong>${f}:</strong> ${escapeHtml(rec[f]||'')}</div>`;
    });
    html += '</div>';
    out.innerHTML = html;

  }catch(e){
    console.error("Search error", e);
    alert("Search ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‚Äî console ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§");
  }
}

/* NOTIFICATIONS vertical scroll */
let notifRAF = null;
let notifPos = 0;
function startNotifScroll(){
  const wrap = document.getElementById('notifs');
  if(!wrap) return;
  cancelAnimationFrame(notifRAF);
  function step(){
    notifPos -= NOTIF_SPEED;
    const half = wrap.scrollHeight/2 || 0;
    if(Math.abs(notifPos) >= half) notifPos = 0;
    wrap.style.transform = `translateY(${notifPos}px)`;
    notifRAF = requestAnimationFrame(step);
  }
  step();
}
function stopNotifScroll(){ if(notifRAF) cancelAnimationFrame(notifRAF); notifRAF = null; }

/* HEADER horizontal scroll */
let headerRAF = null;
let headerPos = 0;
function startHeaderScroll(){
  const strip = document.getElementById('schoolStrip');
  if(!strip) return;
  cancelAnimationFrame(headerRAF);
  function step(){
    headerPos -= HEADER_SPEED;
    const half = strip.scrollWidth/2 || 0;
    if(Math.abs(headerPos) >= half) headerPos = 0;
    strip.style.transform = `translateX(${headerPos}px)`;
    headerRAF = requestAnimationFrame(step);
  }
  step();
}
function stopHeaderScroll(){ if(headerRAF) cancelAnimationFrame(headerRAF); headerRAF = null; }

/* Build header strip from Notification sheet */
async function buildStripFromNotifications(){
  try{
    const data = await loadSheetGviz("Notification");
    const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
    const rows = (data.table.rows||[]).map(r=> r.c || []);
    const textKey = cols.find(k=>/notif|notification|text|message|note|description/i.test(k)) || cols[1] || cols[0] || 'Notification';
    const dateKey = cols.find(k=>/date|day|time/i.test(k)) || cols[0] || 'Date';
    const strip = document.getElementById('schoolStrip');
    strip.innerHTML = "";
    const items = [];
    rows.forEach(cells=>{
      const obj = {};
      for(let i=0;i<cols.length;i++){
        const cell = cells[i];
        let v = "";
        if(cell){
          if(cell.v !== undefined) v = cell.v;
          else if(cell.f !== undefined) v = String(cell.f).replace(/<[^>]*>/g,'').trim();
        }
        obj[cols[i]] = v;
      }
      const t = obj[textKey] || '';
      const d = obj[dateKey] || '';
      if(t || d) items.push({date: d, text: t});
    });
    if(items.length === 0){
      const span = document.createElement('div'); span.className='school-chip'; span.innerText = 'No notifications to show.'; strip.appendChild(span); return;
    }
    function makeChip(it){
      const txt = (it.date ? (it.date + ' - ') : '') + it.text;
      const short = txt.length > 120 ? txt.slice(0,117)+'...' : txt;
      const span=document.createElement('div');
      span.className='school-chip';
      span.title = txt;
      span.innerText = short;
      return span;
    }
    items.forEach(it=> strip.appendChild(makeChip(it)));
    items.forEach(it=> strip.appendChild(makeChip(it)));
    startHeaderScroll();
    const outer = document.getElementById('schoolStripOuter');
    outer.addEventListener('mouseenter', stopHeaderScroll);
    outer.addEventListener('mouseleave', startHeaderScroll);
  }catch(e){
    console.error('Strip build error', e);
    const strip = document.getElementById('schoolStrip');
    strip.innerHTML = '<div class="school-chip">Unable to load header notifications ‚Äî check sheet name and sharing.</div>';
  }
}

/* load notifications vertical */
async function loadNotifications(){
  try{
    const data = await loadSheetGviz("Notification");
    const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
    const rows = (data.table.rows||[]).map(r=> r.c || []);
    const textKey = cols.find(k=>/notif|notification|text|message|note|description/i.test(k)) || cols[1] || cols[0] || 'Notification';
    const dateKey = cols.find(k=>/date|day|time/i.test(k)) || cols[0] || 'Date';
    const wrap = document.getElementById('notifs');
    wrap.innerHTML = "";
    rows.forEach(cells=>{
      const obj = {};
      for(let i=0;i<cols.length;i++){
        const cell = cells[i];
        let v = "";
        if(cell){
          if(cell.v !== undefined) v = cell.v;
          else if(cell.f !== undefined) v = String(cell.f).replace(/<[^>]*>/g,'').trim();
        }
        obj[cols[i]] = v;
      }
      const d = obj[dateKey] || '';
      const t = obj[textKey] || '';
      const node = document.createElement('div');
      node.className = 'notify-item';
      node.innerHTML = `<div class="date">${escapeHtml(d)}</div><div class="text">${escapeHtml(t)}</div>`;
      wrap.appendChild(node);
    });
    const orig = wrap.children.length;
    for(let i=0;i<orig;i++){ wrap.appendChild(wrap.children[i].cloneNode(true)); }
    startNotifScroll();
    const outer = document.getElementById('notifyOuter');
    outer.addEventListener('mouseenter', stopNotifScroll);
    outer.addEventListener('mouseleave', startNotifScroll);
  }catch(e){
    console.error('Notification load error', e);
    document.getElementById('notifs').innerHTML = '<div style="padding:12px;color:#c33">Notification ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§è ‚Äî sheet ‡§®‡§æ‡§Æ ‡§î‡§∞ sharing ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>';
  }
}

/* load fee and marks */
async function loadFeeAndMarks(){
  try{
    const feeJson = await loadSheetGviz("Fee Student Details");
    renderTableTo("feeContainer", feeJson);
  }catch(e){
    console.error(e);
    document.getElementById("feeContainer").innerHTML = "<div style='padding:12px;color:#c33'>Fee Student Details ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§è ‚Äî sheet ‡§®‡§æ‡§Æ ‡§î‡§∞ sharing ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>";
  }
  try{
    const marksJson = await loadSheetGviz("Marksheet Details");
    renderTableTo("marksContainer", marksJson);
  }catch(e){
    console.error(e);
    document.getElementById("marksContainer").innerHTML = "<div style='padding:12px;color:#c33'>Marksheet Details ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§è ‚Äî sheet ‡§®‡§æ‡§Æ ‡§î‡§∞ sharing ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>";
  }
}

/* INIT */
document.getElementById("year").innerText = new Date().getFullYear();
showTab('fee');
buildStripFromNotifications();
loadNotifications();
loadFeeAndMarks();
</script>


<!-- ====== Admission ticker JS (placed at end to ensure DOM exists) ====== -->
<script>
(function(){
  const NEWS = [
    'ADMISSION OPEN ‚Äì APRIL 2026-27 ¬∑ Nursery to Class 10 ¬∑ Limited Seats ‚Äî Apply Now',
    'Registration: Mon‚ÄìSat 9:00 AM ‚Äì 3:10 PM ¬∑ Documents: Birth Certificate, Aadhar (if any)',
    'Special Scholarship for Meritorious Students ‚Äî Contact Principal Office',
    'School Timings: 9:00 AM ‚Äì 3:10 PM ¬∑ Transport Available ¬∑ Call +91 6389259200'
  ];
  const el = document.getElementById('admissionNewsText');
  if(!el) return;
  let idx = 0;

  function startMessage(i){
    const msg = NEWS[i];
    el.textContent = msg + ' \u00A0 \u00A0 \u00A0 ' + msg; // repeat for smooth scroll
    void el.offsetWidth;
    const containerWidth = el.parentElement.clientWidth || 600;
    const textWidth = Math.max(el.scrollWidth / 2, 200);
    const baseMs = 14000;
    const pxFactor = 9;
    const duration = Math.max(9000, Math.round(baseMs + (textWidth * pxFactor)));

    el.style.transition = 'none';
    el.style.transform = `translateX(${containerWidth}px)`;

    requestAnimationFrame(()=>{
      requestAnimationFrame(()=>{
        el.style.transition = `transform ${duration}ms linear`;
        el.style.transform = `translateX(-${textWidth}px)`;
      });
    });

    clearTimeout(el._nextTimeout);
    el._nextTimeout = setTimeout(()=>{
      idx = (i + 1) % NEWS.length;
      setTimeout(()=> startMessage(idx), 700);
    }, duration + 200);
  }

  // pause/resume on hover or focus
  const wrap = document.getElementById('admissionTickerWrap');
  function pauseTicker(){
    const style = window.getComputedStyle(el);
    const matrix = style.transform || style.webkitTransform || '';
    let tx = 0;
    if(matrix && matrix !== 'none'){
      try{
        const vals = matrix.match(/matrix\(([^)]+)\)/);
        if(vals){ const parts = vals[1].split(','); tx = parseFloat(parts[4]); }
      }catch(e){}
    }
    el.style.transition = 'none';
    el.style.transform = `translateX(${tx}px)`;
    clearTimeout(el._nextTimeout);
  }
  function resumeTicker(){ startMessage(idx); }

  wrap.addEventListener('mouseenter', pauseTicker);
  wrap.addEventListener('focusin', pauseTicker);
  wrap.addEventListener('mouseleave', resumeTicker);
  wrap.addEventListener('focusout', resumeTicker);

  // start
  startMessage(0);

  // expose API if needed
  window.AdmissionTicker = {
    setNews(array){ if(Array.isArray(array) && array.length){ NEWS.length=0; NEWS.push(...array); idx=0; startMessage(0); } },
    pause(){ pauseTicker(); },
    resume(){ resumeTicker(); }
  };
})();
</script>

<!-- ===== ADDED: Admission CTA JS (assistant injected) ===== -->
<script>
(function(){
  const cta = document.getElementById('admissionApplyBtn');
  const infoBtn = document.getElementById('admissionInfoBtn');

  // Add idle animation after short delay (draws attention without being aggressive)
  setTimeout(()=> {
    if(cta) cta.classList.add('idle-animate');
  }, 900);

  // When user clicks the CTA, open in new tab (anchor already has target=_blank),
  // add a quick micro-interaction
  if(cta){
    cta.addEventListener('click', (e)=>{
      // small tap feedback for a11y
      cta.style.transform = 'translateY(-2px) scale(.998)';
      setTimeout(()=> { cta.style.transform = ''; }, 160);
    });
  }

  // Quick info popover (simple alert)
  if(infoBtn){
    infoBtn.addEventListener('click', ()=>{
      const msg = 'Admission Open ‚Äî Nursery to Class 10.\nDocuments: Birth Certificate, Aadhar (if available).\nCall: +91 6389259200';
      if(window.navigator && navigator.share){
        navigator.share({ title:'Admission ‚Äî S.B. PUBLIC SCHOOL', text: msg }).catch(()=> alert(msg));
      } else {
        alert(msg);
      }
    });
  }
})();
</script>
<!-- ===== end ADMISSION CTA JS ===== -->

<!-- ===== StudyGenie Floating Helper (inserted by assistant) ===== -->
<style>
.sg-floating {
  position: fixed;
  right: 18px;
  bottom: 18px;
  width:80px;
  height:80px;
  border-radius:50%;
  background:linear-gradient(135deg,#00f5d4,#0b5fa8);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 12px 30px rgba(2,6,23,0.28);
  z-index:999999;
  cursor:pointer;
  transition:transform .12s ease;
}
.sg-floating:active{ transform:scale(.96); }
.sg-floating .badge{
  position:absolute; top:-6px; right:-6px; background:#ff3b30; color:#fff; font-weight:800;
  font-size:12px; padding:3px 6px; border-radius:999px; box-shadow:0 6px 14px rgba(0,0,0,0.2);
}
.sg-popover {
  position: fixed;
  right: 82px;
  bottom: 22px;
  width:320px;
  max-width:calc(100% - 48px);
  background:#ffffff;
  color:#042233;
  border-radius:12px;
  box-shadow:0 18px 60px rgba(2,6,23,0.28);
  z-index:999998;
  overflow:hidden;
  transform-origin:100% 100%;
  transition:transform .14s ease,opacity .14s ease;
  font-family: Arial, Helvetica, sans-serif;
  display:none;
}
.sg-popover.visible{ display:block; transform:translateY(0) scale(1); opacity:1; }
.sg-popover header{background:linear-gradient(90deg,#0b5fa8,#1167b1); color:#fff; padding:10px 12px; font-weight:800; display:flex;justify-content:space-between;align-items:center}
.sg-popover .list{padding:10px; max-height:240px; overflow:auto}
.sg-popover .item{padding:8px;border-radius:8px;margin-bottom:8px;background:#f6fbff;border:1px solid #eef9ff;font-size:13px}
.sg-popover .item .time{font-size:11px;color:#0b5fa8;font-weight:700}
.sg-popover .actions{display:flex;gap:8px;padding:10px;border-top:1px solid #f1f7ff;background:#fff}
.sg-popover .actions button{flex:1;padding:8px;border-radius:8px;border:0;cursor:pointer;font-weight:800}
.sg-openbtn{background:#00f5d4}
.sg-goto{background:#0b5fa8;color:#fff}
@media(max-width:420px){
  .sg-popover{ right:12px; left:12px; width:auto; bottom:80px; }
}
<style>
/* ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ CSS */
body{margin:0;font-family:Arial;}
.header{background:#0b5fa8;}
/* ‡§ä‡§™‡§∞ ‡§ï‡§æ code ‡§µ‡•à‡§∏‡•á ‡§ï‡§æ ‡§µ‡•à‡§∏‡•á ‡§∞‡§π‡§®‡•á ‡§¶‡•á‡§Ç */

/* üëá ‡§Ø‡§π‡•Ä‡§Ç paste ‡§ï‡§∞‡•á‡§Ç */
#admissionApplyBtn{
  font-size:16px;
  padding:14px 26px;
  border-radius:16px;
  font-weight:900;
  letter-spacing:.6px;
  background:linear-gradient(135deg,#ffb703,#ff7b00);
  border:none;
  cursor:pointer;

  color:#ffffff; /* ‚úÖ white text */

  transform-style:preserve-3d;
  box-shadow:
    0 10px 0 #c25a00,
    0 20px 35px rgba(0,0,0,.35);

  animation: admissionFloat 3.5s ease-in-out infinite;
  transition: transform .25s ease, box-shadow .25s ease;
}

/* child text also white */
#admissionApplyBtn span{
  color:#ffffff;
}

/* floating animation */
@keyframes admissionFloat{
  0%{transform:translateY(0) rotateX(0deg);}
  50%{transform:translateY(-6px) rotateX(6deg);}
  100%{transform:translateY(0) rotateX(0deg);}
}

/* hover */
#admissionApplyBtn:hover{
  transform:translateY(-10px) rotateX(12deg) rotateY(-8deg) scale(1.05);
  box-shadow:
    0 14px 0 #a94e00,
    0 35px 60px rgba(0,0,0,.45);
}

/* active click */
#admissionApplyBtn:active{
  transform:translateY(-2px) scale(.98);
  box-shadow:
    0 6px 0 #a94e00,
    0 14px 25px rgba(0,0,0,.35);
}

@keyframes admission3d{
  0%{background:linear-gradient(135deg,#ffb703,#ff7b00);}
  50%{background:linear-gradient(135deg,#00f5d4,#0b5fa8);}
  100%{background:linear-gradient(135deg,#ff595e,#ff006e);}
}

/* üëÜ paste ‡§ñ‡§§‡•ç‡§Æ */
</style>

<div id="sgFloating" class="sg-floating" role="button" aria-label="StudyGenie help" tabindex="0" title="StudyGenie ‚Äî Help">
  <span style="font-size:22px">ü§ñ</span>
  <span id="sgBadge" class="badge" style="display:none">0</span>
</div>

<div id="sgPopover" class="sg-popover" role="dialog" aria-hidden="true" aria-label="StudyGenie notifications">
  <header>
    <div>StudyGenie</div>
    <div style="font-size:12px;opacity:0.9">Latest Updates</div>
  </header>
  <div class="list" id="sgList">
    <div style="padding:12px;color:#556">Loading notifications‚Ä¶</div>
  </div>
  <div class="actions">
    <button id="sgOpenSection" class="sg-goto">Open Notifications</button>
    <button id="sgRefresh" class="sg-openbtn">Refresh</button>
  </div>
</div>

<script>
(function(){
  const floating = document.getElementById('sgFloating');
  const pop = document.getElementById('sgPopover');
  const list = document.getElementById('sgList');
  const badge = document.getElementById('sgBadge');
  const openSectionBtn = document.getElementById('sgOpenSection');
  const refreshBtn = document.getElementById('sgRefresh');

  let latestItems = [];
  let pollInterval = 10000; // 10 seconds
  let timer = null;

  function togglePopover(show){
    const now = !!show;
    if(now){
      pop.classList.add('visible');
      pop.setAttribute('aria-hidden','false');
    } else {
      pop.classList.remove('visible');
      pop.setAttribute('aria-hidden','true');
    }
  }

  floating.addEventListener('click', ()=> togglePopover(!(pop.classList.contains('visible'))));
  floating.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key===' ') { e.preventDefault(); togglePopover(!(pop.classList.contains('visible'))); } });

  async function fetchNotifications(){
    try{
      if(typeof loadSheetGviz === 'function'){
        const data = await loadSheetGviz("Notification");
        const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
        const rows = (data.table.rows||[]).map(r=> r.c || []);
        const textKey = cols.find(k=>/notif|notification|text|message|note|description/i.test(k)) || cols[1] || cols[0] || cols[1];
        const dateKey = cols.find(k=>/date|time|day/i.test(k)) || cols[0] || '';
        const items = [];
        rows.forEach(cells=>{
          const obj={};
          for(let i=0;i<cols.length;i++){
            const cell = cells[i];
            let v = "";
            if(cell){
              if(cell.v !== undefined) v = cell.v;
              else if(cell.f !== undefined) v = String(cell.f).replace(/<[^>]*>/g,'').trim();
            }
            obj[cols[i]] = v;
          }
          const t = obj[textKey] || '';
          const d = obj[dateKey] || '';
          if(t) items.push({text: String(t).trim(), date: String(d).trim()});
        });
        return items.slice(0,8);
      }
    }catch(e){
      console.warn('StudyGenie fetch via loadSheetGviz failed', e);
    }

    try{
      const domNotifs = [];
      const els = document.querySelectorAll('#notifs .notify-item');
      if(els && els.length){
        els.forEach(el=>{
          const d = el.querySelector('.date') ? el.querySelector('.date').innerText : '';
          const t = el.querySelector('.text') ? el.querySelector('.text').innerText : el.innerText;
          domNotifs.push({text: t.trim(), date: d.trim()});
        });
        if(domNotifs.length) return domNotifs.slice(0,8);
      }
    }catch(e){}

    if(window.AdmissionTicker && AdmissionTicker._news && Array.isArray(AdmissionTicker._news)){
      return AdmissionTicker._news.slice(0,5).map(s=>({text:s,date:''}));
    }

    return [{text:'No notifications available. Ensure "Notification" sheet is public (Anyone with the link can view).', date:''}];
  }

  function render(items){
    latestItems = items || [];
    list.innerHTML = '';
    if(!items || items.length===0){
      list.innerHTML = '<div style="padding:10px;color:#667">‡§ï‡•ã‡§à ‡§®‡•ã‡§ü‡§ø‡§´‡§º‡§ø‡§ï‡•á‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</div>';
      badge.style.display = 'none';
      return;
    }
    items.forEach(it=>{
      const el = document.createElement('div');
      el.className = 'item';
      el.innerHTML = `<div style="font-size:14px">${escapeHtml(it.text)}</div><div class="time">${escapeHtml(it.date||'')}</div>`;
      list.appendChild(el);
    });
    const count = items.length;
    badge.innerText = count>99? '99+' : String(count);
    badge.style.display = count>0 ? 'inline-block' : 'none';
  }

  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  openSectionBtn.addEventListener('click', ()=>{
    togglePopover(false);
    try{
      const el = document.getElementById('notifyOuter') || document.getElementById('notifs');
      if(el){ el.scrollIntoView({behavior:'smooth', block:'center'}); el.focus && el.focus(); return; }
      window.open('/', '_self');
    }catch(e){}
  });

  refreshBtn.addEventListener('click', async ()=>{
    refreshBtn.disabled = true;
    refreshBtn.innerText = 'Refreshing‚Ä¶';
    try{ const items = await fetchNotifications(); render(items); }catch(e){ console.error(e); }
    refreshBtn.disabled = false;
    refreshBtn.innerText = 'Refresh';
  });

  async function pollOnce(){
    try{
      const items = await fetchNotifications();
      render(items);
    }catch(e){
      console.error('StudyGenie poll error', e);
    }
  }

  async function start(){
    await pollOnce();
    if(timer) clearInterval(timer);
    timer = setInterval(pollOnce, pollInterval);
  }

  pop.addEventListener('mouseenter', ()=> { if(timer) clearInterval(timer); });
  pop.addEventListener('mouseleave', ()=> { if(timer) clearInterval(timer); timer = setInterval(pollOnce, pollInterval); });

  start();

  window.StudyGenieFloating = { start, stop: ()=> { if(timer) clearInterval(timer); timer=null; }, render };

})();
</script>
<!-- ===== END StudyGenie Floating Helper ===== -->



<!-- Teacher-login intercept modal (paste before 


</body>) -->
<style>
/* simple modal styles */
#teacherAuthModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:100000}
#teacherAuthModal .modalCard{width:360px;max-width:94%;background:#fff;border-radius:12px;padding:18px;box-shadow:0 18px 60px rgba(2,6,23,0.36);font-family:Arial,Helvetica,sans-serif}
#teacherAuthModal h3{margin:0 0 8px;color:#0b5fa8}
#teacherAuthModal .hint{font-size:13px;color:#586574;margin-bottom:12px}
#teacherAuthModal input[type="password"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6f0fb;font-size:15px}
#teacherAuthModal .actions{display:flex;gap:8px;margin-top:12px}
#teacherAuthModal button{flex:1;padding:8px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:800}
#teacherAuthModal .ok{background:linear-gradient(90deg,#0b5fa8,#1167b1);color:#fff}
#teacherAuthModal .cancel{background:#f1f5f9;color:#042033}
#teacherAuthModal .msg{margin-top:8px;font-size:13px}
</style>

<div id="teacherAuthModal" role="dialog" aria-hidden="true">
  <div class="modalCard" role="document" aria-label="Teacher login">
    <h3>Teacher Login</h3>
    <div class="hint">Teacher Login ‡§ñ‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç</div>
    <input id="teacherAuthPw" type="password" placeholder="Password" aria-label="Password" autocomplete="current-password">
    <div class="actions">
      <button class="ok" id="teacherAuthOk">Login</button>
      <button class="cancel" id="teacherAuthCancel">Cancel</button>
    </div>
    <div id="teacherAuthMsg" class="msg" aria-live="polite"></div>
  </div>
</div>

<script>
(function(){
  // === CONFIG ===
  const AUTH_PASS = 'SBPSC@9044'; // ‡§Ü‡§™‡§ï‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° (‡§Ü‡§™ ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)
  const SESSION_KEY = "sbps_teacher_authed"; // session flag
  // Select the Teacher Login anchor already in your page
  // (selector targets the quick-portal teacher button you used: .qp-3d.teacher-3d)
  const teacherAnchor = document.querySelector('.qp-3d.teacher-3d');

  // Fallback selector: try to find anchor whose text includes Teacher (Hindi/English)
  function findTeacherAnchor(){
    let el = document.querySelector('.qp-3d.teacher-3d');
    if(el) return el;
    const anchors = Array.from(document.querySelectorAll('a,button'));
    for(const a of anchors){
      try{
        const txt = (a.innerText||'').trim().toLowerCase();
        if(txt.includes('teacher login') || txt.includes('teacher') || txt.includes('teacher login')) return a;
      }catch(e){}
    }
    return null;
  }

  const tAnchor = teacherAnchor || findTeacherAnchor();
  if(!tAnchor) {
    // no teacher anchor found ‚Äî do nothing
    return;
  }

  // Keep original href/target so we can open on successful auth
  const originalHref = tAnchor.getAttribute('href') || '#';
  const originalTarget = tAnchor.getAttribute('target') || '_blank';

  // Modal elements
  const modal = document.getElementById('teacherAuthModal');
  const pwInput = document.getElementById('teacherAuthPw');
  const okBtn = document.getElementById('teacherAuthOk');
  const cancelBtn = document.getElementById('teacherAuthCancel');
  const msgEl = document.getElementById('teacherAuthMsg');

  function showModal(){
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
    pwInput.value = '';
    msgEl.textContent = '';
    setTimeout(()=> pwInput.focus(), 120);
  }
  function hideModal(){
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
  }

  function setMsg(text, isError){
    msgEl.textContent = text;
    msgEl.style.color = isError ? '#c43' : '#1167b1';
  }

  function openTarget(url){
    hideModal();
    try{ }catch(e){}
    if(!url || url === '#') return;
    if(originalTarget === '_self' || originalTarget === null) window.location.href = url;
    else window.open(url, originalTarget);
  }

  // Auth check: if already authenticated in session, open directly
  function handleClick(e){
    // if already authed, allow default behavior (open)
    try{
      if(sessionStorage.getItem(SESSION_KEY) === '1'){
        return; // allow default
      }
    }catch(e){}
    // prevent default opening
    e.preventDefault();
    e.stopPropagation();
    showModal();
  }

  // attach handler (works for <a> or <button>)
  tAnchor.addEventListener('click', handleClick);

  // Ok handler
  function attemptLogin(){
    const v = (pwInput.value||'').trim();
    if(!v){ setMsg('Password ‡§°‡§æ‡§≤‡•á‡§Ç', true); pwInput.focus(); return; }
    if(v === PASSWORD){
      setMsg('Login ‡§∏‡§´‡§≤ ‚Äî ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å...', false);
      setTimeout(()=> openTarget(originalHref), 350);
    } else {
      setMsg('‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‚Äî ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç', true);
      pwInput.value = '';
      pwInput.focus();
    }
  }

  okBtn.addEventListener('click', attemptLogin);
  pwInput.addEventListener('keydown', function(e){ if(e.key === 'Enter') attemptLogin(); });
  cancelBtn.addEventListener('click', ()=>{ hideModal(); });

  // close on outside click
  modal.addEventListener('click', function(ev){
    if(ev.target === modal) hideModal();
  });

  // Accessibility: close with Escape
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape') hideModal();
  });

  // If teacherAnchor is a real link that opens on middle-click or ctrl+click,
  // we still intercept normal left-click only. Middle-click/cmd+click will open in new tab.
})();
</script>
<!-- End teacher-login intercept modal -->




<!-- Teacher password protect (injected) -->
<script>
(function(){
  const PASSWORD = "SBPSC@9044";

  const btn = document.querySelector(".qp-3d.teacher-3d");
  if(!btn) return;

  const url = btn.getAttribute("href");
  const target = btn.getAttribute("target") || "_blank";

  btn.addEventListener("click", function(e){
    e.preventDefault();
    const pw = prompt("Teacher Login Password ‡§°‡§æ‡§≤‡•á‡§Ç:");

    if(pw === null) return;

    if(pw === PASSWORD){
      window.open(url, target);
    } else {
      alert("‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‚ùå");
    }
  });
})();
</script>

<div id="teacherAuthModal" role="dialog" aria-hidden="true">
  <div class="modalCard" role="document" aria-label="Teacher login">
    <h3>Teacher Login</h3>
    <div class="hint">Teacher Portal ‡§ñ‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç</div>
    <input id="teacherAuthPw" type="password" placeholder="Password" aria-label="Password" autocomplete="current-password">
    <div class="actions">
      <button class="ok" id="teacherAuthOk">Login</button>
      <button class="cancel" id="teacherAuthCancel">Cancel</button>
    </div>
    <div id="teacherAuthMsg" class="msg" aria-live="polite"></div>
  </div>
</div>

<script>
(function(){
  const AUTH_PASS = 'SBPSC@9044';
  const SESSION_KEY = 'sbps_teacher_authed';

  const modal = document.getElementById('teacherAuthModal');
  const pwInput = document.getElementById('teacherAuthPw');
  const okBtn = document.getElementById('teacherAuthOk');
  const cancelBtn = document.getElementById('teacherAuthCancel');
  const msgEl = document.getElementById('teacherAuthMsg');

  function showModal(){ modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); pwInput.value=''; msgEl.textContent=''; setTimeout(()=>pwInput.focus(),120); }
  function hideModal(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); }
  function setMsg(t,e){ msgEl.textContent=t; msgEl.style.color = e? '#c43':'#1167b1'; }

  function openTarget(url, target){
    hideModal();
    if(!url || url==='#') return;
    try{
      if(target === '_self' || !target) window.location.href = url;
      else window.open(url, target);
    }catch(err){ window.location.href = url; }
  }

  function attemptLogin(origHref, origTarget){
    const v = (pwInput.value||'').trim();
    if(!v){ setMsg('Password ‡§°‡§æ‡§≤‡•á‡§Ç', true); pwInput.focus(); return; }
    if(v === AUTH_PASS){
      try{ sessionStorage.setItem(SESSION_KEY, '1'); }catch(e){}
      setMsg('Login ‡§∏‡§´‡§≤ ‚Äî ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å...', false);
      setTimeout(()=> openTarget(origHref, origTarget), 200);
    } else {
      setMsg('‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‚Äî ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç', true);
      pwInput.value=''; pwInput.focus();
    }
  }

  // Global click interceptor (captures early)
  document.addEventListener('click', function(e){
    // find nearest anchor or button
    const el = e.target.closest('a,button');
    if(!el) return;
    // Allow elements explicitly marked data-no-auth
    if(el.hasAttribute('data-no-auth')) return;
    // text to check
    const txt = (el.innerText || el.getAttribute('title') || el.getAttribute('aria-label') || el.getAttribute('alt') || '').toLowerCase();
    // also check href path or classnames
    const href = (el.getAttribute && el.getAttribute('href')) || '';
    const cls = (el.className || '').toString().toLowerCase();

    const triggers = ['teacher', 'teacher login', '‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï', '‡§ü‡•Ä‡§ö‡§∞', 'teacherportal', 'teacher-portal'];
    const isTeacher = triggers.some(t => txt.includes(t) || href.toLowerCase().includes(t) || cls.includes(t));

    if(!isTeacher) return;

    // allow modified clicks to open in new tab/window without intercept
    if(e.ctrlKey || e.metaKey || e.shiftKey || (e.button && e.button === 1)) return;

    // if already authed in this session, let it proceed normally
    try{ if(sessionStorage.getItem(SESSION_KEY) === '1') return; }catch(e){}

    // intercept
    e.preventDefault();
    e.stopPropagation();

    // store original target/href on modal dataset for later
    modal.dataset.origHref = href || el.getAttribute('data-href') || '#';
    modal.dataset.origTarget = el.getAttribute('target') || '_blank';
    // if no href but has onclick navigation that we can't detect, try to open data-href or data-url attributes
    if(!modal.dataset.origHref || modal.dataset.origHref === '#') {
      modal.dataset.origHref = el.getAttribute('data-href') || el.getAttribute('data-url') || '#';
    }
    showModal();

    // bind ok to attemptLogin with captured values
    okBtn.onclick = function(){ attemptLogin(modal.dataset.origHref, modal.dataset.origTarget); };
    pwInput.onkeydown = function(ev){ if(ev.key === 'Enter') attemptLogin(modal.dataset.origHref, modal.dataset.origTarget); };
  }, true);

  cancelBtn.addEventListener('click', hideModal);
  modal.addEventListener('click', function(ev){ if(ev.target === modal) hideModal(); });
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') hideModal(); });

})();
</script>
<!-- end teacher password protect -->
<script>
let deferredPrompt = null;

window.addEventListener("beforeinstallprompt", (e)=>{
  e.preventDefault();
  deferredPrompt = e;
});

const installBtn = document.getElementById("installAppBtn");
const popup = document.getElementById("installPopup");
const yesBtn = document.getElementById("installYes");
const noBtn = document.getElementById("installNo");

installBtn.addEventListener("click", ()=>{
  popup.style.display = "flex";
});

noBtn.addEventListener("click", ()=>{
  popup.style.display = "none";
});

yesBtn.addEventListener("click", async ()=>{
  popup.style.display = "none";

  if(!deferredPrompt){
    alert("Chrome menu (‚ãÆ) ‡§∏‡•á 'Install App' ‡§ö‡•Å‡§®‡•á‡§Ç");
    return;
  }

  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});
</script>

<!-- ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ zoom-out ‡§ï‡•Ä ‡§´‡§ø‡§ï‡•ç‡§∏ ‚Äî ‡§á‡§∏‡•á stylesheet ‡§ï‡•á ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç -->
<style>
/* allow tables to shrink on narrow screens (fix mobile zoom-out) */
table { min-width: 0 !important; width: 100%; }

/* make horizontal table container smoothly scrollable on touch */
.table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }

/* safeguard: prevent accidental page-wide overflow */
html, body { max-width: 100%; overflow-x: hidden; }

/* ===== VIDEO SLIDE + MUTE SYSTEM ===== */
.video-slider{
  position:relative;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:12px;
  overflow:hidden;
}

.video-slider video{
  width:100%;
  height:100%;
  object-fit:contain;
  animation:videoFade .6s ease;
}

@keyframes videoFade{
  from{opacity:0}
  to{opacity:1}
}


</script>

<script>
(async function(){
  const video = document.getElementById("qpMainVideo");
  const base = "slider_videos/";
  let list = [];
  let index = 0;

  async function loadVideos(){
    try{
      const res = await fetch("videos.json");
      const data = await res.json();
      return data.videos || [];
    }catch(e){
      console.error("videos.json ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ");
      return [];
    }
  }

  function playVideo(i){
    video.style.opacity = 0;

    setTimeout(()=>{
      video.src = base + list[i];
      video.load();

      video.muted = true;   // ‚úÖ default mute
      video.volume = 1.0;

      video.play().catch(()=>{});
      video.style.opacity = 1;
    },200);
  }

  list = await loadVideos();
  if(!list.length) return;

  playVideo(index);

  video.addEventListener("ended", ()=>{
    index = (index + 1) % list.length;
    playVideo(index);
  });
})();

/* ===== STUDENT INSTALL ‚Äì DARK ORANGE + BLACK TEXT ===== */
.qp-3d.student-3d{
  background: linear-gradient(135deg, #c2410c, #7c2d12) !important;
  color: #000000 !important;

  box-shadow:
    0 10px 0 #7c2d12,
    0 26px 45px rgba(0,0,0,.45);

  transform-style: preserve-3d;
}

/* inner text + icon */
.qp-3d.student-3d .face,
.qp-3d.student-3d .ico{
  color: #000000 !important;
  font-weight: 900;
}

/* shine layer */
.qp-3d.student-3d::after{
  background: linear-gradient(
    90deg,
    rgba(255,255,255,.20),
    rgba(255,255,255,.08)
  );
  transform: translateY(6px) scale(1.02);
}

/* floating animation */
@keyframes studentFloatDark{
  0%{transform: translateY(0)}
  50%{transform: translateY(-9px)}
  100%{transform: translateY(0)}
}

.qp-3d.student-3d.idle{
  animation: studentFloatDark 4.5s ease-in-out infinite;
}

/* hover */
.qp-3d.student-3d:hover{
  transform: translateY(-12px) scale(1.05);
  box-shadow:
    0 14px 0 #7c2d12,
    0 44px 80px rgba(0,0,0,.55);
}

/* active */
.qp-3d.student-3d:active{
  transform: translateY(-4px) scale(.98);
  box-shadow:
    0 6px 0 #7c2d12,
    0 18px 28px rgba(0,0,0,.45);
}

/* ===== FORCE FOOTER STYLE (FINAL FIX) ===== */
.footer{
  background: linear-gradient(90deg, #0b3c6f, #0b5fa8) !important;
  color: #ffffff !important;
  padding: 16px 10px !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  text-align: center !important;
  margin-top: 20px !important;
}

.footer *{
  color:#ffffff !important;
}
<!-- ================= FULL SCREEN GREETING (VISIBLE & SAFE) ================= -->
<style>
#safeGreeting{
  position:fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  z-index:9999999;
  background:linear-gradient(to top,#4facfe,#00f2fe);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Arial,Helvetica,sans-serif;
}

#safeGreeting .box{
  text-align:center;
  color:#ffffff;
}

#safeGreeting .sun{
  width:220px;
  height:220px;
  margin:0 auto 15px;
  border-radius:50%;
  background:radial-gradient(circle,#fff59d,#ff9800);
  animation:sunrise 3s ease-out forwards;
}

@keyframes sunrise{
  from{transform:translateY(200px)}
  to{transform:translateY(0)}
}

#safeGreeting h1{
  font-size:38px;
  margin:10px 0;
  font-weight:900;
}

#safeGreeting p{
  font-size:20px;
}
</style>

<!-- ========== FINAL WEATHER + MOTIVATION + SUN LIGHT SYSTEM ========== -->
<style>
#weatherGreeting{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  z-index:9999999;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Arial,Helvetica,sans-serif;
  animation:fadeIn 1s ease;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
#weatherGreeting.hide{animation:fadeOut 1s forwards}
@keyframes fadeOut{to{opacity:0;visibility:hidden}}

.sky{
  position:absolute;
  inset:0;
  transition:background 4s ease;
}

/* üåû SUN */
.sun{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:240px;
  height:240px;
  border-radius:50%;
  background:radial-gradient(circle,#fff9c4,#ff9800);
  box-shadow:
    0 0 60px rgba(255,200,0,.9),
    0 0 140px rgba(255,200,0,.7),
    0 0 260px rgba(255,200,0,.5);
  opacity:0;
}

/* ‚òÄÔ∏è MORNING */
.sunrise{
  bottom:-280px;
  animation:
    sunriseMove 4s forwards,
    lightOn 4s forwards;
}
@keyframes sunriseMove{
  to{bottom:55%}
}
@keyframes lightOn{
  to{
    opacity:1;
    box-shadow:
      0 0 80px rgba(255,220,120,1),
      0 0 180px rgba(255,200,0,.8),
      0 0 320px rgba(255,180,0,.6);
  }
}

/* üåá EVENING */
.sunset{
  bottom:55%;
  animation:
    sunsetMove 4s forwards,
    lightOff 4s forwards;
}
@keyframes sunsetMove{
  to{bottom:-320px}
}
@keyframes lightOff{
  to{
    opacity:0;
    box-shadow:
      0 0 10px rgba(255,120,0,.2);
  }
}

/* ‚òÅÔ∏è CLOUDS */
.cloud{
  position:absolute;
  top:15%;
  font-size:160px;
  opacity:.6;
  animation:cloudMove 50s linear infinite;
}
.cloud.c2{
  top:35%;
  font-size:110px;
  animation-duration:70s;
}
@keyframes cloudMove{from{left:-40%}to{left:120%}}

/* üê¶ BIRDS */
.bird{
  position:absolute;
  top:25%;
  font-size:42px;
  animation:birdFly 18s linear infinite;
}
@keyframes birdFly{from{left:-10%}to{left:110%}}

/* üåßÔ∏è RAIN */
.rain{
  position:absolute;
  inset:0;
  pointer-events:none;
  background-image:
    repeating-linear-gradient(
      -45deg,
      rgba(255,255,255,.25) 0px,
      rgba(255,255,255,.25) 1px,
      transparent 1px,
      transparent 8px
    );
  animation:rainFall .4s linear infinite;
}
@keyframes rainFall{to{background-position:-20px 40px}}

.content{
  position:relative;
  z-index:5;
  text-align:center;
  color:#fff;
  text-shadow:0 6px 18px rgba(0,0,0,.45);
}
.content h1{
  font-size:40px;
  margin:8px 0;
  font-weight:900;
}
.content p{
  font-size:22px;
  line-height:1.5;
}
</style>

<script>
(async function(){

if("speechSynthesis" in window){ speechSynthesis.cancel(); }

const API_KEY="ec205c82afed56e514e32b2eaafa1079";

/* LOCATION */
function getLocation(){
  return new Promise((res,rej)=>{
    navigator.geolocation.getCurrentPosition(
      p=>res(p.coords),
      e=>rej(e)
    );
  });
}

/* WEATHER */
async function getWeather(lat,lon){
  const url=
    "https://api.openweathermap.org/data/2.5/weather"+
    "?lat="+lat+"&lon="+lon+
    "&appid="+API_KEY+"&units=metric";
  const r=await fetch(url);
  return r.json();
}

let city="‡§Ü‡§™‡§ï‡•á ‡§∂‡§π‡§∞", temp="--", weather="Clear";
/* üß† WEATHER ADVICE FOR STUDENTS */
let adviceText = "";
let adviceVoice = "";

/* Temperature + Weather based advice */
if (weather === "Rain" || weather === "Thunderstorm") {
  adviceText = "üåßÔ∏è ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à, ‡§õ‡§æ‡§§‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§ö‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§ó‡•Ä‡§≤‡•á ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§õ‡§æ‡§§‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§ö‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§ó‡•Ä‡§≤‡•á ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
}
else if (temp <= 15) {
  adviceText = "‚ùÑÔ∏è ‡§†‡§Ç‡§° ‡§π‡•à, ‡§ó‡§∞‡•ç‡§Æ ‡§ï‡§™‡§°‡§º‡•á ‡§™‡§π‡§®‡•á‡§Ç ‡§î‡§∞ ‡§†‡§Ç‡§°‡§æ ‡§™‡§æ‡§®‡•Ä ‡§™‡•Ä‡§®‡•á ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§†‡§Ç‡§° ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§ó‡§∞‡•ç‡§Æ ‡§ï‡§™‡§°‡§º‡•á ‡§™‡§π‡§®‡•á‡§Ç ‡§î‡§∞ ‡§†‡§Ç‡§°‡§æ ‡§™‡§æ‡§®‡•Ä ‡§™‡•Ä‡§®‡•á ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
}
else if (temp >= 35) {
  adviceText = "‚òÄÔ∏è ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à, ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å ‡§î‡§∞ ‡§§‡•á‡§ú ‡§ß‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å ‡§î‡§∞ ‡§§‡•á‡§ú ‡§ß‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
}
else {
  adviceText = "üôÇ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à, ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§∞‡§π‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à‡•§ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§∞‡§π‡•á‡§Ç‡•§";
}

try{
  const c=await getLocation();
  const d=await getWeather(c.latitude,c.longitude);
  city=d.name||city;
  temp=Math.round(d.main.temp);
  weather=d.weather[0].main;
}catch(e){}

/* SKY COLOR */
let bg="linear-gradient(to top,#4facfe,#00f2fe)";
let showRain=false;
if(weather==="Clouds") bg="linear-gradient(to top,#bdc3c7,#2c3e50)";
if(weather==="Rain"){bg="linear-gradient(to top,#373b44,#4286f4)";showRain=true;}
if(weather==="Thunderstorm"){bg="linear-gradient(to top,#141e30,#000)";showRain=true;}

/* ‚è∞ TIME + MOTIVATION */
const h=new Date().getHours();
let title="",msg="",voice="",sunClass="";

if(h>=5&&h<12){
  title="Good Morning üåû";
  msg=`${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp}¬∞C ‡§π‡•à‡•§<br>
  ‡§Ü‡§ú ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞‡•ã ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡§ñ‡•ã ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§≠‡•Ä ‡§¨‡•á‡§ï‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ‡§§‡•Ä‡•§`;
  voice=`‡§ó‡•Å‡§° ‡§Æ‡•â‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä‡•§ ${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§π‡•à‡•§ ‡§Ü‡§ú ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞‡•ã , ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡§ñ‡•ã , ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§≠‡•Ä ‡§¨‡•á‡§ï‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ‡§§‡•Ä‡•§`;
  sunClass="sunrise";
}
else if(h>=16&&h<20){
  title="Good Evening üåá";
  msg=`${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp}¬∞C ‡§π‡•à‡•§<br>
  ‡§Ü‡§ú ‡§ï‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§≤ ‡§ö‡§Æ‡§ï‡•á‡§ó‡•Ä, ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•ã‡•§`;
  voice=`‡§ó‡•Å‡§° ‡§à‡§µ‡§®‡§ø‡§Ç‡§ó ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä‡•§ ${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§π‡•à‡•§ ‡§Ü‡§ú ‡§ï‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§≤ ‡§ö‡§Æ‡§ï‡•á‡§ó‡•Ä , ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•ã‡•§`;
  sunClass="sunset";
}
else if(h>=12&&h<16){
  title="Good Afternoon üå§Ô∏è";
  msg=`${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp}¬∞C ‡§π‡•à‡•§<br>
  ‡§∞‡•ã‡§ú ‡§•‡•ã‡§°‡§º‡§æ ‡§™‡§¢‡§º‡§®‡§æ ‡§Ü‡§¶‡§§ ‡§¨‡§®‡§æ‡§ì, ‡§Ø‡§π‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§π‡•à‡•§`;
  voice=`‡§ó‡•Å‡§° ‡§Ü‡§´‡•ç‡§ü‡§∞‡§®‡•Ç‡§® ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä‡•§ ${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§π‡•à‡•§ ‡§™‡§¢‡§º‡§æ‡§à ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•ã ‡§∞‡•ã‡§ú ‡§•‡•ã‡§°‡§º‡§æ ‡§™‡§¢‡§º‡§®‡§æ ‡§Ü‡§¶‡§§ ‡§¨‡§®‡§æ‡§ì , ‡§Ø‡§π‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§π‡•à‡•§`;
}
else{
  title="Good Night üåô";
  msg=`${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp}¬∞C ‡§π‡•à‡•§<br>
  ‡§Ü‡§ú ‡§ú‡•ã ‡§™‡§¢‡§º‡§æ ‡§â‡§∏‡•á ‡§¶‡•ã‡§π‡§∞‡§æ‡§ì, ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•ã, ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§∏‡•ã‡§ì,
  ‡§§‡§æ‡§ï‡§ø ‡§ï‡§≤ ‡§®‡§à ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§î‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞ ‡§∏‡§ï‡•ã‡•§`;
  voice=`‡§ó‡•Å‡§° ‡§®‡§æ‡§á‡§ü ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä‡•§ ${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§π‡•à‡•§
  ‡§Ü‡§ú ‡§ú‡•ã ‡§™‡§¢‡§º‡§æ ‡§â‡§∏‡•á ‡§¶‡•ã‡§π‡§∞‡§æ‡§ì, ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•ã, ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§∏‡•ã‡§ì,
  ‡§§‡§æ‡§ï‡§ø ‡§ï‡§≤ ‡§®‡§à ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§î‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞ ‡§∏‡§ï‡•ã‡•§`;
}

/* UI */
const g=document.createElement("div");
g.id="weatherGreeting";
g.innerHTML=`
  <div class="sky" style="background:${bg}"></div>
  ${sunClass?`<div class="sun ${sunClass}"></div>`:""}
  <div class="cloud">‚òÅÔ∏è</div>
  <div class="cloud c2">‚òÅÔ∏è</div>
  <div class="bird">üê¶</div>
  ${showRain?`<div class="rain"></div>`:""}
  <div class="content">
    <h1>${title}</h1>
    <p>${msg}</p>
  </div>
`;
document.body.appendChild(g);

/* VOICE */
setTimeout(()=>{
  if("speechSynthesis" in window){
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(voice);
    u.lang="hi-IN";
    u.rate=0.95;
    speechSynthesis.speak(u);
  }
},700);

/* AUTO CLOSE */
setTimeout(()=>{
  g.classList.add("hide");
  setTimeout(()=>g.remove(),1200);
},5000);

})();
</script>
<!-- ========== END ========== -->

<!-- ========== FINAL SMART WEATHER ADVISORY SYSTEM ========== -->
<style>
#smartGreeting{
  position:fixed; inset:0;
  z-index:9999999;
  background:linear-gradient(to top,#4facfe,#00f2fe);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Arial,Helvetica,sans-serif;
}
.content{
  text-align:center;
  color:#fff;
  padding:20px;
  text-shadow:0 4px 15px rgba(0,0,0,.4);
}
.content h1{font-size:36px;font-weight:900}
.content p{font-size:20px;line-height:1.6}

/* ‚òÅÔ∏è Clouds */
.cloud{
  position:absolute; top:15%;
  font-size:140px; opacity:.6;
  animation:cloudMove 40s linear infinite;
}
@keyframes cloudMove{from{left:-40%}to{left:120%}}

/* üê¶ Bird */
.bird{
  position:absolute; top:28%;
  font-size:36px;
  animation:birdFly 18s linear infinite;
}
@keyframes birdFly{from{left:-10%}to{left:110%}}

/* üåßÔ∏è Rain */
.rain{
  position:absolute; inset:0; pointer-events:none;
  background-image:repeating-linear-gradient(
    -45deg,
    rgba(255,255,255,.3) 0px,
    rgba(255,255,255,.3) 1px,
    transparent 1px,
    transparent 8px
  );
  animation:rainFall .4s linear infinite;
}
@keyframes rainFall{to{background-position:-20px 40px}}
</style>

<script>
(async function(){

/* üîí Stop any previous speech */
if("speechSynthesis" in window) speechSynthesis.cancel();

/* üîë WEATHER API KEY */
const API_KEY = "ec205c82afed56e514e32b2eaafa1079";

/* üìç LOCATION */
function getLocation(){
  return new Promise((res,rej)=>{
    navigator.geolocation.getCurrentPosition(
      p=>res(p.coords),
      e=>rej(e)
    );
  });
}

/* üå¶Ô∏è WEATHER */
async function getWeather(lat,lon){
  const url =
    "https://api.openweathermap.org/data/2.5/weather"+
    "?lat="+lat+"&lon="+lon+
    "&appid="+API_KEY+"&units=metric";
  const r = await fetch(url);
  return r.json();
}

/* DEFAULT VALUES */
let city="‡§Ü‡§™‡§ï‡•á ‡§∂‡§π‡§∞";
let temp=0;
let weather="Clear";

/* TRY REAL WEATHER */
try{
  const c = await getLocation();
  const d = await getWeather(c.latitude,c.longitude);
  city = d.name || city;
  temp = Math.round(d.main.temp);
  weather = d.weather[0].main;
}catch(e){
  console.log("Weather fallback mode");
}

/* üß† WEATHER ADVICE (TEXT + VOICE) */
let adviceText="", adviceVoice="";
let showRain=false;

if(weather==="Rain" || weather==="Thunderstorm"){
  adviceText = "üåßÔ∏è ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à, ‡§õ‡§æ‡§§‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§ö‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§ó‡•Ä‡§≤‡•á ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§õ‡§æ‡§§‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§ö‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§ó‡•Ä‡§≤‡•á ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  showRain = true;
}
else if(temp <= 15){
  adviceText = "‚ùÑÔ∏è ‡§†‡§Ç‡§° ‡§π‡•à, ‡§ó‡§∞‡•ç‡§Æ ‡§ï‡§™‡§°‡§º‡•á ‡§™‡§π‡§®‡•á‡§Ç ‡§î‡§∞ ‡§†‡§Ç‡§°‡§æ ‡§™‡§æ‡§®‡•Ä ‡§™‡•Ä‡§®‡•á ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§†‡§Ç‡§° ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§ó‡§∞‡•ç‡§Æ ‡§ï‡§™‡§°‡§º‡•á ‡§™‡§π‡§®‡•á‡§Ç ‡§î‡§∞ ‡§†‡§Ç‡§°‡§æ ‡§™‡§æ‡§®‡•Ä ‡§™‡•Ä‡§®‡•á ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
}
else if(temp >= 35){
  adviceText = "‚òÄÔ∏è ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à, ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å ‡§î‡§∞ ‡§§‡•á‡§ú ‡§ß‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§ó‡§∞‡•ç‡§Æ‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å ‡§î‡§∞ ‡§§‡•á‡§ú ‡§ß‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§";
}
else{
  adviceText = "üôÇ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à, ‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§∞‡§π‡•á‡§Ç ‡§î‡§∞ ‡§™‡§¢‡§º‡§æ‡§à ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç‡•§";
  adviceVoice = "‡§Ü‡§ú ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à‡•§ ‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§∞‡§π‡•á‡§Ç ‡§î‡§∞ ‡§™‡§¢‡§º‡§æ‡§à ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç‡•§";
}

/* üß© UI */
const g = document.createElement("div");
g.id = "smartGreeting";
g.innerHTML = `
  ${showRain ? `<div class="rain"></div>` : ``}
  <div class="cloud">‚òÅÔ∏è</div>
  <div class="bird">üê¶</div>

  <div class="content">
    <h1>‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä üëã</h1>
    <p>
      ${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp}¬∞C ‡§π‡•à<br>
      <strong>${adviceText}</strong>
    </p>
  </div>
`;
document.body.appendChild(g);

/* üîä FINAL VOICE (Advice ALWAYS included) */
let finalVoice =
  `‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä‡•§ ${city} ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ${temp} ‡§°‡§ø‡§ó‡•ç‡§∞‡•Ä ‡§∏‡•á‡§≤‡•ç‡§∏‡§ø‡§Ø‡§∏ ‡§π‡•à‡•§ ` +
  adviceVoice;

setTimeout(()=>{
  if("speechSynthesis" in window){
    speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(finalVoice);
    utter.lang = "hi-IN";
    utter.rate = 0.95;
    speechSynthesis.speak(utter);
  }
},800);

/* ‚è±Ô∏è AUTO CLOSE */
setTimeout(()=>{
  g.remove();
},7000);

})();
</script>
<!-- ========== END SYSTEM ========== -->

<!-- ================== üéÇ BIRTHDAY AUTO SCROLL BOX ================== -->
<style>
#birthdayScrollBox{
  display:none;
  max-width:380px;
  margin:20px auto 10px auto;
  background:linear-gradient(135deg,#fff1eb,#ace0f9);
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
  overflow:hidden;
}

#birthdayScrollBox h3{
  margin:0;
  padding:12px;
  text-align:center;
  background:#ff006e;
  color:#fff;
  font-weight:900;
  font-size:16px;
}

.birthday-scroll{
  height:180px;
  overflow:hidden;
  position:relative;
}

.birthday-scroll-inner{
  position:absolute;
  width:100%;
  will-change:transform;
}

.birthday-item{
  padding:12px;
  text-align:center;
  font-weight:800;
  color:#0b5fa8;
  font-size:15px;
}

.birthday-wish{
  font-size:13px;
  color:#333;
  margin-top:4px;
}
</style>

<div id="birthdayScrollBox">
  <h3>üéâ Today Birthday üéÇ</h3>
  <div class="birthday-scroll">
    <div class="birthday-scroll-inner" id="birthdayScrollInner"></div>
  </div>
</div>

<script>
<!-- ================== üéÇ FINAL BIRTHDAY SYSTEM ================== -->

<style>
/* üéÇ Birthday Box */
#birthdayScrollBox{
  display:none;
  max-width:380px;
  margin:20px auto;
  background:linear-gradient(135deg,#fff1eb,#ace0f9);
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
  overflow:hidden;
}

/* Header */
#birthdayScrollBox h3{
  margin:0;
  padding:12px;
  background:#ff006e;
  color:#fff;
  text-align:center;
  font-weight:900;
  font-size:16px;
}

/* Scroll Area */
.birthday-scroll{
  height:170px;
  overflow:hidden;
  position:relative;
}

/* Moving Content */
.birthday-scroll-inner{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  will-change:transform;
}

/* Each Student */
.birthday-item{
  padding:12px;
  text-align:center;
  font-weight:800;
  color:#0b5fa8;
  font-size:15px;
}

/* Wish Text */
.birthday-wish{
  font-size:13px;
  color:#333;
  margin-top:4px;
}

/* üì± Mobile Responsive */
@media (max-width:480px){
  #birthdayScrollBox{
    max-width:94%;
    border-radius:14px;
  }
  #birthdayScrollBox h3{
    font-size:14px;
  }
  .birthday-item{
    font-size:14px;
  }
}
</style>

/* üéÇ FINAL BIRTHDAY SYSTEM (Today + Tomorrow Preview) */
(async function(){

  const SHEET_ID = "1K9EU36olQPdENJ_8wY-9AslkarnOWdrgx7F1DErnSO0";
  const SHEET_NAME = "Student's Details";

  function parseDOB(d){
    if(!d) return null;
    const p = d.toString().split(/[-\/]/);
    return (p[0].length===4)
      ? {day:+p[2], month:+p[1]}
      : {day:+p[0], month:+p[1]};
  }

  async function loadSheet(){
    const url =
      `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;
    const res = await fetch(url);
    const txt = await res.text();
    return JSON.parse(txt.replace(/^[^{]*/,"").replace(/\);$/,"")).table;
  }

  const today = new Date();
  const tDay = today.getDate();
  const tMonth = today.getMonth()+1;

  const tomorrow = new Date(today);
  tomorrow.setDate(today.getDate()+1);
  const tmDay = tomorrow.getDate();
  const tmMonth = tomorrow.getMonth()+1;

  const table = await loadSheet();
  const cols = table.cols.map(c=>c.label);
  const rows = table.rows;

  const nameCol = cols.indexOf("Student Name");
  const dobCol  = cols.indexOf("Date of Birth");
  if(nameCol < 0 || dobCol < 0) return;

  let todayHTML = "";
  let tomorrowNames = [];

  rows.forEach(r=>{
    const dob = parseDOB(r.c[dobCol]?.v);
    if(!dob) return;

    const name = r.c[nameCol]?.v;

    if(dob.day === tDay && dob.month === tMonth){
      todayHTML += `
        <div class="birthday-item">
          üéÇ ${name}
          <div class="birthday-wish">
            ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Å üå∏
          </div>
        </div>
      `;
    }

    if(dob.day === tmDay && dob.month === tmMonth){
      tomorrowNames.push(name);
    }
  });

  const box = document.getElementById("birthdayScrollBox");
  const inner = document.getElementById("birthdayScrollInner");

  /* OPTION-1: No Birthday Today */
  if(!todayHTML){
    inner.innerHTML = `
      <div class="birthday-item">
        üéà ‡§Ü‡§ú ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
      </div>
      ${
        tomorrowNames.length
        ? `<div class="birthday-wish">
             üìÖ ‡§ï‡§≤ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§®: <b>${tomorrowNames.join(", ")}</b>
           </div>`
        : ""
      }
    `;
    box.style.display = "block";
    return;
  }

  /* OPTION-2: Birthday Today + Tomorrow Preview */
  if(tomorrowNames.length){
    todayHTML += `
      <div class="birthday-item">
        üìÖ ‡§ï‡§≤ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§®:
        <div class="birthday-wish">
          ${tomorrowNames.join(", ")}
        </div>
      </div>
    `;
  }

  /* üîÅ Duplicate for auto scroll */
  inner.innerHTML = todayHTML + todayHTML;
  box.style.display = "block";

  /* ‚¨ÜÔ∏è AUTO SCROLL */
  let pos = 0;
  function scroll(){
    pos -= 0.35;
    if(Math.abs(pos) >= inner.scrollHeight/2) pos = 0;
    inner.style.transform = `translateY(${pos}px)`;
    requestAnimationFrame(scroll);
  }
  scroll();

})();
</script>

<style>
/* üéâ Birthday Heading ‚Äì Responsive */
#birthdayScrollBox h3{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  line-height:1.2;
  text-align:center;
  word-break:break-word;
  white-space:normal;
}

/* üì± Mobile */
@media (max-width:480px){
  #birthdayScrollBox h3{
    font-size:14px;
    padding:8px 6px;
  }
}

/* üì≤ Tablet */
@media (min-width:481px) and (max-width:768px){
  #birthdayScrollBox h3{
    font-size:15px;
    padding:10px 8px;
  }
}

/* üñ•Ô∏è Desktop */
@media (min-width:769px){
  #birthdayScrollBox h3{
    font-size:16px;
    padding:12px;
  }
}
</style>
<!-- ================== üéÇ FINAL BIRTHDAY SYSTEM ================== -->

<style>
/* üéÇ Birthday Box */
#birthdayScrollBox{
  display:none;
  max-width:380px;
  margin:20px auto;
  background:linear-gradient(135deg,#fff1eb,#ace0f9);
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
  overflow:hidden;
}

/* Header */
#birthdayScrollBox h3{
  margin:0;
  padding:16px;
  background:#ff006e;
  color:#fff;
  text-align:center;
  font-weight:900;
  font-size:26px;
  letter-spacing:0.8px;
}

/* Scroll Area */
.birthday-scroll{
  height:170px;
  overflow:hidden;
  position:relative;
}

/* Moving Content */
.birthday-scroll-inner{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  will-change:transform;
}

/* Each Student */
.birthday-item{
  padding:12px;
  text-align:center;
  font-weight:800;
  color:#0b5fa8;
  font-size:15px;
}

/* Wish Text */
.birthday-wish{
  font-size:13px;
  color:#333;
  margin-top:4px;
}

/* Mobile Smaller */
@media (max-width:480px){
  #birthdayScrollBox h3{font-size:22px;}
  .birthday-item{font-size:14px;}
}
</style>

<div id="birthdayScrollBox">
  <h3>üéâ Today Birthday üéÇ</h3>
  <div class="birthday-scroll">
    <div id="birthdayScrollInner" class="birthday-scroll-inner"></div>
  </div>
</div>

<script>
/* üéÇ UPDATED BIRTHDAY AUTO SCROLL SYSTEM */

(async function(){

  /* üìå UPDATED Sheet Info */
  const SHEET_ID = "1BtoDja9imrMyHMKt5oqSYoOzj9w2GWe13JcbRu1vWO8";
  const SHEET_NAME = "Marksheet Details";

  function parseDOB(d){
    if(!d) return null;
    const p = d.toString().split(/[-\/]/);
    return (p[0].length===4)
      ? {day:+p[2], month:+p[1]}
      : {day:+p[0], month:+p[1]};
  }

  async function loadSheet(){
    const url =
      `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;
    const res = await fetch(url);
    const txt = await res.text();
    return JSON.parse(txt.replace(/^[^{]*/,"").replace(/\);$/,"")).table;
  }

  const today = new Date();
  const tDay = today.getDate();
  const tMonth = today.getMonth()+1;

  const tomorrow = new Date(today);
  tomorrow.setDate(today.getDate()+1);
  const tmDay = tomorrow.getDate();
  const tmMonth = tomorrow.getMonth()+1;

  const table = await loadSheet();
  const cols = table.cols.map(c=>c.label);
  const rows = table.rows;

  const nameCol = cols.indexOf("Student Name");
  const dobCol  = cols.indexOf("Date of Birth");
  if(nameCol < 0 || dobCol < 0) return;

  let todayHTML = "";
  let tomorrowNames = [];

  rows.forEach(r=>{
    const dob = parseDOB(r.c[dobCol]?.v);
    if(!dob) return;

    const name = r.c[nameCol]?.v;

    if(dob.day === tDay && dob.month === tMonth){
      todayHTML += `
        <div class="birthday-item">
          üéÇ ${name}
          <div class="birthday-wish">
            ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Å üå∏
          </div>
        </div>
      `;
    }

    if(dob.day === tmDay && dob.month === tmMonth){
      tomorrowNames.push(name);
    }
  });

  const box = document.getElementById("birthdayScrollBox");
  const inner = document.getElementById("birthdayScrollInner");

  /* Case-1: No birthday today */
  if(!todayHTML){
    inner.innerHTML = `
      <div class="birthday-item">
        üéà ‡§Ü‡§ú ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
      </div>
      ${
        tomorrowNames.length
        ? `<div class="birthday-wish">
             üìÖ ‡§ï‡§≤ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§®: <b>${tomorrowNames.join(", ")}</b>
           </div>`
        : ""
      }
    `;
    box.style.display = "block";
    return;
  }

  /* Case-2: Birthday today */
  if(tomorrowNames.length){
    todayHTML += `
      <div class="birthday-item">
        üìÖ ‡§ï‡§≤ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§®:
        <div class="birthday-wish">
          ${tomorrowNames.join(", ")}
        </div>
      </div>
    `;
  }

  inner.innerHTML = todayHTML + todayHTML;
  box.style.display = "block";

  let pos = 0;
  function scroll(){
    pos -= 0.35;
    if(Math.abs(pos) >= inner.scrollHeight/2) pos = 0;
    inner.style.transform = `translateY(${pos}px)`;
    requestAnimationFrame(scroll);
  }
  scroll();

})();
</script>

<script>
/* ================= üéÇ FINAL BIRTHDAY LOGIC (WITH CLASS) ================= */
(async function(){

  const SHEET_ID = "1BtoDja9imrMyHMKt5oqSYoOzj9w2GWe13JcbRu1vWO8";
  const SHEET_NAME = "Marksheet Details";

  /* DOB Parser: Date Object + Date(...) + String */
  function parseDOB(cell){
    if(!cell) return null;

    if(typeof cell === "object" && cell instanceof Date){
      return { day: cell.getDate(), month: cell.getMonth()+1 };
    }

    if(typeof cell === "string" && cell.startsWith("Date(")){
      const m = cell.match(/Date\((\d+),(\d+),(\d+)\)/);
      if(m){
        return { day:+m[3], month:+m[2]+1 };
      }
    }

    const p = cell.toString().split(/[-\/]/);
    if(p.length === 3){
      return (p[0].length === 4)
        ? { day:+p[2], month:+p[1] }
        : { day:+p[0], month:+p[1] };
    }
    return null;
  }

  const url =
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;

  const res = await fetch(url);
  const txt = await res.text();
  const table = JSON.parse(txt.replace(/^[^{]*/,"").replace(/\);$/,"")).table;

  const cols = table.cols.map(c=>c.label);
  const rows = table.rows;

  const nameCol  = cols.indexOf("Student Name");
  const dobCol   = cols.indexOf("Date of Birth");
  const classCol = cols.indexOf("Class");   // üëà NEW

  if(nameCol < 0 || dobCol < 0) return;

  const today = new Date();
  const tDay = today.getDate();
  const tMonth = today.getMonth()+1;

  let html = "";

  rows.forEach(r=>{
    const dob = parseDOB(r.c[dobCol]?.v);
    if(dob && dob.day === tDay && dob.month === tMonth){

      const name = r.c[nameCol]?.v || "";
      const cls  = classCol >= 0 ? (r.c[classCol]?.v || "") : "";

      html += `
        <div class="birthday-item">
          üéÇ ${name}
          ${cls ? `<div class="birthday-wish">Class: <b>${cls}</b></div>` : ""}
          <div class="birthday-wish">
            ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Å üå∏
          </div>
        </div>
      `;
    }
  });

  const box = document.getElementById("birthdayScrollBox");
  const inner = document.getElementById("birthdayScrollInner");

  if(!html){
    inner.innerHTML =
      "<div class='birthday-item'>üéà ‡§Ü‡§ú ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>";
    box.style.display = "block";
    return;
  }

  /* Infinite scroll */
  inner.innerHTML = html + html;
  box.style.display = "block";

  let pos = 0;
  function scroll(){
    pos -= 0.35;
    if(Math.abs(pos) >= inner.scrollHeight/2) pos = 0;
    inner.style.transform = `translateY(${pos}px)`;
    requestAnimationFrame(scroll);
  }
  scroll();

})();
</script>

<style>
/* üå∏ Flower */
.flower{
  position:absolute;
  top:-40px;
  font-size:26px;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);opacity:0}
}

/* üáÆüá≥ Flag */
.flag{
  position:absolute;
  top:10px;
  font-size:34px;
  animation:wave 3s ease-in-out infinite;
}
@keyframes wave{
  50%{transform:translateX(25px)}
}

/* ü™î Diya */
.diya{
  position:absolute;
  bottom:20px;
  font-size:36px;
  animation:glow 2s ease-in-out infinite;
}
@keyframes glow{
  50%{filter:drop-shadow(0 0 22px gold)}
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function(){

  const popup = document.getElementById("popupOverlay");
  const titleEl = document.getElementById("popupTitle");
  const textEl  = document.getElementById("popupText");
  const countEl = document.getElementById("popupCountdown");
  const music   = document.getElementById("festivalMusic");
  const layer   = document.getElementById("festivalAnimationLayer");


  const festivals = {
  /* NATIONAL / SCHOOL */
  "01-01": {
    title:"üéâ ‡§®‡§µ ‡§µ‡§∞‡•ç‡§∑",
    text:"üéâ ‡§®‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§∑ ‡§®‡§à ‡§Ü‡§∂‡§æ‡§è‡§Å, ‡§®‡§à ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§î‡§∞ ‡§®‡§à ‡§∏‡§´‡§≤‡§§‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§Ü‡§Ø‡§æ, ‡§™‡•Ç‡§∞‡•á ‡§â‡§§‡•ç‡§∏‡§æ‡§π ‡§∏‡•á ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç‡•§",
    type:"flower",
    voice:"‡§®‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§∑ ‡§®‡§à ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§î‡§∞ ‡§®‡§à ‡§Ü‡§∂‡§æ‡§è‡§Å ‡§≤‡•á‡§ï‡§∞ ‡§Ü‡§Ø‡§æ ‡§π‡•à, ‡§™‡•Ç‡§∞‡•á ‡§â‡§§‡•ç‡§∏‡§æ‡§π ‡§∏‡•á ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç‡•§"
  },

  "01-12": {
    title:"üë§ ‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§µ‡•á‡§ï‡§æ‡§®‡§Ç‡§¶ ‡§ú‡§Ø‡§Ç‡§§‡•Ä",
    text:"üë§ ‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§µ‡•á‡§ï‡§æ‡§®‡§Ç‡§¶ ‡§ï‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§Ø‡•Å‡§µ‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏, ‡§ö‡§∞‡§ø‡§§‡•ç‡§∞ ‡§î‡§∞ ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    type:"flower",
    voice:"‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§µ‡•á‡§ï‡§æ‡§®‡§Ç‡§¶ ‡§ï‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§Ø‡•Å‡§µ‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§î‡§∞ ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },

  "01-23": {
    title:"üë§ ‡§®‡•á‡§§‡§æ‡§ú‡•Ä ‡§∏‡•Å‡§≠‡§æ‡§∑ ‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§¨‡•ã‡§∏ ‡§ú‡§Ø‡§Ç‡§§‡•Ä",
    text:"üë§ ‡§®‡•á‡§§‡§æ‡§ú‡•Ä ‡§∏‡•Å‡§≠‡§æ‡§∑ ‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§¨‡•ã‡§∏ ‡§ï‡§æ ‡§ú‡•Ä‡§µ‡§® ‡§∏‡§æ‡§π‡§∏, ‡§§‡•ç‡§Ø‡§æ‡§ó ‡§î‡§∞ ‡§¶‡•á‡§∂‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡•Ä ‡§Ö‡§Æ‡§∞ ‡§Æ‡§ø‡§∏‡§æ‡§≤ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§®‡•á‡§§‡§æ‡§ú‡•Ä ‡§∏‡•Å‡§≠‡§æ‡§∑ ‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§¨‡•ã‡§∏ ‡§ï‡§æ ‡§ú‡•Ä‡§µ‡§® ‡§∏‡§æ‡§π‡§∏, ‡§§‡•ç‡§Ø‡§æ‡§ó ‡§î‡§∞ ‡§¶‡•á‡§∂‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡•Ä ‡§Æ‡§ø‡§∏‡§æ‡§≤ ‡§π‡•à‡•§"
  },

  "01-26": {
    title:"üáÆüá≥ ‡§ó‡§£‡§§‡§Ç‡§§‡•ç‡§∞ ‡§¶‡§ø‡§µ‡§∏",
    text:"üáÆüá≥ ‡§Ü‡§ú ‡§π‡§Æ ‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§®, ‡§≤‡•ã‡§ï‡§§‡§Ç‡§§‡•ç‡§∞ ‡§î‡§∞ ‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§è‡§ï‡§§‡§æ, ‡§Ö‡§ñ‡§Ç‡§°‡§§‡§æ ‡§ï‡§æ ‡§ó‡•å‡§∞‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§â‡§§‡•ç‡§∏‡§µ ‡§Æ‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    type:"flag",
    voice:"‡§Ü‡§ú ‡§π‡§Æ ‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§® ‡§î‡§∞ ‡§≤‡•ã‡§ï‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§î‡§∞ ‡§¶‡•á‡§∂‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§â‡§§‡•ç‡§∏‡§µ ‡§Æ‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },

  "04-14": {
    title:"üë§ ‡§°‡•â. ‡§≠‡•Ä‡§Æ‡§∞‡§æ‡§µ ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ú‡§Ø‡§Ç‡§§‡•Ä",
    text:"üë§ ‡§°‡•â. ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ï‡§æ ‡§ú‡•Ä‡§µ‡§® ‡§∏‡§Æ‡§æ‡§®‡§§‡§æ, ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§î‡§∞ ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§®‡•ç‡§Ø‡§æ‡§Ø ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§°‡•â. ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ï‡§æ ‡§ú‡•Ä‡§µ‡§® ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ, ‡§∏‡§Æ‡§æ‡§®‡§§‡§æ ‡§î‡§∞ ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§®‡•ç‡§Ø‡§æ‡§Ø ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§"
  },

  "05-01": {
    title:"üßë‚Äçüè≠ ‡§∂‡•ç‡§∞‡§Æ‡§ø‡§ï ‡§¶‡§ø‡§µ‡§∏",
    text:"üßë‚Äçüè≠ ‡§∂‡•ç‡§∞‡§Æ‡§ø‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§∞‡§ø‡§∂‡•ç‡§∞‡§Æ ‡§∏‡§Æ‡§æ‡§ú ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø, ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§î‡§∞ ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•Ä ‡§®‡•Ä‡§Ç‡§µ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§∂‡•ç‡§∞‡§Æ‡§ø‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§∞‡§ø‡§∂‡•ç‡§∞‡§Æ ‡§∏‡§Æ‡§æ‡§ú ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§î‡§∞ ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•Ä ‡§®‡•Ä‡§Ç‡§µ ‡§π‡•à‡•§"
  },

  "09-05": {
    title:"üë©‚Äçüè´ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§¶‡§ø‡§µ‡§∏",
    text:"üë©‚Äçüè´ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§ú‡•ç‡§û‡§æ‡§®, ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•á ‡§∏‡§ö‡•ç‡§ö‡•á ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§ï ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç, ‡§π‡§Æ ‡§®‡§Æ‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    type:"flower",
    voice:"‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§ú‡•ç‡§û‡§æ‡§® ‡§î‡§∞ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§¶‡•á‡§ï‡§∞ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§ú‡•ç‡§ú‡•ç‡§µ‡§≤ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },

  "10-02": {
    title:"üôè ‡§ó‡§æ‡§Ç‡§ß‡•Ä ‡§ú‡§Ø‡§Ç‡§§‡•Ä",
    text:"üôè ‡§Æ‡§π‡§æ‡§§‡•ç‡§Æ‡§æ ‡§ó‡§æ‡§Ç‡§ß‡•Ä ‡§ï‡•á ‡§∏‡§§‡•ç‡§Ø, ‡§Ö‡§π‡§ø‡§Ç‡§∏‡§æ ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ ‡§ï‡•á ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§π‡§Æ‡•á‡§Ç ‡§∏‡§π‡•Ä ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§¶‡§ø‡§ñ‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    type:"flower",
    voice:"‡§Æ‡§π‡§æ‡§§‡•ç‡§Æ‡§æ ‡§ó‡§æ‡§Ç‡§ß‡•Ä ‡§ï‡•á ‡§∏‡§§‡•ç‡§Ø ‡§î‡§∞ ‡§Ö‡§π‡§ø‡§Ç‡§∏‡§æ ‡§ï‡•á ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§π‡§Æ‡•á‡§Ç ‡§∏‡§π‡•Ä ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§¶‡§ø‡§ñ‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },

  "10-31": {
    title:"üë§ ‡§∏‡§∞‡§¶‡§æ‡§∞ ‡§™‡§ü‡•á‡§≤ ‡§ú‡§Ø‡§Ç‡§§‡•Ä",
    text:"üë§ ‡§∏‡§∞‡§¶‡§æ‡§∞ ‡§™‡§ü‡•á‡§≤ ‡§®‡•á ‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§è‡§ï‡§§‡§æ, ‡§Ö‡§ñ‡§Ç‡§°‡§§‡§æ ‡§î‡§∞ ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§∏‡•Å‡§¶‡•É‡§¢‡§º ‡§ï‡§ø‡§Ø‡§æ‡•§",
    type:"flower",
    voice:"‡§∏‡§∞‡§¶‡§æ‡§∞ ‡§™‡§ü‡•á‡§≤ ‡§®‡•á ‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§è‡§ï‡§§‡§æ ‡§î‡§∞ ‡§Ö‡§ñ‡§Ç‡§°‡§§‡§æ ‡§ï‡•ã ‡§∏‡•Å‡§¶‡•É‡§¢‡§º ‡§¨‡§®‡§æ‡§Ø‡§æ‡•§"
  },

  "11-14": {
    title:"üë∂ ‡§¨‡§æ‡§≤ ‡§¶‡§ø‡§µ‡§∏",
    text:"üë∂ ‡§¨‡§ö‡•ç‡§ö‡•á ‡§¶‡•á‡§∂ ‡§ï‡§æ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§π‡•à‡§Ç, ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§™‡•ç‡§∞‡•á‡§Æ, ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§î‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§¶‡•á‡§®‡§æ ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§ï‡§∞‡•ç‡§§‡§µ‡•ç‡§Ø ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§¨‡§ö‡•ç‡§ö‡•á ‡§¶‡•á‡§∂ ‡§ï‡§æ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§π‡•à‡§Ç, ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§™‡•ç‡§∞‡•á‡§Æ ‡§î‡§∞ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§¶‡•á‡§®‡§æ ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§ï‡§∞‡•ç‡§§‡§µ‡•ç‡§Ø ‡§π‡•à‡•§"
  },

  "12-25": {
    title:"üéÑ ‡§ï‡•ç‡§∞‡§ø‡§∏‡§Æ‡§∏",
    text:"üéÑ ‡§ï‡•ç‡§∞‡§ø‡§∏‡§Æ‡§∏ ‡§™‡•ç‡§∞‡•á‡§Æ, ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§î‡§∞ ‡§Æ‡§æ‡§®‡§µ‡§§‡§æ ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¶‡•á‡§§‡§æ ‡§π‡•à, ‡§Æ‡§ø‡§≤‡§ú‡•Å‡§≤ ‡§ï‡§∞ ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡§æ‡§Å ‡§Æ‡§®‡§æ‡§è‡§Å‡•§",
    type:"flower",
    voice:"‡§ï‡•ç‡§∞‡§ø‡§∏‡§Æ‡§∏ ‡§™‡•ç‡§∞‡•á‡§Æ, ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§î‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¶‡•á‡§§‡§æ ‡§π‡•à, ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡§æ‡§Å ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§"
  },

  /* HINDU ‚Äì 2026 */
  "01-14": {
    title:"ü™î ‡§Æ‡§ï‡§∞ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡§ø",
    text:"ü™î ‡§Æ‡§ï‡§∞ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡§ø ‡§∏‡•Ç‡§∞‡•ç‡§Ø, ‡§ï‡•É‡§∑‡§ø ‡§î‡§∞ ‡§®‡§à ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§∏‡•Å‡§ñ ‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡§ø ‡§≤‡§æ‡§è‡•§",
    type:"flower",
    voice:"‡§Æ‡§ï‡§∞ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡§ø ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§î‡§∞ ‡§®‡§à ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§∏‡•Å‡§ñ ‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡§ø ‡§≤‡§æ‡§è‡•§"
  },

  "02-15": {
    title:"üî± ‡§Æ‡§π‡§æ‡§∂‡§ø‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø",
    text:"üî± ‡§Æ‡§π‡§æ‡§∂‡§ø‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø ‡§Ü‡§§‡•ç‡§Æ‡§∂‡•Å‡§¶‡•ç‡§ß‡§ø, ‡§∏‡§Ç‡§Ø‡§Æ ‡§î‡§∞ ‡§≠‡§ó‡§µ‡§æ‡§® ‡§∂‡§ø‡§µ ‡§ï‡•Ä ‡§Ü‡§∞‡§æ‡§ß‡§®‡§æ ‡§ï‡§æ ‡§™‡§æ‡§µ‡§® ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§Æ‡§π‡§æ‡§∂‡§ø‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø ‡§∏‡§Ç‡§Ø‡§Æ ‡§î‡§∞ ‡§≠‡§ó‡§µ‡§æ‡§® ‡§∂‡§ø‡§µ ‡§ï‡•Ä ‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§™‡§æ‡§µ‡§® ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§"
  },

  "03-04": {
    title:"üé® ‡§π‡•ã‡§≤‡•Ä",
    text:"üé® ‡§π‡•ã‡§≤‡•Ä ‡§∞‡§Ç‡§ó‡•ã‡§Ç, ‡§™‡•ç‡§∞‡•á‡§Æ ‡§î‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§∏‡§≠‡•Ä ‡§ï‡•á ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•á‡§Ç ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡§æ‡§Å ‡§≤‡§æ‡§è‡•§",
    type:"flower",
    voice:"‡§π‡•ã‡§≤‡•Ä ‡§∞‡§Ç‡§ó‡•ã‡§Ç ‡§î‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•á‡§Ç ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡§æ‡§Å ‡§≤‡§æ‡§è‡•§"
  },

  "03-26": {
    title:"üö© ‡§∞‡§æ‡§Æ ‡§®‡§µ‡§Æ‡•Ä",
    text:"üö© ‡§∞‡§æ‡§Æ ‡§®‡§µ‡§Æ‡•Ä ‡§Æ‡§∞‡•ç‡§Ø‡§æ‡§¶‡§æ, ‡§ß‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡§¶‡§æ‡§Ø‡§ï ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§∞‡§æ‡§Æ ‡§®‡§µ‡§Æ‡•Ä ‡§ß‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§"
  },

  "09-05": {
    title:"üë∂ ‡§ï‡•É‡§∑‡•ç‡§£ ‡§ú‡§®‡•ç‡§Æ‡§æ‡§∑‡•ç‡§ü‡§Æ‡•Ä",
    text:"üë∂ ‡§ú‡§®‡•ç‡§Æ‡§æ‡§∑‡•ç‡§ü‡§Æ‡•Ä ‡§≠‡§ï‡•ç‡§§‡§ø, ‡§™‡•ç‡§∞‡•á‡§Æ ‡§î‡§∞ ‡§∂‡•ç‡§∞‡•Ä‡§ï‡•É‡§∑‡•ç‡§£ ‡§ï‡•á ‡§ú‡•Ä‡§µ‡§® ‡§Ü‡§¶‡§∞‡•ç‡§∂‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§æ‡§µ‡§® ‡§â‡§§‡•ç‡§∏‡§µ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§ú‡§®‡•ç‡§Æ‡§æ‡§∑‡•ç‡§ü‡§Æ‡•Ä ‡§∂‡•ç‡§∞‡•Ä‡§ï‡•É‡§∑‡•ç‡§£ ‡§ï‡•á ‡§ú‡•Ä‡§µ‡§® ‡§Ü‡§¶‡§∞‡•ç‡§∂‡•ã‡§Ç ‡§î‡§∞ ‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§™‡§æ‡§µ‡§® ‡§â‡§§‡•ç‡§∏‡§µ ‡§π‡•à‡•§"
  },

  "10-19": {
    title:"üèπ ‡§¶‡§∂‡§π‡§∞‡§æ",
    text:"üèπ ‡§¶‡§∂‡§π‡§∞‡§æ ‡§∏‡§§‡•ç‡§Ø ‡§ï‡•Ä ‡§µ‡§ø‡§ú‡§Ø, ‡§¨‡•Å‡§∞‡§æ‡§à ‡§™‡§∞ ‡§Ö‡§ö‡•ç‡§õ‡§æ‡§à ‡§ï‡•Ä ‡§ú‡•Ä‡§§ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§¶‡§∂‡§π‡§∞‡§æ ‡§¨‡•Å‡§∞‡§æ‡§à ‡§™‡§∞ ‡§Ö‡§ö‡•ç‡§õ‡§æ‡§à ‡§ï‡•Ä ‡§µ‡§ø‡§ú‡§Ø ‡§î‡§∞ ‡§∏‡§§‡•ç‡§Ø ‡§ï‡•Ä ‡§ú‡•Ä‡§§ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§π‡•à‡•§"
  },

  "11-08": {
    title:"ü™î ‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä",
    text:"ü™î ‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂, ‡§Ü‡§∂‡§æ ‡§î‡§∞ ‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•á‡§Ç ‡§â‡§ú‡§æ‡§≤‡§æ ‡§≤‡§æ‡§è‡•§",
    type:"flower",
    voice:"‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§î‡§∞ ‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•á‡§Ç ‡§â‡§ú‡§æ‡§≤‡§æ ‡§≤‡§æ‡§è‡•§"
  },

  "11-19": {
    title:"üåû ‡§õ‡§† ‡§™‡•Ç‡§ú‡§æ",
    text:"üåû ‡§õ‡§† ‡§™‡•Ç‡§ú‡§æ ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§â‡§™‡§æ‡§∏‡§®‡§æ, ‡§∂‡•ç‡§∞‡§¶‡•ç‡§ß‡§æ ‡§î‡§∞ ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞‡§ø‡§ï ‡§∏‡•Å‡§ñ ‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡§æ ‡§Æ‡§π‡§æ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§õ‡§† ‡§™‡•Ç‡§ú‡§æ ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§â‡§™‡§æ‡§∏‡§®‡§æ ‡§î‡§∞ ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞‡§ø‡§ï ‡§∏‡•Å‡§ñ ‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡§æ ‡§™‡§æ‡§µ‡§® ‡§™‡§∞‡•ç‡§µ ‡§π‡•à‡•§"
  },

  /* MUSLIM ‚Äì 2026 */
  "03-21": {
    title:"üåô ‡§à‡§¶-‡§â‡§≤-‡§´‡§ø‡§§‡§∞",
    text:"üåô ‡§à‡§¶-‡§â‡§≤-‡§´‡§ø‡§§‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á, ‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§î‡§∞ ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§Æ‡•Å‡§¨‡§æ‡§∞‡§ï‡•§",
    type:"flower",
    voice:"‡§à‡§¶-‡§â‡§≤-‡§´‡§ø‡§§‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á ‡§î‡§∞ ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§∞‡•ç‡§µ ‡§π‡•à, ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§Æ‡•Å‡§¨‡§æ‡§∞‡§ï‡•§"
  },

  "05-27": {
    title:"üåô ‡§à‡§¶-‡§â‡§≤-‡§Ö‡§ú‡§º‡§π‡§æ",
    text:"üåô ‡§à‡§¶-‡§â‡§≤-‡§Ö‡§ú‡§º‡§π‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ó, ‡§∏‡§Æ‡§∞‡•ç‡§™‡§£ ‡§î‡§∞ ‡§Æ‡§æ‡§®‡§µ‡§§‡§æ ‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡•ã ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§à‡§¶-‡§â‡§≤-‡§Ö‡§ú‡§º‡§π‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ó ‡§î‡§∞ ‡§Æ‡§æ‡§®‡§µ‡§§‡§æ ‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡•ã ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§"
  },

  "06-27": {
    title:"‚ò™Ô∏è ‡§Æ‡•Å‡§π‡§∞‡•ç‡§∞‡§Æ",
    text:"‚ò™Ô∏è ‡§Æ‡•Å‡§π‡§∞‡•ç‡§∞‡§Æ ‡§¨‡§≤‡§ø‡§¶‡§æ‡§®, ‡§∏‡§§‡•ç‡§Ø ‡§î‡§∞ ‡§®‡•ç‡§Ø‡§æ‡§Ø ‡§ï‡•á ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§™‡§∞ ‡§ö‡§≤‡§®‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§Æ‡•Å‡§π‡§∞‡•ç‡§∞‡§Æ ‡§∏‡§§‡•ç‡§Ø ‡§î‡§∞ ‡§®‡•ç‡§Ø‡§æ‡§Ø ‡§ï‡•á ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§™‡§∞ ‡§ö‡§≤‡§®‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§"
  },

  "08-26": {
    title:"‚ò™Ô∏è ‡§à‡§¶-‡§Æ‡§ø‡§≤‡§æ‡§¶-‡§â‡§®-‡§®‡§¨‡•Ä",
    text:"‚ò™Ô∏è ‡§à‡§¶-‡§Æ‡§ø‡§≤‡§æ‡§¶-‡§â‡§®-‡§®‡§¨‡•Ä ‡§™‡•à‡§ó‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂, ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§î‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á ‡§ï‡•Ä ‡§Ø‡§æ‡§¶ ‡§¶‡§ø‡§≤‡§æ‡§§‡§æ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§à‡§¶-‡§Æ‡§ø‡§≤‡§æ‡§¶-‡§â‡§®-‡§®‡§¨‡•Ä ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§î‡§∞ ‡§≠‡§æ‡§à‡§ö‡§æ‡§∞‡•á ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§"
  },

  /* SIKH */
  "11-24": {
    title:"ü™Ø ‡§ó‡•Å‡§∞‡•Å ‡§®‡§æ‡§®‡§ï ‡§ú‡§Ø‡§Ç‡§§‡•Ä",
    text:"ü™Ø ‡§ó‡•Å‡§∞‡•Å ‡§®‡§æ‡§®‡§ï ‡§¶‡•á‡§µ ‡§ú‡•Ä ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡§§‡•ç‡§Ø, ‡§∏‡•á‡§µ‡§æ ‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§®‡§§‡§æ ‡§∏‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§",
    type:"flower",
    voice:"‡§ó‡•Å‡§∞‡•Å ‡§®‡§æ‡§®‡§ï ‡§¶‡•á‡§µ ‡§ú‡•Ä ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡§§‡•ç‡§Ø, ‡§∏‡•á‡§µ‡§æ ‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§®‡§§‡§æ ‡§∏‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§"
  }

};


  const d = new Date();
  const key =
    String(d.getMonth()+1).padStart(2,"0") + "-" +
    String(d.getDate()).padStart(2,"0");

  if(!festivals[key]) return;

  const fest = festivals[key];

  /* SHOW POPUP */
  popup.style.display = "flex";
  titleEl.innerText = fest.title;
  textEl.innerText =
    "S.B. PUBLIC SCHOOL ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡•Ä ‡§ì‡§∞ ‡§∏‡•á\n\n" +
    fest.text + "‡•§\n\n" +
    "‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Å‡•§";

  /* üé§ VOICE */
  if("speechSynthesis" in window){
    speechSynthesis.cancel();
    const voiceText =
      "‡§è‡§∏ ‡§¨‡•Ä ‡§™‡§¨‡•ç‡§≤‡§ø‡§ï ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡•Ä ‡§ì‡§∞ ‡§∏‡•á‡•§ " +
      fest.voice + "‡•§ " +
      "‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Å‡•§";

    const u = new SpeechSynthesisUtterance(voiceText);
    u.lang = "hi-IN";
    u.rate = 0.9;
    speechSynthesis.speak(u);
  }

  /* üé∂ MUSIC */
  setTimeout(()=>{
    music.currentTime = 0;
    music.play().catch(()=>{});
  },800);

  /* üéÜ ANIMATION */
  layer.innerHTML="";
  if(fest.type==="flag"){
    for(let i=0;i<6;i++){
      const t=document.createElement("div");
      t.className="flag"; t.innerText="üáÆüá≥";
      t.style.left=(i*15+5)+"%";
      layer.appendChild(t);
    }
  }else{
    for(let i=0;i<20;i++){
      const f=document.createElement("div");
      f.className="flower"; f.innerText="üå∏";
      f.style.left=Math.random()*100+"%";
      f.style.animationDuration=(6+Math.random()*6)+"s";
      layer.appendChild(f);
    }
  }

  /* COUNTDOWN */
  let timeLeft = 20; // ‚è±Ô∏è ‡§Ø‡§π‡§æ‡§Å ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç
  countEl.innerText = timeLeft + " ‡§∏‡•á‡§ï‡§Ç‡§° ‡§∂‡•á‡§∑‚Ä¶";

  const timer = setInterval(()=>{
    timeLeft--;
    countEl.innerText = timeLeft + " ‡§∏‡•á‡§ï‡§Ç‡§° ‡§∂‡•á‡§∑‚Ä¶";
    if(timeLeft<=0){
      clearInterval(timer);
      popup.style.display="none";
      layer.innerHTML="";
      music.pause();
      music.currentTime=0;
    }
  },1000);

});
</script>


<style>

/* ===============================
   üîµ BLUE THEME ‚Äì WHITE 3D POPUP
   =============================== */

#festivalAnimationLayer{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:999998;
}

/* üéâ TITLE */
#popupTitle{
  font-size:38px;
  font-weight:900;
  color:#ffffff;
  letter-spacing:1px;
  text-shadow:
    0 2px 0 rgba(0,0,0,0.35),
    0 5px 0 rgba(0,0,0,0.25),
    0 10px 22px rgba(0,0,0,0.55);
  animation:titleFloat 3s ease-in-out infinite;
}

/* üìù TEXT */
#popupText{
  margin-top:22px;
  font-size:22px;
  font-weight:700;
  line-height:1.9;
  color:#ffffff;
  text-shadow:
    0 1px 0 rgba(0,0,0,0.35),
    0 4px 10px rgba(0,0,0,0.55);
  animation:textGlow 4s ease-in-out infinite;
}

/* ‚è±Ô∏è COUNTDOWN */
#popupCountdown{
  margin-top:26px;
  font-size:20px;
  font-weight:900;
  color:#ffffff;
  text-shadow:
    0 2px 0 rgba(0,0,0,0.45),
    0 6px 14px rgba(0,0,0,0.65);
  animation:pulse 1.2s ease-in-out infinite;
}

/* üå∏ FLOWER */
.flower{
  position:absolute;
  top:-40px;
  font-size:26px;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);opacity:0}
}

/* üáÆüá≥ FLAG */
.flag{
  position:absolute;
  top:10px;
  font-size:34px;
  animation:wave 3s ease-in-out infinite;
}
@keyframes wave{
  50%{transform:translateX(25px)}
}

/* ‚ú® ANIMATIONS */
@keyframes titleFloat{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
}
@keyframes textGlow{
  0%,100%{opacity:1}
  50%{opacity:0.92}
}
@keyframes pulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.08)}
}
</style>

<style>
/* ==============================
   üîß TEXT SIZE & SPACING CONTROL
   ============================== */

:root{
  --popup-title-size: 38px;   /* üîπ Title ‡§¨‡§°‡§º‡§æ/‡§õ‡•ã‡§ü‡§æ */
  --popup-text-size: 22px;    /* üîπ Main text size */
  --popup-line-gap: 1.9;      /* üîπ Line spacing (‡§õ‡§ø‡§ü‡§æ) */
  --popup-count-size: 20px;   /* üîπ Countdown size */
}
</style>

<script>
/* üõë ENSURE POPUP NEVER AUTO-SHOW festivals VOICE */
const _popup = document.getElementById("popupOverlay");
if (_popup) _popup.style.display = "none";

/* ‚è±Ô∏è SHOW AFTER 17 SECONDS */
setTimeout(() => {
  if (!_popup) return;

  _popup.style.display = "flex";

  // üé§ Voice
  const txt = document.getElementById("popupText");
  if (txt && window.speechSynthesis) {
    const u = new SpeechSynthesisUtterance(txt.innerText);
    u.lang = "hi-IN";
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }
}, 17000);
</script>

<!-- üìû HELP LINE MODAL -->
<div id="helpModal" style="display:none;position:fixed;inset:0;
background:rgba(0,0,0,.55);z-index:100000;
align-items:center;justify-content:center">

  <div style="background:#fff;width:360px;max-width:94%;
  border-radius:14px;padding:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.35)">

    <h3 style="margin:0 0 10px;color:#0b5fa8">üìû Help Line Form</h3>

    <form id="helpForm">
      <input name="studentName" required placeholder="Student Name"
        style="width:100%;padding:8px;margin-bottom:6px">

      <input name="fatherName" required placeholder="Father Name"
        style="width:100%;padding:8px;margin-bottom:6px">

      <input name="motherName" required placeholder="Mother Name"
        style="width:100%;padding:8px;margin-bottom:6px">

      <input name="mobile" required placeholder="Mobile Number"
        style="width:100%;padding:8px;margin-bottom:6px">

      <input type="date" name="dob" required
        style="width:100%;padding:8px;margin-bottom:6px">

      <input name="className" required placeholder="Class"
        style="width:100%;padding:8px;margin-bottom:6px">

      <textarea name="address" required placeholder="Address"
        style="width:100%;padding:8px"></textarea>

<textarea
  name="feedback"
  required
  placeholder="‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ / FeedBack ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç"
  style="width:100%;padding:8px;margin-top:6px">
</textarea>

      <button type="submit"
        style="margin-top:10px;width:100%;
        background:#0b5fa8;color:#fff;
        padding:10px;border:0;border-radius:8px;
        font-weight:700">
        Submit
      </button>
    </form>

    <p id="helpResult"
       style="margin-top:10px;font-weight:800;color:#0b5fa8"></p>

    <button onclick="closeHelp()"
      style="margin-top:6px;width:100%;padding:6px">
      Close
    </button>
  </div>
</div>

<script>
const HELP_API =
"https://script.google.com/macros/s/AKfycbw5CydFSyrYjnDD__s7GqXnW_JYEhrKvKbxg80g9PkY5lTwEScir_FXnlNp8Sh69pYhmA/exec"; 
// ‚¨ÜÔ∏è ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡§æ Apps Script Web App URL ‡§°‡§æ‡§≤‡•á‡§Ç

// Open popup
document.getElementById("helpLineBtn").onclick = () => {
  document.getElementById("helpModal").style.display = "flex";
};

// Close popup
function closeHelp(){
  document.getElementById("helpModal").style.display = "none";
}

// Submit form
document.getElementById("helpForm").addEventListener("submit", function(e){
  e.preventDefault();

  const data = Object.fromEntries(new FormData(this).entries());

  fetch(HELP_API,{
    method:"POST",
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    if(res.status === "success"){

      const name = data.studentName;

      const message =
        name +
        " , ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§¨‡§π‡•Å‡§§ ‡§ú‡§≤‡•ç‡§¶ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ " +
        "‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§ü‡•Ä‡§Æ ‡§¨‡§π‡•Å‡§§ ‡§ú‡§≤‡•ç‡§¶ ‡§Ü‡§™ ‡§∏‡•á ‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§ó‡•Ä‡•§ " +
        "‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§";

      // ‚úÖ Text message
      document.getElementById("helpResult").innerHTML =
        "‚úÖ " + message +
        "<br>Admission No: <b>" + res.admissionNo + "</b>";

      // ‚úÖ Hindi Voice
      if ("speechSynthesis" in window) {
        speechSynthesis.cancel();
        const voice = new SpeechSynthesisUtterance(message);
        voice.lang = "hi-IN";
        voice.rate = 0.9;
        voice.pitch = 1;
        speechSynthesis.speak(voice);
      }

      this.reset();
    } else {
      document.getElementById("helpResult").innerHTML =
        "‚ùå ‡§ï‡•Å‡§õ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§";
    }
  });
});
</script>

<!-- PAYMENT POPUP -->
<div id="paymentBox" style="display:none;position:fixed;inset:0;
background:rgba(0,0,0,.55);z-index:99999;align-items:center;justify-content:center">

<div style="background:#fff;width:380px;max-width:95%;padding:16px;border-radius:14px">

<h3 style="color:#0b5fa8">üí≥ Online Fee Payment</h3>

<img id="upiQR" style="width:100%;border-radius:10px;margin-bottom:10px">

<!-- üîÅ UPI REDIRECT BUTTONS -->
<div style="display:flex;gap:10px;margin-bottom:12px;flex-wrap:wrap">
  <button type="button" class="upiBtn phonepe" onclick="payUPI()">üì± PhonePe</button>
  <button type="button" class="upiBtn gpay" onclick="payUPI()">üí≥ Google Pay</button>
  <button type="button" class="upiBtn paytm" onclick="payUPI()">üí∞ Paytm</button>
</div>

<form id="paymentForm">
<input name="studentName" placeholder="Student Name" required style="width:100%;padding:8px;margin-bottom:6px">
<input name="fatherName" placeholder="Father Name" required style="width:100%;padding:8px;margin-bottom:6px">
<input name="mobile" placeholder="Mobile Number" required style="width:100%;padding:8px;margin-bottom:6px">
<input id="payDate" name="month" readonly style="width:100%;padding:8px;margin-bottom:6px">
<textarea name="address" placeholder="Address" required style="width:100%;padding:8px;margin-bottom:6px"></textarea>
<input name="upiTxn" placeholder="UPI Transaction ID" required style="width:100%;padding:8px;margin-bottom:6px">
<input type="file" id="payScreenshot" accept="image/*" required style="width:100%;margin-bottom:6px">
<textarea name="feedback" placeholder="FeedBack / Remark" style="width:100%;padding:8px"></textarea>

<button type="submit" id="submitPaymentBtn"
style="margin-top:10px;width:100%;background:#0b5fa8;color:#fff;
padding:10px;border-radius:8px;border:0;font-weight:700">
Submit Payment
</button>
</form>

<p id="payMsg" style="font-weight:800;margin-top:8px"></p>
<button onclick="closePay()" style="margin-top:6px;width:100%">Close</button>

</div>
</div>

<div id="paymentLoadingOverlay"
style="display:none;position:fixed;inset:0;z-index:999999;
background:rgba(0,0,0,.6);align-items:center;justify-content:center;
flex-direction:column;color:#fff;font-size:18px;font-weight:800">
  <div style="width:50px;height:50px;border:6px solid #fff;
  border-top-color:#ffb703;border-radius:50%;
  animation:spin 1s linear infinite;margin-bottom:14px"></div>
  ‚è≥ Processing Payment, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç...
</div>
<style>@keyframes spin{to{transform:rotate(360deg)}}</style>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const PAY_API = "https://script.google.com/macros/s/AKfycbzvvXEEUjkRyc0bRps25xtGY6oUl4fyj80x7_JKLlOm7W15YQWZ3Ov4gf3A5w8LtkRCqQ/exec";
  const QR_IMAGE = "images/upi_qr.jpeg";
  const overlay = document.getElementById("paymentLoadingOverlay");

  openPayment.onclick = () => {
    paymentBox.style.display = "flex";
    upiQR.src = QR_IMAGE;
    const d=new Date();
    payDate.value=String(d.getDate()).padStart(2,'0')+"/"+String(d.getMonth()+1).padStart(2,'0')+"/"+d.getFullYear();
  };

  window.closePay = () => paymentBox.style.display = "none";

  window.payUPI = () => {
    const upi="6389259@axl";
    location.href=`upi://pay?pa=${upi}&pn=S.B.%20Public%20School&cu=INR&tn=School%20Fee`;
  };

  paymentForm.addEventListener("submit", e=>{
    e.preventDefault();
    overlay.style.display="flex";

    const reader=new FileReader();
    const file=payScreenshot.files[0];
    const data=Object.fromEntries(new FormData(paymentForm).entries());

    reader.onload=()=>{
      const p=new URLSearchParams();
      p.append("data",JSON.stringify(data));
      p.append("file",reader.result.split(",")[1]);
      p.append("mimeType",file.type);

      fetch(PAY_API,{method:"POST",body:p})
      .then(r=>r.json())
      .then(res=>{
        overlay.style.display="none";
        if(res.status==="success"){
          const speech=data.studentName+
          ", S.B. Public School ‡§Æ‡•á‡§Ç ‡§´‡•Ä‡§∏ ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶, ‡§Ü‡§™‡§ï‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§ñ‡•Ä ‡§ó‡§à ‡§π‡•à‡•§‡§Ü‡§™ ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§∂‡•Å‡§≠ ‡§π‡•ã";
          payMsg.innerHTML=`‚úÖ ${speech}<br>Admission No: <b>${res.admissionNo}</b>
          <br>Date: ${res.date} | Time: ${res.time}
          <br><a href="${res.screenshot}" target="_blank">üì∏ Screenshot ‡§¶‡•á‡§ñ‡•á‡§Ç</a>`;
          speechSynthesis.speak(new SpeechSynthesisUtterance(speech));
          paymentForm.reset();
        }
      }).catch(()=>overlay.style.display="none");
    };
    reader.readAsDataURL(file);
  });

});
</script>

<!-- üîî FINAL IN-APP ANNOUNCEMENT (DIRECT SHEET DATA) -->
<style>
#liveAlertBar{
  position:fixed;
  top:0;
  left:0;
  right:0;
  background:linear-gradient(90deg,#ff9800,#ff5722);
  color:#fff;
  padding:14px 44px 14px 16px;
  font-size:16px;
  font-weight:700;
  z-index:999999;
  display:none;
  box-shadow:0 6px 20px rgba(0,0,0,.35);
}
#liveAlertBar .title{font-size:17px;margin-bottom:4px}
#liveAlertBar .msg{font-size:15px;font-weight:600}
#liveAlertBar button{
  position:absolute;
  right:12px;
  top:8px;
  background:none;
  border:none;
  color:#fff;
  font-size:26px;
  cursor:pointer;
}
</style>

<div id="liveAlertBar">
  <button onclick="closeLiveAlert()">√ó</button>
  <div class="title" id="liveAlertTitle"></div>
  <div class="msg" id="liveAlertMsg"></div>
</div>

<script>
/* =========================================================
   üì¢ FINAL SCHOOL ANNOUNCEMENT SYSTEM
   üîä Hindi Voice ‚Üí Voice End = Auto Close
   Google Sheet (NO HEADER, DIRECT DATA)
   index.html ONLY
   ========================================================= */

const SHEET_URL =
 "https://docs.google.com/spreadsheets/d/1BtoDja9imrMyHMKt5oqSYoOzj9w2GWe13JcbRu1vWO8/gviz/tq?sheet=Notification&tqx=out:json";

let queue = [];
let showing = false;

// üîä Hindi voice (end detect)
function speakHindi(text, onEnd){
  if(!("speechSynthesis" in window) || !text){
    if(onEnd) onEnd();
    return;
  }
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "hi-IN";
  u.rate = 0.95;
  u.pitch = 1;
  u.onend = onEnd;
  u.onerror = onEnd;
  speechSynthesis.speak(u);
}

// üîî Show alert
function showAlert(title, msg){
  showing = true;

  document.getElementById("liveAlertTitle").innerText =
    title || "S.B. PUBLIC SCHOOL";
  document.getElementById("liveAlertMsg").innerText = msg || "";
  document.getElementById("liveAlertBar").style.display = "block";

  speakHindi(msg, () => {
    setTimeout(closeLiveAlert, 400);
  });
}

// ‚ùå Close alert
function closeLiveAlert(){
  document.getElementById("liveAlertBar").style.display = "none";
  if ("speechSynthesis" in window) speechSynthesis.cancel();
  showing = false;
  setTimeout(showNext, 600);
}

// ‚ñ∂Ô∏è Next alert
function showNext(){
  if(showing) return;
  if(queue.length === 0) return;
  const n = queue.shift();
  showAlert(n.title, n.msg);
}

// üîÅ Load alerts from sheet
async function loadAlerts(){
  try{
    const res = await fetch(SHEET_URL);
    const raw = await res.text();
    const json = JSON.parse(raw.replace(/^[^{]*/, "").replace(/\);$/, ""));
    const rows = json.table.rows;
    if(!rows) return;

    rows.forEach(r=>{
      const title = r.c[0]?.v || "S.B. PUBLIC SCHOOL";
      const msg   = r.c[1]?.v || "";
      if(!msg) return;

      const key = title + "||" + msg;
      if(localStorage.getItem("SBPS_DONE_" + key)) return;

      queue.push({title, msg});
      localStorage.setItem("SBPS_DONE_" + key, "yes");
    });

    if(!showing) showNext();

  }catch(e){
    console.log("Announcement error:", e);
  }
}

// üîÑ Start
setTimeout(loadAlerts, 3000);
setInterval(loadAlerts, 60000);
</script>

<script>
/* ===============================
   üö® FORCE MOBILE FIX (HARD)
   =============================== */
(function(){

  if (window.innerWidth > 768) return;

  console.log("‚úÖ FORCE MOBILE FIX ACTIVE");

  /* 1Ô∏è‚É£ Header reset */
  const header = document.querySelector(".header");
  if(header){
    header.style.position = "relative";
    header.style.padding = "12px 10px";
  }

  /* 2Ô∏è‚É£ Running strip remove */
  const strip = document.querySelector(".school-strip-outer");
  if(strip) strip.remove();

  /* 3Ô∏è‚É£ Admission ticker compress */
  document.querySelectorAll(".admission-news-bar").forEach(el=>{
    el.style.fontSize = "13px";
    el.style.padding = "8px";
    el.style.margin = "8px";
  });

  /* 4Ô∏è‚É£ Grid force column */
  document.querySelectorAll(".grid").forEach(g=>{
    g.style.display = "block";
  });

  /* 5Ô∏è‚É£ Cards spacing */
  document.querySelectorAll(".card").forEach(c=>{
    c.style.padding = "10px";
    c.style.marginBottom = "12px";
    c.style.borderRadius = "10px";
  });

  /* 6Ô∏è‚É£ Notifications height */
  document.querySelectorAll(".notify-wrap").forEach(n=>{
    n.style.height = "150px";
  });

  /* 7Ô∏è‚É£ Quick portals full width */
  document.querySelectorAll(".qp-3d").forEach(btn=>{
    btn.style.width = "100%";
    btn.style.minWidth = "100%";
    btn.style.marginBottom = "10px";
  });

  /* 8Ô∏è‚É£ Search column */
  document.querySelectorAll(".search-row").forEach(r=>{
    r.style.flexDirection = "column";
  });

  /* 9Ô∏è‚É£ Table font */
  document.querySelectorAll("table").forEach(t=>{
    t.style.fontSize = "12px";
  });

  /* üîü Floating bot resize */
  const bot = document.querySelector(".sg-floating");
  if(bot){
    bot.style.width = "60px";
    bot.style.height = "60px";
    bot.style.right = "12px";
    bot.style.bottom = "12px";
  }

})();
</script>

</body>
</html>
