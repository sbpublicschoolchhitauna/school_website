<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>S.B. Public School Chhitauna ‚Äî Student Portal</title>
  <style>
    :root{
      --accent:#0b5fa8; --accent2:#1167b1; --card:#fff; --muted:#54607a;
      --maxWidth:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Arial,Segoe UI,Roboto,Helvetica,sans-serif;
      color:#0f172a;background:linear-gradient(180deg,#eaf4ff,#f7fbff);
      -webkit-text-size-adjust:100%;
      -ms-text-size-adjust:100%;
    }

    /* Header */
    .header{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#fff;text-align:center;padding:16px 12px;border-radius:0 0 12px 12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.12);
      position:sticky; top:0; z-index:9999;
    }
    .header h1{margin:0;font-size:clamp(18px,4vw,26px);font-weight:800}
    .header .meta{margin-top:6px;font-size:13px;opacity:0.95}
    .header .meta small{display:block;font-size:12px;opacity:0.95;margin-top:6px}

    /* strip */
    .school-strip-outer{overflow:hidden;width:100%;margin-top:12px;padding-bottom:8px}
    .school-strip{display:flex;gap:12px;align-items:center;will-change:transform;transform:translateX(0);padding:8px}
    .school-chip{display:inline-block;font-weight:700;font-size:13px;background:rgba(255,255,255,0.06);padding:6px 12px;border-radius:8px;white-space:nowrap}

    /* layout */
    .container{max-width:var(--maxWidth);margin:12px auto;padding:12px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:14px;
      align-items:start;
    }
    @media (max-width:1000px){ .grid{grid-template-columns:1fr 300px} }
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 5px 18px rgba(0,0,0,0.06);margin-bottom:12px}
    h2{margin:0;color:var(--accent);font-size:16px;margin-bottom:8px}
    .small{color:var(--muted);font-size:13px}
    .tabbar{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:8px;background:#f1fbff;border:1px solid #d6ecff;color:var(--accent);cursor:pointer;font-weight:600}
    .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border:0}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:8px 12px;border:0;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block}
    .search-row{display:flex;gap:8px;margin-bottom:8px}
    @media(max-width:640px){.search-row{flex-direction:column} .tabbar{gap:6px}}

    /* responsive table wrapper */
    .table-wrap{
      overflow:auto;border-radius:8px;border:1px solid #eef6ff;padding:6px;background:#fff;
      max-height:420px;
    }
    @media(max-width:900px){.table-wrap{max-height:300px}}
    table{width:100%;border-collapse:collapse;font-size:13px;min-width:600px}
    th,td{padding:8px 10px;border-bottom:1px solid #f1f7ff;text-align:left;vertical-align:middle}
    thead th{background:#f5fbff;color:var(--accent);position:sticky;top:0;z-index:1}
    tbody tr:hover{background:linear-gradient(90deg,rgba(6,95,158,0.02),rgba(17,103,177,0.02))}

    /* allow word wrapping and avoid forcing horizontal scroll when possible */
    td, th { word-break:break-word; white-space:normal; }

    /* notifications */
    .notify-wrap{height:220px;overflow:hidden;position:relative;border-radius:8px}
    .notify-list{position:absolute;left:0;right:0;top:0;will-change:transform}
    .notify-item{padding:10px 12px;border-bottom:1px solid #eef4ff;background:#fff}
    .notify-item .date{font-size:12px;color:var(--accent);font-weight:700}
    .notify-item .text{font-size:14px;margin-top:4px}

    .footer{ text-align:center;margin-top:12px;color:#555;font-size:13px}

    /* ===== Slider styles (single-page embed, responsive) ===== */
    .slider-wrap{max-width:var(--maxWidth);margin:18px auto;position:relative;border-radius:12px;overflow:visible}
    .slider{position:relative;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(16,24,40,0.08);background:#000;transition:height .35s ease}
    .slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .6s ease;will-change:opacity;pointer-events:none}
    .slide.active{opacity:1;pointer-events:auto}
    .slide img{width:100%;height:auto;display:block;object-fit:cover;max-height:65vh}
    .controls{position:absolute;left:12px;right:12px;top:50%;transform:translateY(-50%);display:flex;justify-content:space-between;pointer-events:none}
    .slider-wrap .btn{background:rgba(255,255,255,0.95);border:0;padding:10px;border-radius:999px;cursor:pointer;pointer-events:auto;box-shadow:0 6px 18px rgba(2,6,23,0.12)}
    .dots{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;display:flex;gap:8px;pointer-events:auto}
    .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.85);cursor:pointer;opacity:0.85}
    .dot.active{background:var(--accent);transform:scale(1.2);opacity:1}
    .slider-wrap .play-toggle{position:absolute;right:14px;top:14px;background:rgba(255,255,255,0.95);padding:8px;border-radius:8px;border:0;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,0.08)}

    /* small screens: make controls smaller */
    @media(max-width:600px){
      .slider-wrap{margin:12px}
      .btn{padding:8px}
      .controls{left:8px;right:8px}
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header" role="banner" aria-label="School header">
    <h1>S.B. PUBLIC SCHOOL</h1>
    <div class="meta">
      Village Chhitauna ¬∑ Post Meghauli Kala ¬∑ Pin Code 273304
      <small>Principal ‚Äî Mr. Gajendra Yadav Sir ¬∑ Call: +91 6389259200 ¬∑ Created By ‚Äî Upendra Vishwakarma</small>
    </div>

    <div class="school-strip-outer" id="schoolStripOuter" aria-live="polite">
      <div id="schoolStrip" class="school-strip"></div>
    </div>
  </div>

  <!-- ADMISSION TICKER -->
  <div class="container">
    <div class="admission-news-bar" role="region" aria-label="Admission news ticker" tabindex="0" id="admissionTickerWrap" style="width:100%;margin:12px auto;max-width:var(--maxWidth);background:linear-gradient(90deg,#9be7ff,#c7f9ff);padding:10px;border-radius:10px;box-shadow:0 10px 26px rgba(3,19,43,0.10)">
      <div class="admission-news-inner" style="overflow:hidden;display:flex;align-items:center">
        <div class="admission-tag" style="padding:6px 10px;border-radius:999px;background:rgba(1,48,62,0.06);margin-right:10px">üì¢ ADMISSION</div>
        <div id="admissionNewsText" class="admission-news-text" style="white-space:nowrap;flex:1;overflow:hidden"></div>
      </div>
    </div>
  </div>

  <!-- SLIDER: single integrated block -->
  <div class="slider-wrap" id="sliderWrap" aria-label="School photo slider (fade)">
    <button class="play-toggle" id="playToggle" aria-pressed="false">Pause</button>
    <div class="slider" id="slider" role="region" aria-roledescription="carousel"></div>
    <div class="controls">
      <button class="btn slider-control" id="prev" aria-label="Previous">‚Äπ</button>
      <button class="btn slider-control" id="next" aria-label="Next">‚Ä∫</button>
    </div>
    <div class="dots" id="dots" role="tablist" aria-label="Slide dots"></div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="container">
    <div class="grid">
      <div>
        <div class="card">
          <h2>Quick Portals</h2>
          <div style="margin-top:8px">
            <a class="btn" data-portal="true" href="#" target="_blank">Fee Portal</a>
            <a class="btn" data-portal="true" href="#" target="_blank" style="margin-left:8px">Marksheet</a>
          </div>
        </div>

        <div class="card">
          <h2>Student Details Lookup</h2>
          <div class="small">Admission Number ‡§°‡§æ‡§≤‡§ï‡§∞ Search ‡§ï‡§∞‡•á‡§Ç</div>
          <div style="margin-top:8px" class="search-row">
            <input id="admission" placeholder="Enter Admission Number" style="flex:1;padding:8px;border-radius:8px;border:1px solid #dce6f7">
            <button class="btn search-btn" data-portal="true" onclick="searchStudent()">Search</button>
          </div>
          <div id="result"></div>
        </div>

        <div class="card">
          <h2>Student Records</h2>
          <div class="small">‡§ü‡•à‡§¨ ‡§¨‡§¶‡§≤ ‡§ï‡§∞ Fee ‡§Ø‡§æ Marksheet ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Äî Mobile/Aadhar masked (last 4)‡•§</div>
          <div class="tabbar" role="tablist" style="margin-top:8px">
            <button class="tab active" id="tabFee" onclick="showTab('fee')">Fee Student Details</button>
            <button class="tab" id="tabMarks" onclick="showTab('marks')">Marksheet Details</button>
          </div>
          <div id="feeContainer" class="table-wrap" style="display:block">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
          <div id="marksContainer" class="table-wrap" style="display:none;margin-top:10px">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
        </div>
      </div>

      <aside>
        <div class="card">
          <h2>Notifications</h2>
          <div id="notifyOuter" class="notify-wrap" aria-live="polite">
            <div id="notifs" class="notify-list"></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h2>Contact</h2>
          <div class="small">S.B. PUBLIC SCHOOL ‚Äî Principal: Mr. Gajendra Yadav<br>Call: +91 6389259200</div>
        </div>
      </aside>
    </div>

    <div class="footer">¬© <span id="year"></span> S.B. PUBLIC SCHOOL ‚Äî All Rights Reserved</div>
  </div>

  <!-- SCRIPTS -->
  <script>
  /* ---- Helper functions (same logic as earlier, adjusted for single doc) ---- */
  function escapeHtml(s){ if(s===null||s===undefined) return ""; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
  function maskLast4(val){ if(val===null||val===undefined) return ""; const s=String(val).trim(); const digits=s.replace(/\\D/g,''); if(digits.length===0) return ''; return '****'+digits.slice(-4); }
  function isMobileHeader(h){ return /mobile|phone|contact|mob/i.test(h); }
  function isAadharHeader(h){ return /aadhar|aadhaar|uid/i.test(h); }

  /* --- Table render (keeps mobile masking) --- */
  function renderTableTo(containerId, gvizJson){
    const cols = (gvizJson.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
    const rows = (gvizJson.table.rows||[]).map(r=> r.c || []);
    const wrap = document.getElementById(containerId);
    if(rows.length === 0){ wrap.innerHTML = "<div style='padding:12px;color:#666'>‡§ï‡•ã‡§à ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</div>"; return; }
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const trh = document.createElement('tr');
    cols.forEach(h=>{ const th=document.createElement('th'); th.innerText=h||''; trh.appendChild(th); });
    thead.appendChild(trh); table.appendChild(thead);

    const tbody=document.createElement('tbody');
    rows.forEach(r=>{
      const tr=document.createElement('tr');
      for(let i=0;i<cols.length;i++){
        const cell=r[i];
        let v="";
        if(cell){
          if(cell.f!==undefined && String(cell.f).trim()!=='') v = String(cell.f).replace(/<[^>]*>/g,'').trim();
          else if(cell.v!==undefined) v = cell.v;
        }
        const header = cols[i]||'';
        if(isMobileHeader(header)) v = maskLast4(v);
        if(isAadharHeader(header)) v = maskLast4(v);
        const td=document.createElement('td'); td.innerText = v; tr.appendChild(td);
      }
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    wrap.innerHTML = ""; wrap.appendChild(table);
  }

  /* --- Tabs --- */
  function showTab(name){
    document.getElementById('feeContainer').style.display = name==='fee' ? 'block' : 'none';
    document.getElementById('marksContainer').style.display = name==='marks' ? 'block' : 'none';
    document.getElementById('tabFee').classList.toggle('active', name==='fee');
    document.getElementById('tabMarks').classList.toggle('active', name==='marks');
  }

  /* --- Search (uses same sheet loader if you use Google Sheets) --- */
  const SHEET_ID = "1BtoDja9imrMyHMKt5oqSYoOzj9w2GWe13JcbRu1vWO8";
  async function loadSheetGviz(sheetName){
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(sheetName)}&tqx=out:json`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('Network response not ok: ' + res.status);
    const text = await res.text();
    const jsonText = text.replace(/^[^{]*/,'').replace(/\);\\s*$/,'');
    return JSON.parse(jsonText);
  }

  async function searchStudent(){
    const adm = document.getElementById("admission").value.trim();
    if(!adm) return alert("Admission Number ‡§°‡§æ‡§≤‡•á‡§Ç");
    try{
      const data = await loadSheetGviz("Student's Details");
      const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
      const rows = (data.table.rows||[]).map(r=> r.c || []);
      const records = rows.map(cells=>{
        const obj={};
        for(let i=0;i<cols.length;i++){
          const cell=cells[i]; let v="";
          if(cell){ if(cell.v!==undefined) v=cell.v; else if(cell.f!==undefined) v=String(cell.f).replace(/<[^>]*>/g,'').trim(); }
          obj[cols[i]||('col'+i)] = v;
        }
        return obj;
      });
      const admKeys = ["Admission No.","Adm. No.","Admission Number","Adm No","Admission No"];
      const rec = records.find(r => admKeys.some(k=> String((r[k]||'')).trim() === adm || String((r[k]||'')).trim() === ("0"+adm)));
      const out = document.getElementById("result"); out.style.display='block';
      if(!rec){ out.innerHTML = "<div style='padding:12px;background:#fff;border-radius:8px;border:1px solid #f1f7ff'>No details found for this Admission Number.</div>"; return; }
      const fields = ["Student Name","Father Name","Mother Name","Date of Birth","Class","Address"];
      let html = '<div style="padding:10px;border-radius:8px;background:#fff;border:1px solid #eef6ff">';
      fields.forEach(f=> html += `<div style="margin-bottom:8px"><strong>${f}:</strong> ${escapeHtml(rec[f]||'')}</div>`);
      html += '</div>'; out.innerHTML = html;
    }catch(e){ console.error("Search error", e); alert("Search ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‚Äî console ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§"); }
  }

  /* --- Notifications & header strip scrolling (lightweight) --- */
  const NOTIF_SPEED = 0.45;
  let notifRAF = null, notifPos = 0;
  function startNotifScroll(){
    const wrap = document.getElementById('notifs'); if(!wrap) return;
    cancelAnimationFrame(notifRAF);
    function step(){ notifPos -= NOTIF_SPEED; const half = wrap.scrollHeight/2 || 0; if(Math.abs(notifPos) >= half) notifPos = 0; wrap.style.transform = `translateY(${notifPos}px)`; notifRAF = requestAnimationFrame(step); }
    step();
  }
  function stopNotifScroll(){ if(notifRAF) cancelAnimationFrame(notifRAF); notifRAF=null; }

  let headerRAF=null, headerPos=0;
  function startHeaderScroll(){
    const strip = document.getElementById('schoolStrip'); if(!strip) return;
    cancelAnimationFrame(headerRAF);
    function step(){ headerPos -= 0.6; const half = strip.scrollWidth/2 || 0; if(Math.abs(headerPos) >= half) headerPos = 0; strip.style.transform = `translateX(${headerPos}px)`; headerRAF = requestAnimationFrame(step); }
    step();
  }
  function stopHeaderScroll(){ if(headerRAF) cancelAnimationFrame(headerRAF); headerRAF=null; }

  async function buildStripFromNotifications(){
    try{
      const data = await loadSheetGviz("Notification");
      const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
      const rows = (data.table.rows||[]).map(r=> r.c || []);
      const textKey = cols.find(k=>/notif|notification|text|message|note|description/i.test(k)) || cols[1] || cols[0] || 'Notification';
      const dateKey = cols.find(k=>/date|day|time/i.test(k)) || cols[0] || 'Date';
      const strip = document.getElementById('schoolStrip'); strip.innerHTML = "";
      const items=[];
      rows.forEach(cells=>{
        const obj={};
        for(let i=0;i<cols.length;i++){ const cell=cells[i]; let v=""; if(cell){ if(cell.v!==undefined) v=cell.v; else if(cell.f!==undefined) v=String(cell.f).replace(/<[^>]*>/g,'').trim(); } obj[cols[i]] = v; }
        const t = obj[textKey] || ''; const d = obj[dateKey] || ''; if(t||d) items.push({date:d,text:t});
      });
      if(items.length===0){ const span=document.createElement('div'); span.className='school-chip'; span.innerText='No notifications to show.'; strip.appendChild(span); return; }
      function makeChip(it){ const txt = (it.date ? (it.date + ' - ') : '') + it.text; const short = txt.length>120? txt.slice(0,117)+'...' : txt; const span=document.createElement('div'); span.className='school-chip'; span.title=txt; span.innerText = short; return span; }
      items.forEach(it=> strip.appendChild(makeChip(it)));
      items.forEach(it=> strip.appendChild(makeChip(it))); // duplicate for smooth scroll
      startHeaderScroll();
      const outer=document.getElementById('schoolStripOuter'); outer.addEventListener('mouseenter', stopHeaderScroll); outer.addEventListener('mouseleave', startHeaderScroll);
    }catch(e){ console.error('Strip build error', e); document.getElementById('schoolStrip').innerHTML = '<div class="school-chip">Unable to load header notifications ‚Äî check sheet name and sharing.</div>'; }
  }

  async function loadNotifications(){
    try{
      const data = await loadSheetGviz("Notification");
      const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
      const rows = (data.table.rows||[]).map(r=> r.c || []);
      const textKey = cols.find(k=>/notif|notification|text|message|note|description/i.test(k)) || cols[1] || cols[0] || 'Notification';
      const dateKey = cols.find(k=>/date|day|time/i.test(k)) || cols[0] || 'Date';
      const wrap = document.getElementById('notifs'); wrap.innerHTML = "";
      rows.forEach(cells=>{
        const obj={};
        for(let i=0;i<cols.length;i++){ const cell=cells[i]; let v=""; if(cell){ if(cell.v!==undefined) v=cell.v; else if(cell.f!==undefined) v=String(cell.f).replace(/<[^>]*>/g,'').trim(); } obj[cols[i]] = v; }
        const d = obj[dateKey] || ''; const t = obj[textKey] || '';
        const node=document.createElement('div'); node.className='notify-item'; node.innerHTML = `<div class="date">${escapeHtml(d)}</div><div class="text">${escapeHtml(t)}</div>`;
        wrap.appendChild(node);
      });
      const orig = wrap.children.length;
      for(let i=0;i<orig;i++) wrap.appendChild(wrap.children[i].cloneNode(true));
      startNotifScroll();
      const outer=document.getElementById('notifyOuter'); outer.addEventListener('mouseenter', stopNotifScroll); outer.addEventListener('mouseleave', startNotifScroll);
    }catch(e){ console.error('Notification load error', e); document.getElementById('notifs').innerHTML = '<div style="padding:12px;color:#c33">Notification ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§è ‚Äî sheet ‡§®‡§æ‡§Æ ‡§î‡§∞ sharing ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>'; }
  }

  /* --- Load fee and marks (safe error messages if not available) --- */
  async function loadFeeAndMarks(){
    try{ const feeJson = await loadSheetGviz("Fee Student Details"); renderTableTo("feeContainer", feeJson); }catch(e){ console.error(e); document.getElementById("feeContainer").innerHTML = "<div style='padding:12px;color:#c33'>Fee Student Details ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§è ‚Äî sheet ‡§®‡§æ‡§Æ ‡§î‡§∞ sharing ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>"; }
    try{ const marksJson = await loadSheetGviz("Marksheet Details"); renderTableTo("marksContainer", marksJson); }catch(e){ console.error(e); document.getElementById("marksContainer").innerHTML = "<div style='padding:12px;color:#c33'>Marksheet Details ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§è ‚Äî sheet ‡§®‡§æ‡§Æ ‡§î‡§∞ sharing ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</div>"; }
  }

  /* --- Admission ticker (simple smooth scroll) --- */
  (function(){
    const NEWS = [
      'ADMISSION OPEN ‚Äì APRIL 2026 ¬∑ Nursery to Class 10 ¬∑ Limited Seats ‚Äî Apply Now',
      'Registration: Mon‚ÄìSat 8:30 AM ‚Äì 3:00 PM ¬∑ Documents: Birth Certificate, Aadhar (if any)',
      'Special Scholarship for Meritorious Students ‚Äî Contact Principal Office',
      'School Timings: 8:30 AM to 3:00 PM ¬∑ Transport Available ¬∑ Call +91 6389259200'
    ];
    const el = document.getElementById('admissionNewsText'); if(!el) return;
    let idx = 0;
    function startMessage(i){
      const msg = NEWS[i];
      el.textContent = msg + ' \u00A0 \u00A0 \u00A0 ' + msg;
      void el.offsetWidth;
      const containerWidth = el.parentElement.clientWidth || 600;
      const textWidth = Math.max(el.scrollWidth / 2, 200);
      const baseMs = 12000;
      const pxFactor = 8;
      const duration = Math.max(7000, Math.round(baseMs + (textWidth * pxFactor)));
      el.style.transition = 'none';
      el.style.transform = `translateX(${containerWidth}px)`;
      requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ el.style.transition = `transform ${duration}ms linear`; el.style.transform = `translateX(-${textWidth}px)`; }); });
      clearTimeout(el._nextTimeout);
      el._nextTimeout = setTimeout(()=>{ idx = (i + 1) % NEWS.length; setTimeout(()=> startMessage(idx), 600); }, duration + 200);
    }
    const wrap = document.getElementById('admissionTickerWrap');
    function pauseTicker(){ el.style.transition = 'none'; clearTimeout(el._nextTimeout); }
    function resumeTicker(){ startMessage(idx); }
    wrap.addEventListener('mouseenter', pauseTicker); wrap.addEventListener('mouseleave', resumeTicker);
    startMessage(0);
    window.AdmissionTicker = { setNews(array){ if(Array.isArray(array)&&array.length){ NEWS.length=0; NEWS.push(...array); idx=0; startMessage(0); } }, pause(){ pauseTicker(); }, resume(){ resumeTicker(); } };
  })();

  /* --- Slider logic (single integrated implementation) --- */
  (function(){
    // fallback image list (you can replace with dynamic images.json or server endpoint)
    const FALLBACK = [
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.37_c4bd2e68.jpg',
      'slider_images/WhatsApp Image 2025-10-30 at 19.36.04_e42049db.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.39_5f42559c.jpg',
      'slider_images/WhatsApp Image 2025-11-16 at 10.33.38_3193ced1.jpg',
      'slider_images/WhatsApp Image 2025-10-30 at 19.35.04_d1684284.jpg'
    ];

    async function loadImagesDynamic(){
      try{ const res = await fetch('/api/images'); if(res.ok){ const j = await res.json(); if(Array.isArray(j.images) && j.images.length) return j.images; } }catch(e){}
      try{ const res2 = await fetch('images.json'); if(res2.ok){ const j2 = await res2.json(); if(Array.isArray(j2.images) && j2.images.length) return j2.images; } }catch(e){}
      return FALLBACK;
    }

    const slider = document.getElementById('slider');
    const dotsWrap = document.getElementById('dots');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const playToggle = document.getElementById('playToggle');
    let IMAGES = [], slides = [], index=0, timer=null, interval=4500;

    function adjustHeightTo(img){
      if(!img || !img.naturalWidth) return;
      const wrapWidth = slider.clientWidth || document.documentElement.clientWidth;
      const h = Math.round((img.naturalHeight / img.naturalWidth) * wrapWidth);
      const maxH = Math.round(window.innerHeight * 0.65);
      slider.style.height = Math.min(h, maxH) + 'px';
    }

    function createSlides(){
      slider.innerHTML = ''; dotsWrap.innerHTML = ''; slides = [];
      IMAGES.forEach((src,i)=>{
        const s = document.createElement('div'); s.className='slide'; s.setAttribute('role','group'); s.setAttribute('aria-roledescription','slide'); s.setAttribute('aria-label', `Slide ${i+1} of ${IMAGES.length}`);
        const img = document.createElement('img'); img.src=src; img.alt = `School photo ${i+1}`;
        img.addEventListener('load', ()=>{ if(i===index) adjustHeightTo(img); });
        s.appendChild(img); slider.appendChild(s); slides.push(s);
        const d = document.createElement('button'); d.className='dot'; d.setAttribute('aria-label','Go to slide '+(i+1)); d.addEventListener('click', ()=>{ pause(); goTo(i); }); dotsWrap.appendChild(d);
      });
      if(slides[0]) slides[0].classList.add('active');
      updateDots();
      setTimeout(()=>{ const img = slides[0] && slides[0].querySelector('img'); if(img && img.complete) adjustHeightTo(img); }, 200);
    }

    function goTo(i){
      if(slides.length===0) return;
      index = (i + slides.length) % slides.length;
      slides.forEach((s, idx)=> s.classList.toggle('active', idx===index));
      updateDots();
      const img = slides[index].querySelector('img');
      if(img && img.complete) adjustHeightTo(img);
      else if(img) img.addEventListener('load', ()=> adjustHeightTo(img), { once:true });
    }
    function nextSlide(){ goTo(index+1); }
    function prevSlide(){ goTo(index-1); }

    function updateDots(){ const dots = dotsWrap.children; for(let i=0;i<dots.length;i++) dots[i].classList.toggle('active', i===index); }

    function start(){ if(timer) clearInterval(timer); timer = setInterval(nextSlide, interval); playToggle.textContent='Pause'; playToggle.setAttribute('aria-pressed','false'); }
    function pause(){ if(timer) clearInterval(timer); timer=null; playToggle.textContent='Play'; playToggle.setAttribute('aria-pressed','true'); }

    nextBtn.addEventListener('click', ()=>{ pause(); nextSlide(); });
    prevBtn.addEventListener('click', ()=>{ pause(); prevSlide(); });
    playToggle.addEventListener('click', ()=>{ if(timer) pause(); else start(); });

    document.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight'){ pause(); nextSlide(); } else if(e.key==='ArrowLeft'){ pause(); prevSlide(); } });

    let startX=0;
    slider.addEventListener('touchstart', e=> startX = e.touches[0].clientX);
    slider.addEventListener('touchend', e=> { const dx = e.changedTouches[0].clientX - startX; if(Math.abs(dx)>40){ pause(); if(dx<0) nextSlide(); else prevSlide(); } });

    let resizeDeb;
    window.addEventListener('resize', ()=>{ clearTimeout(resizeDeb); resizeDeb = setTimeout(()=>{ const img = slides[index] && slides[index].querySelector('img'); if(img && img.complete) adjustHeightTo(img); }, 160); });

    (async function init(){
      IMAGES = await loadImagesDynamic();
      if(!IMAGES || IMAGES.length===0) IMAGES = FALLBACK;
      createSlides();
      start();
    })();
  })();

  /* --- Init page loads --- */
  document.getElementById("year").innerText = new Date().getFullYear();
  showTab('fee');
  // Attempt to load dynamic sheet content (if available). These functions will fail gracefully with console errors if sharing/sheet name not set.
  buildStripFromNotifications().catch(()=>{ /* ignore */ });
  loadNotifications().catch(()=>{ /* ignore */ });
  loadFeeAndMarks().catch(()=>{ /* ignore */ });

  </script>
</body>
</html>
