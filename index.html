<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>S.B. Public School Chhitauna ‚Äî Student Portal</title>

<!-- ========== CORE STYLES (existing kept) ========== -->
<style>
:root{--accent:#0b5fa8;--accent2:#1167b1;--card:#fff;--muted:#54607a}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Arial,Segoe UI,Roboto,sans-serif;color:#0f172a;background:linear-gradient(180deg,#eaf4ff,#f7fbff)}
/* Centered header */
.header{
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#fff;text-align:center;padding:18px 12px;border-radius:0 0 14px 14px;
  box-shadow:0 6px 18px rgba(0,0,0,0.12); position:sticky; top:0; z-index:9999;
}
.header h1{margin:0;font-size:clamp(20px,4.5vw,30px);font-weight:800;letter-spacing:0.4px}
.header .meta{margin-top:6px;font-size:14px;opacity:0.95}
.header .meta small{display:block;font-size:13px;opacity:0.9;margin-top:4px}

/* horizontal strip under header */
.school-strip-outer{overflow:hidden;width:100%;margin-top:12px;padding-bottom:8px}
.school-strip{white-space:nowrap;display:flex;gap:18px;align-items:center;will-change:transform;transform:translateX(0)}
.school-chip{display:inline-block;font-weight:700;font-size:14px;background:rgba(255,255,255,0.06);padding:6px 12px;border-radius:8px}

/* main layout */
.container{max-width:1100px;margin:14px auto;padding:12px}
.grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:12px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 5px 18px rgba(0,0,0,0.06);margin-bottom:12px}
h2{margin:0;color:var(--accent);font-size:16px;margin-bottom:8px}
.small{color:var(--muted);font-size:13px}
.tabbar{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.tab{padding:8px 12px;border-radius:8px;background:#f1fbff;border:1px solid #d6ecff;color:var(--accent);cursor:pointer;font-weight:600}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border:0}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:8px 12px;border:0;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block}
.search-row{display:flex;gap:8px;margin-bottom:8px}
@media(max-width:640px){.search-row{flex-direction:column} .tabbar{gap:6px}}

/* Quick portals 3D (kept existing animation) */
.qp-3d-wrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap;perspective:1200px;margin-top:10px}
.qp-3d{--w:160px;display:inline-flex;align-items:center;justify-content:center;gap:10px;width:var(--w);min-width:120px;padding:12px 14px;border-radius:14px;font-weight:800;color:#fff;text-decoration:none;transform-style:preserve-3d;transition:transform .28s cubic-bezier(.2,9,3,1), box-shadow .28s ease;will-change:transform;position:relative;border:0;cursor:pointer}
.qp-3d .face{position:relative;z-index:2;transform: translateZ(18px);display:inline-flex;align-items:center;gap:8px}
.qp-3d::before{content:'';position:absolute;inset:0;z-index:1;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(0,0,0,0.04));pointer-events:none}
.qp-3d::after{content:'';position:absolute;inset:0;border-radius:14px;z-index:0;filter: blur(14px);opacity:.55;transition: opacity .28s ease, transform .28s ease}
.fee-3d{background: linear-gradient(135deg,#0b5fa8,#1274d1);box-shadow: 0 18px 40px rgba(11,95,168,0.22)}
.marksheet-3d{background: linear-gradient(135deg,#10b981,#06d6a0);box-shadow: 0 16px 36px rgba(6,129,80,0.18)}
.teacher-3d{background: linear-gradient(135deg,#7b2ff7,#9d4bff);box-shadow: 0 12px 28px rgba(135,60,255,0.18)}
.qp-3d .ico{font-size:18px;display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:8px;background: rgba(255,255,255,0.08)}
@media(max-width:640px){.qp-3d{width:100%}}

/* Slider (kept existing) */
.slider-wrap{max-width:1100px;margin:20px auto;position:relative;border-radius:12px;overflow:visible}
.slider{position:relative;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(16,24,40,0.08);background:#000;transition:height .45s ease}
.slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .8s ease;will-change:opacity;pointer-events:none}
.slide.active{opacity:1;pointer-events:auto}
.slide img{width:100%;height:auto;display:block;object-fit:cover}

/* StudyGenie floating helper (kept but will hide on small screens) */
.sg-floating {
  position: fixed;
  right: 18px;
  bottom: 18px;
  width:54px;
  height:54px;
  border-radius:50%;
  background:linear-gradient(135deg,#00f5d4,#0b5fa8);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 12px 30px rgba(2,6,23,0.28);
  z-index:999999;
  cursor:pointer;
  transition:transform .12s ease;
}
.sg-floating .badge{ position:absolute; top:-6px; right:-6px; background:#ff3b30; color:#fff; font-weight:800; font-size:12px; padding:3px 6px; border-radius:999px; }

/* Tables: allow horizontal scroll on mobile */
.table-wrap{ overflow-x:auto; -webkit-overflow-scrolling:touch; padding:6px 6px; }
.table-wrap table{ width:100%; min-width:600px; border-collapse:collapse; }

/* teacherAuth modal (kept) */
#teacherAuthModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:100000}
#teacherAuthModal .modalCard{width:380px;max-width:94%;background:#fff;border-radius:12px;padding:18px;box-shadow:0 18px 60px rgba(2,6,23,0.36);font-family:Arial,Helvetica,sans-serif}
#teacherAuthModal h3{margin:0 0 8px;color:#0b5fa8}
#teacherAuthModal .hint{font-size:13px;color:#586574;margin-bottom:12px}
#teacherAuthModal input[type="password"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6f0fb;font-size:15px}
#teacherAuthModal .actions{display:flex;gap:8px;margin-top:12px}
#teacherAuthModal button{flex:1;padding:8px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:800}
#teacherAuthModal .ok{background:linear-gradient(90deg,#0b5fa8,#1167b1);color:#fff}
#teacherAuthModal .cancel{background:#f1f5f9;color:#042033}
#teacherAuthModal .msg{margin-top:8px;font-size:13px}

/* small utility tweaks */
a,button{font-family:inherit}
</style>

<!-- =========================
   MOBILE + LAYOUT FIXES (INSERTED BY ASSISTANT)
   Paste this at end of head to fix mobile overlaps, portals & floating helper
   ========================= -->
<style>
/* 1) Prevent header from covering content on small screens */
@media (max-width: 700px) {
  .header { padding:12px 10px; border-radius:0 0 12px 12px; }
  .container { padding-top: 6px; }
}

/* 2) Reduce header vertical size on very small screens */
@media (max-width: 480px) {
  .header { padding:10px 10px; }
  .header h1 { font-size:18px; line-height:1.05; }
  .header .meta { font-size:13px; }
  .school-strip-outer { margin-top:8px; padding-bottom:6px; }
}

/* 3) Make Quick Portals responsive */
.qp-3d-wrap { gap:10px; }
.qp-3d { --w:auto; min-width:0; padding:12px 14px; border-radius:12px; font-size:14px; }

/* On very small screens stack portals */
@media (max-width: 420px) {
  .qp-3d-wrap { flex-direction: column; align-items: stretch; }
  .qp-3d { width:100%; padding:12px 16px; border-radius:12px; text-align:left; justify-content:flex-start; }
  .qp-3d .ico { margin-right:10px; }
}

/* 4) Ensure tables do not force zoom-out on mobile and are horizontally scrollable */
html, body { max-width:100%; overflow-x:hidden; -webkit-text-size-adjust:100%; }
.table-wrap { overflow-x:auto; -webkit-overflow-scrolling:touch; }
.table-wrap table { min-width:unset !important; width:100% !important; }

/* 5) Reduce heavy box-shadows and radius on small screens */
@media (max-width: 520px) {
  .admission-news-bar, .slider-wrap, .card { box-shadow: 0 6px 18px rgba(3,19,43,0.07); border-radius:10px; }
}

/* 6) Floating helper hide on small screens (avoids covering inputs) */
@media (max-width: 480px) {
  .sg-floating { display: none !important; }
  .sg-popover { display: none !important; }
}

/* 7) Make search/CTA fit on medium screens */
@media (max-width:640px){
  .quick-apply-btn{ width:100%; justify-content:center; padding:10px 14px; box-sizing:border-box; }
  .search-row input { min-width: 0; }
}

/* 8) Fix accidental large horizontal elements */
.school-strip, .school-chip { max-width: 100%; word-break: break-word; }

/* 9) Modal fit */
#teacherAuthModal .modalCard { max-width: 94%; margin: 0 12px; }
</style>

<!-- Small JS helper: adjust anchor scroll to account for sticky header -->
<script>
(function(){
  function offsetScroll() {
    var header = document.querySelector('.header');
    if(!header) return;
    var hdrH = header.getBoundingClientRect().height || 64;
    if(location.hash) {
      var el = document.querySelector(location.hash);
      if(el) {
        var top = el.getBoundingClientRect().top + window.pageYOffset - hdrH - 12;
        window.scrollTo({ top: top, behavior: 'smooth' });
      }
    }
  }
  window.addEventListener('load', offsetScroll);
  window.addEventListener('hashchange', offsetScroll);
})();
</script>

</head>
<body>

<!-- ===== HEADER ===== -->
<header class="header" role="banner">
  <h1>S.B. PUBLIC SCHOOL</h1>
  <div class="meta">
    Village Chhitauna ¬∑ Post Meghauli Kala ¬∑ Pin Code 273304<br>
    Principal ‚Äî Mr. Gajendra Yadav Sir ¬∑ Call: +91 6389259200 ¬∑ Created By ‚Äî Upendra Vishwakarma
  </div>
</header>

<!-- Admission ticker -->
<div class="school-strip-outer" aria-hidden="false">
  <div class="school-strip" role="region" aria-label="school news">
    <div class="school-chip">Yearly Exam Declared Date is 05-12-2025 to 17-12-2025</div>
  </div>
</div>

<!-- MAIN CONTAINER -->
<div class="container" role="main">
  <div class="grid">
    <!-- MAIN COLUMN -->
    <div>

      <!-- Quick Portals -->
      <div class="card" aria-label="Quick Portals">
        <h2>Quick Portals</h2>
        <div class="qp-3d-wrap" role="list" aria-label="Quick portals list">

          <a href="/fee-portal" class="qp-3d fee-3d" role="listitem" data-portal="true">
            <span class="face"><span class="ico">üí≥</span> <span>Fee Portal</span></span>
          </a>

          <a href="/marksheet" class="qp-3d marksheet-3d" role="listitem" data-portal="true">
            <span class="face"><span class="ico">üßæ</span> <span>Marksheet</span></span>
          </a>

          <a href="/teacher" class="qp-3d teacher-3d" role="listitem" data-portal="true">
            <span class="face"><span class="ico">üë®‚Äçüè´</span> <span>Teacher Login</span></span>
          </a>

        </div>
      </div>

      <!-- Admission News & Slider (kept) -->
      <div class="card">
        <div class="admission-news-bar" role="region" aria-label="Admission news ticker" tabindex="0" id="admissionTickerWrap">
          <div class="admission-news-inner">
            <div class="admission-news-meta">
              <div class="admission-tag">üì¢ ADMISSION</div>
              <div class="admission-news-text" id="admissionNewsText" aria-live="polite">Admission Open ‚Äî Nursery to Class 10</div>
            </div>
            <div class="admission-news-ghost" aria-hidden="true"></div>
          </div>
        </div>

        <!-- Slider: simplified container (images loaded dynamically in script below) -->
        <div class="slider-wrap" id="sliderWrap" aria-label="School photo slider (fade)">
          <button class="play-toggle" id="playToggle" aria-pressed="false">Pause</button>
          <div class="slider" id="slider" role="region" aria-roledescription="carousel"></div>
          <div class="controls">
            <button class="btn slider-control" id="prev" aria-label="Previous">‚Äπ</button>
            <button class="btn slider-control" id="next" aria-label="Next">‚Ä∫</button>
          </div>
          <div class="dots" id="dots" role="tablist" aria-label="Slide dots"></div>
        </div>
      </div>

      <!-- Student Lookup -->
      <div class="card" id="studentLookup" aria-labelledby="studentLookupTitle">
        <h2 id="studentLookupTitle">Student Details Lookup</h2>
        <div class="small">Admission Number ‡§°‡§æ‡§≤‡§ï‡§∞ Search ‡§ï‡§∞‡•á‡§Ç</div>
        <div class="search-row" style="margin-top:8px">
          <input id="admission" type="text" placeholder="Enter Admission Number" aria-label="Admission number" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6f2fb">
          <button class="btn" onclick="searchStudent()">Search</button>
        </div>
        <div id="result" style="display:none;margin-top:8px"></div>
      </div>

    </div>

    <!-- SIDEBAR -->
    <aside>
      <div class="card">
        <h2>Quick Info</h2>
        <button class="btn" id="quickInfoBtn">Quick Info</button>
      </div>

      <div class="card">
        <h2>Notifications</h2>
        <div style="position:relative">
          <div id="notifyOuter" tabindex="0" aria-live="polite">
            <div style="padding:8px;color:#667">Loading notifications‚Ä¶</div>
          </div>
          <div style="height:8px"></div>
          <button id="openNotifs" class="btn" style="background:#0b5fa8">Open Notifications</button>
        </div>
      </div>

    </aside>
  </div>
</div>

<!-- StudyGenie floating helper (visible on desktop, hidden on small screens) -->
<div class="sg-floating" id="studyGenie" role="button" aria-label="Help / Notifications" tabindex="0">
  <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><circle cx="12" cy="12" r="10" fill="white" opacity="0.12"/></svg>
  <span class="badge" id="sgBadge">2</span>
</div>

<!-- Teacher auth modal (intercept handled by injected script) -->
<div id="teacherAuthModal" role="dialog" aria-hidden="true">
  <div class="modalCard" role="document" aria-label="Teacher login">
    <h3>Teacher Login</h3>
    <div class="hint">Teacher Login ‡§ñ‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç</div>
    <input id="teacherAuthPw" type="password" placeholder="Password" aria-label="Password" autocomplete="current-password">
    <div class="actions">
      <button class="ok" id="teacherAuthOk">Login</button>
      <button class="cancel" id="teacherAuthCancel">Cancel</button>
    </div>
    <div id="teacherAuthMsg" class="msg" aria-live="polite"></div>
  </div>
</div>

<!-- ========== SCRIPTS ========== -->
<script>
/* ---------- Slider logic (kept similar to original) ---------- */
async function loadImagesDynamic(){
  // try server endpoints fallback to embedded list
  try{ const res = await fetch('/api/images'); if(res.ok){ const j = await res.json(); if(Array.isArray(j.images) && j.images.length) return j.images; } }catch(e){}
  try{ const res2 = await fetch('images.json'); if(res2.ok){ const j2 = await res2.json(); if(Array.isArray(j2.images) && j2.images.length) return j2.images; } }catch(e){}
  return [
    'slider_images/WhatsApp Image 2025-11-16 at 10.33.37_c4bd2e68.jpg',
    'slider_images/WhatsApp Image 2025-10-30 at 19.36.04_e42049db.jpg',
    'slider_images/logo.jpg'
  ];
}

let IMAGES = [];
(function(){ IMAGES = []; loadImagesDynamic().then(imgs=>{ IMAGES=imgs; createSlides(); start(); }).catch(()=>{ IMAGES=[]; createSlides(); start(); }); })();

const slider = document.getElementById('slider');
const sliderWrap = document.getElementById('sliderWrap');
const dotsWrap = document.getElementById('dots');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const playToggle = document.getElementById('playToggle');

let slides = [];
let index = 0;
let timer = null;
let interval = 4000;

function createSlides(){
  slider.innerHTML = '';
  dotsWrap.innerHTML = '';
  IMAGES.forEach((src,i)=>{
    const s = document.createElement('div');
    s.className = 'slide';
    s.setAttribute('role','group');
    s.setAttribute('aria-roledescription','slide');
    s.setAttribute('aria-label', `Slide ${i+1} of ${IMAGES.length}`);
    const img = document.createElement('img');
    img.src = src;
    img.alt = `School photo ${i+1}`;
    img.addEventListener('load', ()=>{
      if(i===index) adjustHeightTo(img);
    });
    s.appendChild(img);
    slider.appendChild(s);
    slides.push(s);

    const d = document.createElement('button');
    d.className = 'dot';
    d.setAttribute('aria-label', 'Go to slide ' + (i+1));
    d.addEventListener('click', ()=>{ pause(); goTo(i); });
    dotsWrap.appendChild(d);
  });
  if(slides[0]) slides[0].classList.add('active');
  updateDots();
  setTimeout(()=>{ const img = slides[0] && slides[0].querySelector('img'); if(img && img.complete) adjustHeightTo(img); }, 300);
}

function adjustHeightTo(img){
  const wrapWidth = slider.clientWidth || sliderWrap.clientWidth;
  if(!img.naturalWidth) return;
  const h = Math.round((img.naturalHeight / img.naturalWidth) * wrapWidth);
  const maxH = Math.round(window.innerHeight * 0.65);
  const finalH = Math.min(h, maxH);
  slider.style.height = finalH + 'px';
}

function goTo(i){
  index = (i + slides.length) % slides.length;
  slides.forEach((s, idx)=> s.classList.toggle('active', idx===index));
  updateDots();
  const img = slides[index] && slides[index].querySelector('img');
  if(img && img.complete) adjustHeightTo(img);
  else if(img) img.addEventListener('load', ()=> adjustHeightTo(img), { once:true });
}
function nextSlide(){ goTo(index+1); }
function prevSlide(){ goTo(index-1); }

function updateDots(){
  const dots = dotsWrap.children;
  for(let i=0;i<dots.length;i++){ dots[i].classList.toggle('active', i===index); }
}

function start(){ if(timer) clearInterval(timer); timer = setInterval(nextSlide, interval); playToggle.textContent = 'Pause'; playToggle.setAttribute('aria-pressed','false'); }
function pause(){ if(timer) clearInterval(timer); timer = null; playToggle.textContent = 'Play'; playToggle.setAttribute('aria-pressed','true'); }

nextBtn && nextBtn.addEventListener('click', ()=>{ pause(); nextSlide(); });
prevBtn && prevBtn.addEventListener('click', ()=>{ pause(); prevSlide(); });
playToggle && playToggle.addEventListener('click', ()=>{ if(timer) pause(); else start(); });

document.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight'){ pause(); nextSlide(); } else if(e.key==='ArrowLeft'){ pause(); prevSlide(); } });

let startX=0;
slider && slider.addEventListener && slider.addEventListener('touchstart', e=> startX = e.touches[0].clientX);
slider && slider.addEventListener && slider.addEventListener('touchend', e=> { const dx = e.changedTouches[0].clientX - startX; if(Math.abs(dx)>40){ pause(); if(dx<0) nextSlide(); else prevSlide(); } });

let resizeDeb;
window.addEventListener('resize', ()=>{ clearTimeout(resizeDeb); resizeDeb = setTimeout(()=>{ const img = slides[index] && slides[index].querySelector('img'); if(img && img.complete) adjustHeightTo(img); }, 120); });

/* ---------- Student search (kept) ---------- */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
async function loadSheetGviz(sheetName){
  // placeholder: original page used Google Visualization JSON; keep same call if configured
  // If not configured, this will throw and searchStudent will catch and show error.
  const sheetUrl = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/gviz/tq?tqx=out:json&sheet=' + encodeURIComponent(sheetName);
  const res = await fetch(sheetUrl);
  const txt = await res.text();
  // parse gviz json wrapper
  const jsonText = txt.replace(/^[^\(]*\(/,'').replace(/\);?\s*$/,'');
  return JSON.parse(jsonText);
}
function maskLast4(v){ if(!v) return ''; const s = String(v); if(s.length<=4) return s; return s.slice(0,-4).replace(/./g,'*') + s.slice(-4); }
function isMobileHeader(h){ return /mobile|phone/i.test(h); }
function isAadharHeader(h){ return /aadhar|adhar/i.test(h); }

async function searchStudent(){
  const adm = document.getElementById("admission").value.trim();
  if(!adm) return alert("Admission Number ‡§°‡§æ‡§≤‡•á‡§Ç");
  try{
    const data = await loadSheetGviz("Student's Details");
    const cols = (data.table.cols||[]).map(c=> (c.label||c.id||'').toString().trim());
    const rows = (data.table.rows||[]).map(r=> r.c || []);
    const records = rows.map(cells=>{
      const obj = {};
      for(let i=0;i<cols.length;i++){
        const cell = cells[i];
        let v = "";
        if(cell){
          if(cell.v !== undefined) v = cell.v;
          else if(cell.f !== undefined) v = String(cell.f).replace(/<[^>]*>/g,'').trim();
        }
        obj[cols[i]||('col'+i)] = v;
      }
      return obj;
    });

    const admKeys = ["Admission No.","Adm. No.","Admission Number","Adm No","Admission No"];
    const rec = records.find(r => admKeys.some(k=> String((r[k]||'')).trim() === adm || String((r[k]||'')).trim() === ("0"+adm)));
    const out = document.getElementById("result");
    out.style.display = 'block';
    if(!rec){
      out.innerHTML = "<div style='padding:12px;background:#fff;border-radius:8px;border:1px solid #f1f7ff'>No details found for this Admission Number.</div>";
      return;
    }

    const fields = ["Student Name","Father Name","Mother Name","Date of Birth","Class","Address"];
    let html = '<div style="padding:10px;border-radius:8px;background:#fff;border:1px solid #eef6ff">';
    fields.forEach(f=>{
      html += `<div style="margin-bottom:8px"><strong>${f}:</strong> ${escapeHtml(rec[f]||'')}</div>`;
    });
    html += '</div>';
    out.innerHTML = html;

  }catch(e){
    console.error("Search error", e);
    alert("Search ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‚Äî console ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§");
  }
}

/* ---------- Quick Info ---------- */
document.getElementById('quickInfoBtn') && document.getElementById('quickInfoBtn').addEventListener('click', function(){
  const msg = 'Admission Open ‚Äî Nursery to Class 10.\nDocuments: Birth Certificate, Aadhar (if available).\nCall: +91 6389259200';
  if(window.navigator && navigator.share){
    navigator.share({ title:'Admission ‚Äî S.B. PUBLIC SCHOOL', text: msg }).catch(()=> alert(msg));
  } else {
    alert(msg);
  }
});

/* ---------- StudyGenie floating behavior (simplified) ---------- */
(function(){
  var sg = document.getElementById('studyGenie');
  if(!sg) return;
  var pop = null;
  sg.addEventListener('click', function(){
    alert('Help / Notifications ‚Äî Replace with your real logic.');
  });
})();

/* ---------- Teacher login intercept & modal ---------- */
(function(){
  const AUTH_PASS = 'SBPSC@9044'; // keep same as before or change
  const SESSION_KEY = 'sbps_teacher_authed';
  const modal = document.getElementById('teacherAuthModal');
  const pwInput = document.getElementById('teacherAuthPw');
  const okBtn = document.getElementById('teacherAuthOk');
  const cancelBtn = document.getElementById('teacherAuthCancel');
  const msgEl = document.getElementById('teacherAuthMsg');

  function showModal(){
    modal.setAttribute('aria-hidden','false');
    modal.style.display = 'flex';
    setTimeout(()=>{ modal.classList && modal.classList.add('visible'); if(pwInput) pwInput.focus(); },20);
  }
  function hideModal(){
    modal.setAttribute('aria-hidden','true');
    modal.style.display = 'none';
    if(pwInput) pwInput.value = '';
    if(msgEl) msgEl.innerText = '';
  }
  function openTarget(href, target){
    try{
      sessionStorage.setItem(SESSION_KEY,'1');
      if(!href || href === '#') location.href = '/teacher';
      else window.open(href, target || '_self');
    }catch(e){ location.href = '/teacher'; }
  }
  function attemptLogin(href, target){
    const v = (pwInput.value||'').trim();
    if(!v){ if(msgEl) msgEl.innerText = 'Password ‡§°‡§æ‡§≤‡•á‡§Ç'; pwInput.focus(); return; }
    if(v === AUTH_PASS){
      if(msgEl) msgEl.innerText = 'Login ‡§∏‡§´‡§≤ ‚Äî ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å...';
      setTimeout(()=>{ hideModal(); openTarget(href, target); }, 300);
    } else {
      if(msgEl) msgEl.innerText = '‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‚Äî ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç';
      pwInput.value = ''; pwInput.focus();
    }
  }

  // Global click interceptor for teacher links/buttons
  document.addEventListener('click', function(e){
    const el = e.target.closest('a,button');
    if(!el) return;
    if(el.hasAttribute('data-no-auth')) return;
    const txt = (el.innerText || el.getAttribute('title') || el.getAttribute('aria-label') || '').toLowerCase();
    const href = (el.getAttribute && el.getAttribute('href')) || '';
    const cls = (el.className || '').toString().toLowerCase();
    const triggers = ['teacher', 'teacher login', '‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï', '‡§ü‡•Ä‡§ö‡§∞', 'teacherportal', 'teacher-portal'];
    const isTeacher = triggers.some(t => txt.includes(t) || href.toLowerCase().includes(t) || cls.includes(t));
    if(!isTeacher) return;
    if(e.ctrlKey || e.metaKey || e.shiftKey || (e.button && e.button === 1)) return;
    try{ if(sessionStorage.getItem(SESSION_KEY) === '1') return; }catch(e){}
    e.preventDefault(); e.stopPropagation();
    modal.dataset.origHref = href || el.getAttribute('data-href') || '#';
    modal.dataset.origTarget = el.getAttribute('target') || '_self';
    showModal();
    okBtn.onclick = function(){ attemptLogin(modal.dataset.origHref, modal.dataset.origTarget); };
    pwInput.onkeydown = function(ev){ if(ev.key === 'Enter') attemptLogin(modal.dataset.origHref, modal.dataset.origTarget); };
  }, true);

  cancelBtn.addEventListener('click', hideModal);
  modal.addEventListener('click', function(ev){ if(ev.target === modal) hideModal(); });
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') hideModal(); });

})();
</script>

<!-- ========== END SCRIPTS ========== -->

</body>
</html>
